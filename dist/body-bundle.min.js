/*!
 * QuadroBoards Automatizations - BODY BUNDLE
 * @version 1.0.0
 */
function dfm_escape(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function dfm_insertAtCaret(e,t){e.focus();var n="number"==typeof e.selectionStart?e.selectionStart:e.value.length,o="number"==typeof e.selectionEnd?e.selectionEnd:e.value.length;e.value=e.value.slice(0,n)+t+e.value.slice(o),e.selectionStart=e.selectionEnd=n+t.length;try{e.dispatchEvent(new Event("input",{bubbles:!0}))}catch(e){}}function dfm_hash32(e){var t,n=2166136261;for(t=0;t<e.length;t++)n=16777619*((n^=e.charCodeAt(t))>>>0);return n>>>0}function dfm_prng(e){var t=e>>>0||2654435769;return function(){return t^=t<<13,t^=t>>>17,t^=t<<5,(t>>>=0)/4294967296}}function dfm_rng_int(e,t,n){var o=e();return t+Math.floor(o*(n-t+1))}function dfm_roll_det(e,t,n){var o,r=dfm_prng(n),i=[];for(o=0;o<e;o++)i.push(dfm_rng_int(r,1,t));return i}function dfm_canon(e,t,n){var o=String(parseInt(e,10)),r=String(parseInt(t,10)),i=parseInt(n,10);return o+":"+r+":"+(i=i>=0?"+"+i:""+i)}function dfm_makeSeed(e,t,n){return dfm_hash32("DiceFM|"+((e&&e.id?e.id:"").match(/\d+/)||[0])[0]+"|"+(e&&e.getAttribute("data-posted")||"0")+"|"+t+"|"+n)}function dfm_attach(){var e=document.getElementById("dicefm-btn"),t=document.getElementById("main-reply");e&&t&&e.addEventListener("click",function(){var e=prompt("–°–∫–æ–ª—å–∫–æ –¥–∞–π—Å–æ–≤ –±—Ä–æ—Å–∞–µ–º?","1");if(null!==e){var n=parseInt(e,10);if(n>=1&&n<=100){var o=prompt("–°–∫–æ–ª—å–∫–æ –≥—Ä–∞–Ω–µ–π —É –∫–∞–∂–¥–æ–≥–æ –¥–∞–π—Å–∞?","6");if(null!==o){var r=parseInt(o,10);if(r>=2&&r<=1e5){var i=prompt("–ï—Å—Ç—å –ª–∏ –±–æ–Ω—É—Å/—à—Ç—Ä–∞—Ñ?","+0");if(null!==i)if(i=(i||"").trim(),/^[+-]?\d+$/.test(i)){var a=parseInt(i,10);if(Math.abs(a)>1e5)alert("–ê–±—Å–æ–ª—é—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ –±–æ–ª—å—à–µ 100000");else{var s=a>=0?"+"+a:""+a,c=prompt("–ü—Ä–∏—á–∏–Ω–∞ –±—Ä–æ—Å–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)","")||"";c=c.replace(/\]/g," ").replace(/\s+/g," ").trim(),dfm_insertAtCaret(t,"[DiceFM "+n+":"+r+":"+s+":"+(c||"")+"]")}}else alert("–ù—É–∂–µ–Ω —Ñ–æ—Ä–º–∞—Ç +1 –∏–ª–∏ -1")}else alert("–ó–Ω–∞—á–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö [2;100000]")}}else alert("–ó–Ω–∞—á–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö [1;100]")}})}function dfm_render(e,t,n,o,r){var i=parseInt(e,10),a=parseInt(t,10),s=parseInt(n,10);if(!(i>=1&&i<=100&&a>=2&&a<=1e5&&Math.abs(s)<=1e5))throw new Error("–ü—Ä–æ–±–ª–µ–º–∞ —Å –¥–∞–Ω–Ω—ã–º–∏");var c,l=dfm_roll_det(i,a,r),d=0,u="";for(c=0;c<l.length;c++)d+=l[c],u+=(c?"+":"")+l[c];var p="("+u+")"+(0===s?"":s>0?"+"+s:""+s)+"="+(d+s);return'<div class="quote-box"><blockquote style="text-align:left"><p>'+("<b>–ë—Ä–æ—Å–æ–∫ "+i+"d"+a+(0===s?"":s>0?" —Å –±–æ–Ω—É—Å–æ–º "+s:" —Å–æ —à—Ç—Ä–∞—Ñ–æ–º "+s)+"</b>")+(o?"<br><em>"+dfm_escape(o)+"</em>":"")+"<br><br><b>–†–µ–∑—É–ª—å—Ç–∞—Ç:</b> "+p+"</p></blockquote></div>"}function dfm_replace(e){if(e){var t=e.closest?e.closest(".post"):null,n=e.innerHTML,o={},r=n.replace(/\[(?:DiceFM)\s+(\d+)\s*:\s*(\d+)\s*:\s*([+-]?\d+)\s*:\s*(?:"([^"]*)"|([^\]]*))\s*\]/gi,function(e,n,r,i,a,s){try{var c=((null!=a?a:s)||"").replace(/\s+/g," ").trim(),l=dfm_canon(n,r,i),d=o[l]||0;return o[l]=d+1,dfm_render(n,r,i,c,dfm_makeSeed(t,l,d))}catch(t){return e}});r!==n&&(e.innerHTML=r)}}function dfm_init(){if("undefined"==typeof FORUM||FORUM.topic)for(var e=document.querySelectorAll?document.querySelectorAll(".post-content"):[],t=0;t<e.length;t++)dfm_replace(e[t])}window.jQuery?(jQuery(function(){dfm_attach(),dfm_init()}),jQuery(document).on("pun_post",function(){dfm_init()}),jQuery(document).on("pun_edit",function(){dfm_init()})):document.addEventListener&&document.addEventListener("DOMContentLoaded",function(){dfm_attach(),dfm_init()}),$.fn.fixDashes=function(){var e="[\\s\\u00A0\\u202F\\u2009\\u2002-\\u2008\\u200A\\u200B\\uFEFF\\u200C\\u200D]",t=new RegExp(e),n=new RegExp("^"+e+"*$");function o(e){return!!e&&t.test(e)}function r(e){return!e||n.test(e)}function i(e){return"-"===e||"‚àí"===e||e&&e>="‚Äê"&&e<="‚Äï"}var a=new RegExp("("+e+")(?:-|[\\u2010-\\u2015]|\\u2212)(?="+e+")","g"),s=new RegExp(e+"(?:-|[\\u2010-\\u2015]|\\u2212)"+e+"*$"),c={ADDRESS:1,ARTICLE:1,ASIDE:1,BLOCKQUOTE:1,DIV:1,DL:1,DT:1,DD:1,FIELDSET:1,FIGCAPTION:1,FIGURE:1,FOOTER:1,FORM:1,H1:1,H2:1,H3:1,H4:1,H5:1,H6:1,HEADER:1,HR:1,LI:1,MAIN:1,NAV:1,OL:1,P:1,PRE:1,SECTION:1,TABLE:1,THEAD:1,TBODY:1,TFOOT:1,TR:1,TD:1,TH:1,UL:1},l={SCRIPT:1,STYLE:1,CODE:1,PRE:1,KBD:1,SAMP:1};function d(e){for(var t=e.length-1;t>=0;t--)if(!o(e.charAt(t)))return t;return-1}function u(e){for(var t=0;t<e.length;t++)if(!o(e.charAt(t)))return t;return-1}function p(e){for(var t,n=[e];n.length;)for(t=n.shift().firstChild;t;t=t.nextSibling){if(3===t.nodeType&&!r(t.nodeValue))return t;if(1===t.nodeType){var o=t.nodeName.toUpperCase();if(l[o])continue;n.push(t)}}return null}function m(e){for(var t=e;t;t=t.parentNode)if(1===t.nodeType){var n=t.className||"";if("string"==typeof n&&-1!==n.indexOf("quote-box")&&-1!==n.indexOf("spoiler-box")&&-1!==n.indexOf("media-box"))return!0}return!1}function f(e,t){if(e&&t){var n=e.nodeValue;if(s.test(n)){var r=d(n);if(-1!==r){var a=n.charAt(r),c=r>0?n.charAt(r-1):"";if(i(a)&&o(c)){var l=t.nodeValue;l.length&&o(l.charAt(0))&&(e.nodeValue=n.slice(0,r)+"‚Äî"+n.slice(r+1))}}}}}function h(e,t){try{if("text/html"!==(e.getAttribute("type")||"").toLowerCase())return;var n=e.text||e.textContent||"";if(!n)return;var o=document.createElement("div");o.innerHTML=n,t(o);var r=o.innerHTML;e.text=r,e.textContent=r}catch(e){}}function g(e){var t=null,n=!1;!function w(y){for(var v=y.firstChild;v;v=v.nextSibling)if(3===v.nodeType){var b=v.nodeValue;if(r(b)){t&&(n=!0);continue}b=b.replace(a,"$1‚Äî");var S=!t||n||t&&t.nodeValue.length&&o(t.nodeValue.charAt(t.nodeValue.length-1)),x=u(b);if(S&&-1!==x&&i(b.charAt(x)))o(x+1<b.length?b.charAt(x+1):"")&&(b=b.slice(0,x)+"‚Äî"+b.slice(x+1));if(v.nodeValue=b,t){var k=t.nodeValue,C=b.length&&o(b.charAt(0));if(s.test(k)){var _=d(k);if(-1!==_){var E=k.charAt(_),$=_>0?k.charAt(_-1):"";i(E)&&o($)&&(C||n)&&(t.nodeValue=k.slice(0,_)+"‚Äî"+k.slice(_+1))}}}t=v,n=!1}else if(1===v.nodeType){var F=v.nodeName.toUpperCase();if("SCRIPT"===F&&m(v)){h(v,g),t=null,n=!1;continue}if(l[F]){t=null,n=!1;continue}if("BR"===F){t=null,n=!1;continue}if(c[F]&&v!==e)g(v),t=null,n=!1;else{if(t){var I=p(v);I&&f(t,I)}w(v)}}}(e)}return this.each(function(){g(this)})},$(function(){$(".post-content").fixDashes()}),(()=>{const e=new Promise(e=>{"complete"===document.readyState||"interactive"===document.readyState?e():document.addEventListener("DOMContentLoaded",e,{once:!0})});(async()=>{try{await e;Number(document.body?.dataset?.groupId||NaN);const t=window.GroupID?Number(window.GroupID):null,n=[...window.PROFILE_CHECK?.GroupID||[],...window.CHRONO_CHECK?.GroupID||[]],o=[...window.PROFILE_CHECK?.ForumID||[],...window.CHRONO_CHECK?.ForumID||[],...window.CHRONO_CHECK?.AmsForumID||[]],r=n.includes(t),i=document.querySelector(".container.crumbs"),a=i&&Array.from(i.querySelectorAll("a[href]")).some(e=>{try{const t=new URL(e.getAttribute("href"),location.href),n=t.searchParams.get("id"),r=!!n&&o.includes(Number(n));return t.pathname.endsWith("/viewforum.php")&&r}catch{return!1}});if(!r||!a)return;let s=document.querySelectorAll(".topicpost .post-body .post-box .post-content");if(!s.length)try{await FMV.waitForSelector(".topicpost .post-body .post-box .post-content",5e3),s=document.querySelectorAll(".topicpost .post-body .post-box .post-content")}catch{return}const c=s[s.length-1];if(!c||c.querySelector(".ams_info"))return;const l=document.createElement("div");l.className="ams_info",l.textContent="",c.appendChild(document.createElement("br")),c.appendChild(l),window.__ams_ready=!0,window.dispatchEvent(new CustomEvent("ams:ready",{detail:{node:l}})),"function"==typeof window.__amsReadyResolve&&window.__amsReadyResolve(l)}catch(e){console.log("[AMS injector] error:",e)}})()})(),function(){async function e(e){if(navigator.clipboard&&window.isSecureContext)try{return await navigator.clipboard.writeText(e),!0}catch(e){}return function(){try{return document.execCommand&&document.execCommand("copy")}catch(e){return!1}}()}let t=null;function n(){try{const e=window.getSelection&&window.getSelection();e&&e.removeAllRanges&&e.removeAllRanges(),document.selection&&document.selection.empty&&document.selection.empty()}catch(e){}try{document.activeElement&&document.activeElement!==document.body&&document.activeElement.blur()}catch(e){}const e=document.body,t=e.style.userSelect,n=e.style.webkitUserSelect;e.style.userSelect="none",e.style.webkitUserSelect="none",e.offsetHeight,e.style.userSelect=t,e.style.webkitUserSelect=n}function o(e){(function(e){return!!t&&!t.contains(e)})(e.target||e.srcElement)&&(t=null,n())}function r(n){!function(e){let t=e.querySelector(".legend");if(t||(t=document.createElement("strong"),t.className="legend",e.insertBefore(t,e.firstChild)),!t.dataset.copyReady){if(!t.querySelector(".code-copy")){let e=(t.textContent||"").trim();e&&!/^–∫–æ–¥:?\s*$/i.test(e)||(e="–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥"),t.textContent="";const n=document.createElement("button");n.type="button",n.className="code-copy",n.textContent=e,t.appendChild(n)}t.dataset.copyReady="1"}}(n),n.__armed||(n.__armed=!0,n.addEventListener("click",async function(o){if(!(o.target.closest&&o.target.closest(".code-copy, .legend")||null))return;o.preventDefault(),o.stopPropagation();const r=n.querySelector("pre");r&&(!function(e){try{var t=document.createRange();t.selectNodeContents(e);var n=window.getSelection();n.removeAllRanges(),n.addRange(t)}catch(e){}}(r),function(e){t=e||null}(r),await e(function(e){return(e&&(e.innerText||e.textContent)||"").replace(/\s+$/,"")}(r)))},!0))}function i(e){var t,n;(t=".code-box",n=e,Array.prototype.slice.call((n||document).querySelectorAll(t))).forEach(r)}i(),document.addEventListener("pun_main_ready",function(){i()}),new MutationObserver(function(e){e.forEach(function(e){(e.addedNodes||[]).forEach(function(e){1===e.nodeType&&(e.matches&&e.matches(".code-box")&&r(e),e.querySelectorAll&&e.querySelectorAll(".code-box").forEach(r))})})}).observe(document.body,{childList:!0,subtree:!0}),window.addEventListener("pointerdown",o,!0),document.addEventListener("mousedown",o,!0),document.addEventListener("click",o,!0),document.addEventListener("touchstart",o,!0),document.addEventListener("focusin",o,!0),document.addEventListener("scroll",function(){t&&(t=null,n())},!0),document.addEventListener("selectionchange",function(){if(!t)return;const e=window.getSelection&&window.getSelection();if(!e||!e.rangeCount||e.isCollapsed)return void(t=null);const o=e.anchorNode;o&&!t.contains(o)&&(t=null,n())},!0),document.addEventListener("visibilitychange",function(){"hidden"===document.visibilityState&&(t=null,n())},!0),window.addEventListener("blur",function(){t&&(t=null,n())},!0)}(),function(){"use strict";async function e(e,t,n=null){if(console.log("[admin_bridge_json] üî• –°–û–•–†–ê–ù–ï–ù–ò–ï –î–õ–Ø userId:",e),console.log("[admin_bridge_json] üî• skinData:",JSON.parse(JSON.stringify(t))),!window.FMVbank||"function"!=typeof window.FMVbank.storageGet||"function"!=typeof window.FMVbank.storageSet)return console.error("[admin_bridge_json] FMVbank.storageGet –∏–ª–∏ storageSet –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"),!1;const o=(()=>{const e=new Date,t=e.getTimezoneOffset(),n=new Date(e.getTime()+6e4*(180+t));return`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}-${String(n.getDate()).padStart(2,"0")}`})();try{console.log("[admin_bridge_json] üì• –ó–∞–≥—Ä—É–∂–∞—é —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ API...");const r=await window.FMVbank.storageGet(e,"skin_"),i=r&&"object"==typeof r?r:{};if(console.log("[admin_bridge_json] üì• –¢–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ API:",JSON.parse(JSON.stringify(i))),null!==n){const e=i.last_timestamp||null;if(console.log("[admin_bridge_json] üïê –ü—Ä–æ–≤–µ—Ä–∫–∞ timestamp: initial="+n+", current="+e),null!==e&&e!==n)return alert("–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –∑–∞ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±—ã–ª–∏ –∏–∑–º–µ–Ω–µ–Ω—ã. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ç–∫—Ä–æ–π—Ç–µ –Ω–æ–≤—É—é –≤–∫–ª–∞–¥–∫—É –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–Ω–æ–≤–∞."),console.error("[admin_bridge_json] ‚ùå –ö–æ–Ω—Ñ–ª–∏–∫—Ç: –¥–∞–Ω–Ω—ã–µ –±—ã–ª–∏ –∏–∑–º–µ–Ω–µ–Ω—ã –¥—Ä—É–≥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º"),!1}const a=i.comment_id;if(!a)return alert("–£–∫–∞–∂–∏—Ç–µ id –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è –¥–ª—è —é–∑–µ—Ä–∞."),console.error("[admin_bridge_json] ‚ùå comment_id –Ω–µ —É–∫–∞–∑–∞–Ω"),!1;console.log("[admin_bridge_json] ‚úÖ comment_id:",a);const s=["icon","plashka","background","gift","coupon"];for(const e of s){let n=t[e]||[];if("coupon"===e){const e=n.length;n=n.filter(e=>!(e.expired_date&&e.expired_date<o)||(console.log(`[admin_bridge_json] –£–¥–∞–ª—ë–Ω –∏—Å—Ç–µ–∫—à–∏–π –∫—É–ø–æ–Ω: ${e.id}, expired_date=${e.expired_date} < ${o}`),!1));const t=n.length;e!==t&&console.log(`[admin_bridge_json] üóëÔ∏è –ö—É–ø–æ–Ω—ã: —É–¥–∞–ª–µ–Ω–æ ${e-t} –∏—Å—Ç–µ–∫—à–∏—Ö`)}console.log("[admin_bridge_json] üì¶ "+e+": "+n.length+" —ç–ª–µ–º–µ–Ω—Ç–æ–≤"),i[e]=n}i.last_timestamp=Math.floor(Date.now()/1e3),console.log("[admin_bridge_json] üíæ –§–∏–Ω–∞–ª—å–Ω—ã–π –æ–±—ä–µ–∫—Ç –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:",JSON.parse(JSON.stringify(i))),console.log("[admin_bridge_json] üìù –û–±–Ω–æ–≤–ª—è—é –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π #"+a);const c=await async function(e,t,n){return new Promise((o,r)=>{try{const i={...n},a=["icon","plashka","background","gift","coupon"];for(const e of a){const t=n[e]||[];i[e]=t.map(e=>{const t={...e};return delete t.content,t})}const s=JSON.stringify(i),c=window.SITE_URL+"/profile.php?id="+t+'\n[media="–ª–æ–≥"]'+s+"[/media]",l="/edit.php?id="+e;console.log("[admin_bridge_json] üåê –°–æ–∑–¥–∞—ë–º iframe –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è:",l);const d=document.createElement("iframe");d.style.display="none",d.src=l,document.body.appendChild(d);const u=setTimeout(()=>{d.remove(),r(new Error("–¢–∞–π–º–∞—É—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è (10 —Å–µ–∫—É–Ω–¥)"))},1e4);let p=0;d.onload=function(){if(p++,console.log("[admin_bridge_json] iframe onload #"+p),1!==p)2===p&&(console.log("[admin_bridge_json] ‚úÖ –§–æ—Ä–º–∞ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞, –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ–±–Ω–æ–≤–ª—ë–Ω"),clearTimeout(u),d.remove(),o(!0));else try{const e=d.contentDocument||d.contentWindow.document,t=e.querySelector('textarea[name="req_message"]'),n=e.querySelector('input[type="submit"][name="submit"]');if(!t||!n)return clearTimeout(u),d.remove(),void r(new Error("–§–æ—Ä–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"));t.value=c,console.log("[admin_bridge_json] üìù –î–∞–Ω–Ω—ã–µ –≤—Å—Ç–∞–≤–ª–µ–Ω—ã –≤ —Ñ–æ—Ä–º—É, –¥–ª–∏–Ω–∞:",c.length),console.log("[admin_bridge_json] üì§ –ù–∞–∂–∏–º–∞—é –∫–Ω–æ–ø–∫—É –æ—Ç–ø—Ä–∞–≤–∫–∏"),n.click()}catch(e){clearTimeout(u),d.remove(),r(e)}},d.onerror=function(){clearTimeout(u),d.remove(),r(new Error("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è"))}}catch(e){console.error("[admin_bridge_json] –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è:",e),r(e)}})}(a,e,i);if(!c)return console.error("[admin_bridge_json] ‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π"),!1;console.log("[admin_bridge_json] ‚úÖ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª—ë–Ω");return await window.FMVbank.storageSet(i,e,"skin_")?(console.log("[admin_bridge_json] ‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ API"),!0):(console.error("[admin_bridge_json] ‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ API"),!1)}catch(e){return console.error("[admin_bridge_json] –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:",e),!1}}window.skinAdmin={load:async function(t,n){const o=await async function(e){try{const t=`/pages/usr${e}`,n=await fetch(t);if(!n.ok)return console.error(`[admin_bridge_json] –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å ${t}`),Number(e);const o=await n.text(),r=(new DOMParser).parseFromString(o,"text/html").querySelector(".modal_script");if(!r)return console.warn(`[admin_bridge_json] .modal_script –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ ${t}, –∏—Å–ø–æ–ª—å–∑—É–µ–º profileId=${e}`),Number(e);const i=r.getAttribute("data-main-user_id");return i&&i.trim()?Number(i.trim()):Number(e)}catch(t){return console.error("[admin_bridge_json] –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:",t),Number(e)}}(t);if(!o)return{status:"error",visibleData:{},chrono:{},comment_id:null,save:null,targetUserId:null};const{data:r,chrono:i,comment_id:a,last_timestamp:s}=await async function(e){const t={icon:[],plashka:[],background:[],gift:[],coupon:[]};let n={},o=null,r=null;if(!window.FMVbank||"function"!=typeof window.FMVbank.storageGet)return console.error("[admin_bridge_json] FMVbank.storageGet –Ω–µ –Ω–∞–π–¥–µ–Ω"),{data:t,chrono:n,comment_id:o,last_timestamp:r};const i=(()=>{const e=new Date,t=e.getTimezoneOffset(),n=new Date(e.getTime()+6e4*(180+t));return`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}-${String(n.getDate()).padStart(2,"0")}`})();try{const a=await window.FMVbank.storageGet(e,"skin_");if(!a||"object"!=typeof a)return console.warn("[admin_bridge_json] –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –≤ API –¥–ª—è userId="+e),{data:t,chrono:n,comment_id:o,last_timestamp:r};n=a.chrono||{},o=a.comment_id||null,r=a.last_timestamp||null;const s=["icon","plashka","background","gift","coupon"];for(const e of s){const n=a[e]||[];Array.isArray(n)&&n.forEach(n=>{"coupon"===e&&n.expired_date&&n.expired_date<i?console.log(`[admin_bridge_json] –ü—Ä–æ–ø—É—â–µ–Ω –∏—Å—Ç–µ–∫—à–∏–π –∫—É–ø–æ–Ω: ${n.id}, expired_date=${n.expired_date} < ${i}`):t[e].push(n)})}}catch(e){console.error("[admin_bridge_json] –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:",e)}return{data:t,chrono:n,comment_id:o,last_timestamp:r}}(o);return{status:"ok",visibleData:r,chrono:i,comment_id:a,save:async function(t){const n=await e(o,t,s);return{ok:n,status:n?"—É—Å–ø–µ—à–Ω–æ":"–æ—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è"}},targetUserId:o}}}}();const DEBUG=!1,log=(...e)=>{false};function isProfileFieldsPage(){try{const e=new URL(location.href);return/\/profile\.php$/i.test(e.pathname)&&"fields"===e.searchParams.get("section")&&/^\d+$/.test(e.searchParams.get("id")||"")}catch{return!1}}function getProfileId(){return new URL(location.href).searchParams.get("id")||""}async function getUserIdFromPage(e){try{const t=`/pages/usr${e}`,n=await fetch(t);if(!n.ok)return console.error("[get_skin_api] –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å",t),Number(e);const o=await n.text(),r=new DOMParser,i=r.parseFromString(o,"text/html").querySelector(".modal_script");if(!i)return log(),Number(e);const a=i.getAttribute("data-main-user_id");return a&&a.trim()?(log(),Number(a.trim())):Number(e)}catch(t){return console.error("[get_skin_api] –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:",t),Number(e)}}async function loadSkinsFromAPI(e){if(log(),!window.FMVbank||"function"!=typeof window.FMVbank.storageGet)return console.error("[get_skin_api] FMVbank.storageGet –Ω–µ –Ω–∞–π–¥–µ–Ω"),{icons:[],plashki:[],backs:[]};const t={icons:[],plashki:[],backs:[]};try{const n=await window.FMVbank.storageGet(e,"skin_");if(log(),!n||"object"!=typeof n)return log(),t;const o={icon:"icons",plashka:"plashki",background:"backs"};for(const[e,r]of Object.entries(o)){const o=n[e];Array.isArray(o)?(t[r]=o.map(e=>e.content||"").filter(Boolean),log(o.length)):log()}}catch(e){console.error("[get_skin_api] –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:",e)}return log(),t}async function collectSkinSets(){if(log(),!isProfileFieldsPage())return log(),{icons:[],plashki:[],backs:[]};const e=getProfileId();log();const t=await getUserIdFromPage(e);log();const n=await loadSkinsFromAPI(t);return log(),n}async function pageExistsViaEditEndpoint(e){const t=`/admin_pages.php?edit_page=${encodeURIComponent(e)}`,n=await fetchCP1251Doc(t),o=(n.querySelector("title")?.textContent||"").trim(),r=(n.querySelector("h1, .pagetitle, .tclcon h2")?.textContent||"").trim(),i=/–°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–æ–∑–¥–∞–Ω–∞/i.test(o),a=!!n.querySelector('input[name="edit_page"]'),s=!![...n.querySelectorAll('input[type="submit"],button[type="submit"]')].find(e=>/—Å–æ—Ö—Ä–∞–Ω/i.test(e.value||e.textContent||""));/–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è/i.test(o)||/–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è/i.test(r);return!!(i||a||s)}function extractInfoMessage(e){const t=(new DOMParser).parseFromString(e,"text/html"),n=(t.querySelector("title")?.textContent||"").trim();return(n?`[${n}] `:"")+([...t.querySelectorAll(".message, .msg, .infobox, .warn, .error, #pun-main p, .block p, .box p")].map(e=>e.textContent.trim()).filter(Boolean).join("\n").trim()||"").trim()}function classifyResult(e){const t=extractInfoMessage(e).toLowerCase();return/—É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç|–∑–∞–Ω—è—Ç–æ|–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å/.test(t)?{status:"duplicate",msg:t}:/—Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–æ–∑–¥–∞–Ω–∞|–¥–æ–±–∞–≤–ª–µ–Ω|—É—Å–ø–µ—à–Ω–æ|—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞/.test(t)?{status:"created",msg:t}:/–æ—à–∏–±–∫–∞|forbidden|–Ω–µ—Ç –ø—Ä–∞–≤|–Ω–µ —É–¥–∞–ª–æ—Å—å|–Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç|–∑–∞–ø–æ–ª–Ω–∏—Ç–µ/.test(t)?{status:"error",msg:t}:{status:"unknown",msg:t}}async function FMVcreatePersonalPage(e,t,n,o,r,i){const a="/admin_pages.php?action=adddel";try{if(await pageExistsViaEditEndpoint(t))return{status:"exists",title:e,name:t,serverMessage:`–°—Ç—Ä–∞–Ω–∏—Ü–∞ "${t}" —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç (–¥–æ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã).`,url:`/admin_pages.php?edit_page=${encodeURIComponent(t)}`};const s=await fetchCP1251Doc(a),c=[...s.querySelectorAll("form")].find(e=>(e.action||"").includes("/admin_pages.php"))||s.querySelector('form[action*="admin_pages.php"]');if(!c)return{status:"error",title:e,name:t,serverMessage:"–§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞",details:"admin_pages.php –±–µ–∑ —Ñ–æ—Ä–º—ã"};(c.querySelector('[name="title"]')||{}).value=e,(c.querySelector('[name="name"]')||{}).value=t,(c.querySelector('[name="content"]')||{}).value=n;const l=c.querySelector('[name="tags"]');l&&(l.value=o);const d=c.querySelector('select[name="announcement"]');d?d.value=i:[...c.querySelectorAll('input[name="announcement"]')].forEach(e=>e.checked=e.value===i);for(const e of r){const t=c.querySelector(`[name="group[${e}]"]`);t&&(t.checked=!0)}let u="add_page";const p=[...c.elements].find(e=>"submit"===e.type&&("add_page"===e.name||/—Å–æ–∑–¥–∞—Ç—å/i.test(e.value||"")));p?.name&&(u=p.name);const m=serializeFormCP1251_SelectSubmit(c,u),{res:f,text:h}=await fetchCP1251Text(a,{method:"POST",credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded"},referrer:a,referrerPolicy:"strict-origin-when-cross-origin",body:m}),g=classifyResult(h),w=extractInfoMessage(h)||"",y=await pageExistsViaEditEndpoint(t);return"created"===g.status||y?(console.log(w||"–°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–æ–∑–¥–∞–Ω–∞"),{status:"created",title:e,name:t,serverMessage:w||"–°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–æ–∑–¥–∞–Ω–∞",httpStatus:f.status,url:`/admin_pages.php?edit_page=${encodeURIComponent(t)}`}):"duplicate"===g.status?(console.log(w||"–£–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å —Ç–∞–∫–∏–º –∞–¥—Ä–µ—Å–Ω—ã–º –∏–º–µ–Ω–µ–º"),{status:"exists",title:e,name:t,serverMessage:w||"–£–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å —Ç–∞–∫–∏–º –∞–¥—Ä–µ—Å–Ω—ã–º –∏–º–µ–Ω–µ–º",httpStatus:f.status,url:`/admin_pages.php?edit_page=${encodeURIComponent(t)}`}):"error"===g.status?(console.log(g.msg||w||"–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏"),{status:"error",title:e,name:t,serverMessage:g.msg||w||"–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏",httpStatus:f.status}):(console.log(w||"–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–¥–º–∏–Ω–∫—É."),{status:"uncertain",title:e,name:t,serverMessage:w||"–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–¥–º–∏–Ω–∫—É.",httpStatus:f.status})}catch(e){const t=e&&e.message?e.message:String(e),n=new Error("Transport/Runtime error: "+t);throw n.cause=e,console.log(t),n}}async function FMVeditPersonalPage(e,t={}){if(!e)throw new Error('FMVeditPersonalPage: "name" is required');const n=`/admin_pages.php?edit_page=${encodeURIComponent(e)}`,o=await("function"==typeof fetchCP1251Doc?fetchCP1251Doc(n):(async()=>{const e=await fetch(n,{credentials:"include"}).then(e=>e.text());return(new DOMParser).parseFromString(e,"text/html")})()),r=(o.body&&o.body.textContent||"").trim();if(/–°—Å—ã–ª–∫–∞, –ø–æ –∫–æ—Ç–æ—Ä–æ–π –í—ã –ø—Ä–∏—à–ª–∏, –Ω–µ–≤–µ—Ä–Ω–∞—è –∏–ª–∏ —É—Å—Ç–∞—Ä–µ–≤—à–∞—è\./i.test(r))return{status:"forbidden",serverMessage:"–°—Å—ã–ª–∫–∞ –Ω–µ–≤–µ—Ä–Ω–∞—è –∏–ª–∏ —É—Å—Ç–∞—Ä–µ–≤—à–∞—è",url:n};const i=[...o.querySelectorAll("form")].find(e=>(e.action||"").includes("admin_pages.php"))||o.querySelector("form");if(!i)return{status:"notfound",serverMessage:"–§–æ—Ä–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞",url:n};if(null!=t.title){const e=i.querySelector('[name="title"]');e&&(e.value=String(t.title))}if(null!=t.content){const e=i.querySelector('#page-content,[name="content"]');e&&(e.value=String(t.content))}if(null!=t.announcement){const e=i.querySelector('select[name="announcement"]');if(e)e.value=String(t.announcement);else{const e=[...i.querySelectorAll('input[name="announcement"]')];e.length&&e.forEach(e=>e.checked=e.value==t.announcement)}}if(null!=t.tags){const e=i.querySelector('[name="tags"]');e&&(e.value=String(t.tags))}if(Array.isArray(t.groupsOn))for(const e of t.groupsOn){const t=i.querySelector(`[name="group[${e}]"]`);t&&(t.checked=!0)}if(Array.isArray(t.groupsOff))for(const e of t.groupsOff){const t=i.querySelector(`[name="group[${e}]"]`);t&&(t.checked=!1)}let a="save";const s=[...i.elements].find(e=>"submit"===e.type&&("save"===e.name||/—Å–æ—Ö—Ä|save/i.test(e.value||e.textContent||"")));let c,l;s?.name&&(a=s.name);const d=new URL(i.getAttribute("action")||n,location.origin).toString();if("function"==typeof serializeFormCP1251_SelectSubmit&&"function"==typeof fetchCP1251Text){const e=serializeFormCP1251_SelectSubmit(i,a);({res:c,text:l}=await fetchCP1251Text(d,{method:"POST",credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=windows-1251"},referrer:n,referrerPolicy:"strict-origin-when-cross-origin",body:e}))}else{const e=new FormData(i);e.append(a,s?.value||"1"),c=await fetch(d,{method:"POST",credentials:"include",body:e}),l=await c.text()}const u=/–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ|—É—Å–ø–µ—à–Ω|–∏–∑–º–µ–Ω–µ–Ω–∏[—è–π]\s+—Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã/i.test(l),p=("function"==typeof extractInfoMessage?extractInfoMessage(l):"")||"",m=c.ok&&c.url&&/\/admin_pages\.php(?:\?|$)/.test(c.url)&&!/–æ—à–∏–±–∫|forbidden|–Ω–µ—Ç –ø—Ä–∞–≤|—É—Å—Ç–∞—Ä–µ–≤—à/i.test((l||"").toLowerCase()),f=/–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏[–µ—è]\s*[‚Äì-]\s*–°—Ç—Ä–∞–Ω–∏—Ü[—ã—å]/i.test(l)||/–°–ø–∏—Å–æ–∫\s+–ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö\s+—Å—Ç—Ä–∞–Ω–∏—Ü/i.test(l);if(c.ok&&(u||m||f))return{status:"saved",serverMessage:p||"–ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã",httpStatus:c.status,url:n};let h={status:"unknown",msg:p};if("function"==typeof classifyResult)try{h=classifyResult(l)}catch{}return/–æ—à–∏–±–∫|forbidden|–Ω–µ—Ç –ø—Ä–∞–≤|—É—Å—Ç–∞—Ä–µ–≤—à/i.test((p||h.msg||"").toLowerCase())?{status:"forbidden",serverMessage:p||h.msg||"–ù–µ—Ç –ø—Ä–∞–≤/–æ—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è",httpStatus:c.status,url:n}:{status:"error",serverMessage:p||"–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è",httpStatus:c.status,url:n}}async function FMVeditTextareaOnly(e,t){return FMVeditPersonalPage(e,{content:t})}async function fetchAllLibraries(){const e=(...e)=>{false};if(e(),!window.FMVbank||"function"!=typeof window.FMVbank.storageGet)return console.error("[fetchAllLibraries] FMVbank.storageGet –Ω–µ –Ω–∞–π–¥–µ–Ω"),{plashka:[],icon:[],back:[],gift:[],coupon:[]};function t(e){return String(e||"").replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}const n={plashka:[],icon:[],back:[],gift:[],coupon:[]},o=["icon","plashka","background","gift","coupon"];for(const r of o)try{const o=await window.FMVbank.storageGet(1,`library_${r}_`);if(!o||!o.items||!Array.isArray(o.items)){e();continue}const i=!0===window.IS_ADMIN||!0===window.IS_ADMIN_TO_EDIT;if("coupon"===r)n.coupon=o.items.map(e=>{const n=e.t?` title="${t(e.t)}"`:"",o=e.s_t?` data-coupon-title="${t(e.s_t)}"`:"",r=e.type?` data-coupon-type="${t(e.type)}"`:"",i=e.f?` data-coupon-form="${t(e.f)}"`:"",a=void 0!==e.v?` data-coupon-value="${t(String(e.v))}"`:"";return{id:e.id,html:`<div class="item" data-id="${t(e.id)}"${n}${o}${r}${i}${a}>${e.content||""}</div>`}});else{const e=(i?o.items:o.items.filter(e=>1!==e.h)).map(e=>({id:e.id,html:`<div class="item" data-id="${t(e.id)}" title="${t(e.t||"")}">${e.content||""}</div>`}));n["background"===r?"back":r]=e}}catch(e){console.error(`[fetchAllLibraries] –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ ${r}:`,e)}return n}!function(){const e=".modal_script[data-id]",t=(...e)=>false,n={icon:"._icon",plashka:"._plashka",background:"._background",gift:"._gift",coupon:"._coupon"};function o(e){return String(e||"").replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function r(e){return e.closest(".modal_wrap, .reveal-modal, .container, #character")||e.parentElement||document}async function i(i){if(!i)return;if(!window.FMVbank||"function"!=typeof window.FMVbank.storageGet)return void console.warn("[collect_skins_api] FMVbank.storageGet –Ω–µ –Ω–∞–π–¥–µ–Ω");const a=i.querySelector(e)||document.querySelector(e);if(!a)return;const s=r(a);!function(t){const o=t.querySelector(e);o&&Object.values(n).forEach(e=>{const n=t.querySelector(e);n&&n.parentElement!==o&&o.appendChild(n)})}(s);const c=function(e){if(!e)return null;const t=e.getAttribute("data-main-user_id");if(t&&t.trim()){return Number(t.trim())}const n=e.getAttribute("data-id");if(n&&n.trim()){return Number(n.trim())}return null}(a);if(!c)return;const l=await async function(e){if(!window.FMVbank||"function"!=typeof window.FMVbank.storageGet)return console.error("[collect_skins_api] FMVbank.storageGet –Ω–µ –Ω–∞–π–¥–µ–Ω"),null;const t={icon:[],plashka:[],background:[],gift:[],coupon:[]};try{const n=await window.FMVbank.storageGet(e,"skin_");return n&&"object"==typeof n?(["icon","plashka","background","gift","coupon"].forEach(e=>{const o=n[e];if(Array.isArray(o)){const n=o.filter(e=>!1!==e.is_visible);t[e]=n,n.length,o.length}else t[e]=[]}),t):t}catch(e){return console.error("[collect_skins_api] –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:",e),t}}(c);l&&function(e,r){for(const[i,a]of Object.entries(n)){const n=e.querySelector(a);if(!n){t();continue}const s=r[i]||[];if(0===s.length){t(),n.innerHTML="";continue}const c=s.map(e=>{const t=[`data-id="${o(e.id)}"`,`title="${o(e.title||"")}"`];return Object.keys(e).forEach(n=>{if("id"!==n&&"title"!==n&&"content"!==n&&"is_visible"!==n){const r="data-"+n.replace(/_/g,"-");t.push(`${r}="${o(e[n]||"")}"`)}}),`<div class="item" ${t.join(" ")}>${e.content||""}</div>`}).join("\n");n.innerHTML=c,t(s.length)}}(s,l)}window.loadUserSkinsFromApi=function({root:e,rootSelector:t}={}){i(e||(t?document.querySelector(t):document))},document.addEventListener("DOMContentLoaded",()=>{i(document)});const a=new WeakSet;new MutationObserver(t=>{t.forEach(t=>{t.addedNodes&&t.addedNodes.forEach(t=>{t instanceof Element&&(t.matches&&t.matches(e)&&!a.has(t)&&(a.add(t),i(r(t))),t.querySelectorAll&&t.querySelectorAll(e).forEach(e=>{a.has(e)||(a.add(e),i(r(e)))}))})})}).observe(document.documentElement,{childList:!0,subtree:!0})}(),function(){const e=".modal_script[data-id]",t=".chrono_info";function n(){if(!window.FMVbank||"function"!=typeof window.FMVbank.storageGet)throw new Error("FMVbank –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Äî –ø–æ–¥–∫–ª—é—á–∏—Ç–µ src/bank/api.js")}function o(e){return e.closest(".modal_wrap, .reveal-modal, .container, #character")||e.parentElement||document}async function r(e,o){const r=o.querySelector(t);if(!r)return;r.innerHTML="<p>–ó–∞–≥—Ä—É–∑–∫–∞ —Ö—Ä–æ–Ω–æ–ª–æ–≥–∏–∏...</p>";const i=await async function(e){n();try{const t=await window.FMVbank.storageGet(Number(e),"chrono_");return t&&"object"==typeof t&&t.chrono?(t.chrono,t.chrono):null}catch(t){return console.error(`[collect_api] –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –¥–ª—è userId ${e}:`,t),null}}(e);if(!i)return void(r.innerHTML="<p>–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Ö—Ä–æ–Ω–æ–ª–æ–≥–∏–∏</p>");const a=function(e){if(!e||"object"!=typeof e)return"<p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö —Ö—Ä–æ–Ω–æ–ª–æ–≥–∏–∏</p>";if(window.FMV&&"function"==typeof window.FMV.buildChronoHtml)try{return window.FMV.buildChronoHtml(e,{titlePrefix:"–•—Ä–æ–Ω–æ–ª–æ–≥–∏—è"})}catch(e){console.error("[collect_api] –û—à–∏–±–∫–∞ FMV.buildChronoHtml:",e)}const t=Object.entries(e);if(0===t.length)return"<p>–•—Ä–æ–Ω–æ–ª–æ–≥–∏—è –ø—É—Å—Ç–∞</p>";let n='<div class="chrono-data">';for(const[e,o]of t)n+=`<div><strong>${e}:</strong> ${JSON.stringify(o)}</div>`;return n+="</div>",n}(i);a.length,function(e,t){e&&(e.innerHTML=t)}(r,a)}async function i(i){if(!i)return;try{n()}catch(e){return void console.warn("[collect_api]",e.message)}const a=i.querySelector(e)||document.querySelector(e);if(!a)return;const s=o(a);!function(n){const o=n.querySelector(e);if(!o)return;const r=n.querySelector(t);r&&r.parentElement!==o&&o.appendChild(r)}(s);const c=a.getAttribute("data-id")?.trim();c&&await r(c,s)}window.loadUserChronoFromApi=function({root:e,rootSelector:t}={}){i(e||(t?document.querySelector(t):document))},document.addEventListener("DOMContentLoaded",()=>{i(document)});const a=new WeakSet;new MutationObserver(t=>{t.forEach(t=>{t.addedNodes&&t.addedNodes.forEach(t=>{t instanceof Element&&(t.matches&&t.matches(e)&&!a.has(t)&&(a.add(t),i(o(t))),t.querySelectorAll&&t.querySelectorAll(e).forEach(e=>{a.has(e)||(a.add(e),i(o(e)))}))})})}).observe(document.documentElement,{childList:!0,subtree:!0})}(),(()=>{"use strict";const e=(...e)=>{false};if(!(window.PROFILE_CHECK&&window.PROFILE_CHECK.GroupID&&window.SKIN&&window.PROFILE_CHECK.ForumID&&window.SKIN.LogFieldID))return void console.warn("[button_create_storage] –¢—Ä–µ–±—É–µ—Ç—Å—è window.PROFILE_CHECK —Å GroupID, ForumID –∏ window.SKIN —Å LogFieldID");const t=window.PROFILE_CHECK.GroupID.map(Number),n=window.SKIN.LogFieldID,o=window.PROFILE_CHECK.ForumID||[];async function r(t,o,r,i){try{o("–ü—Ä–æ–≤–µ—Ä—è—é..."),r(""),i&&i("");const a=window.SITE_URL||window.location.origin,s=await async function(t){if(!window.FMVbank||"function"!=typeof window.FMVbank.storageGet)throw new Error("FMVbank.storageGet –Ω–µ –Ω–∞–π–¥–µ–Ω");try{const e=await window.FMVbank.storageGet(t,"skin_");return e&&"object"==typeof e?{skinExists:!0,commentId:e.comment_id||null,data:e,error:!1}:{skinExists:!1,commentId:null,data:null,error:!1}}catch(t){return e(),{skinExists:!1,commentId:null,data:null,error:!0}}}(t);if(!s.error&&s.skinExists&&s.commentId){if(o("‚úì —É–∂–µ —É–∫–∞–∑–∞–Ω–æ","green"),r(`–•—Ä–∞–Ω–∏–ª–∏—â–µ —É–∂–µ —Å–æ–∑–¥–∞–Ω–æ (comment_id: ${s.commentId})`),i){i(`${a}/viewtopic.php?id=${n}#p${s.commentId}`)}return}o("–ü—Ä–æ–≤–µ—Ä—è—é —Å—Ç—Ä–∞–Ω–∏—Ü—É...");const c=await async function(e){try{const t=`/pages/usr${e}`,n=await fetch(t);if(!n.ok)return{valid:!1,error:`HTTP ${n.status}`,isTwink:!1};const o=await n.text(),r=(new DOMParser).parseFromString(o,"text/html"),i=r.querySelector(".info .container");if(i&&/–Ω–µ–≤–µ—Ä–Ω–∞—è –∏–ª–∏ —É—Å—Ç–∞—Ä–µ–≤—à–∞—è/i.test(i.textContent))return{valid:!1,error:"–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ —à–∞–±–ª–æ–Ω—É.",isTwink:!1};const a=r.querySelector(".modal_script");if(!a)return{valid:!1,error:"–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ —à–∞–±–ª–æ–Ω—É.",isTwink:!1};const s=a.getAttribute("data-main-user_id");if(null!==s){const e=s.trim();return e&&"–£–ë–†–ê–¢–¨ –ï–°–õ–ò –ù–ï –ù–£–ñ–ù–û"!==e&&/^\d+$/.test(e)?{valid:!1,error:"–≠—Ç–æ —Ç–≤–∏–Ω–∫, –µ–º—É –Ω–µ –Ω—É–∂–Ω–æ –æ—Ç–¥–µ–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ",isTwink:!0}:{valid:!1,error:"–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ —à–∞–±–ª–æ–Ω—É.",isTwink:!1}}return{valid:!0,error:null,isTwink:!1}}catch(e){return{valid:!1,error:`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã: ${e.message}`,isTwink:!1}}}(t);if(!c.valid)return c.isTwink?o("‚úñ –æ—à–∏–±–∫–∞","red"):o("‚úñ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞","red"),void r(c.error);o("–°–æ–∑–¥–∞—é –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π...");const l=await async function(t){return new Promise((o,r)=>{const i="/viewtopic.php?id="+n,a=window.SITE_URL+"/profile.php?id="+t;e();const s=document.createElement("iframe");s.style.display="none",s.src=i,document.body.appendChild(s);let c=0;const l=setTimeout(()=>{s.remove(),r(new Error("–¢–∞–π–º–∞—É—Ç —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è (15 —Å–µ–∫—É–Ω–¥)"))},15e3);s.onload=function(){if(c++,e(),1!==c){if(2===c){e();try{const t=(s.contentDocument||s.contentWindow.document).querySelectorAll('div.post[id^="p"]');if(e(t.length),t.length>0){const n=t[t.length-1].id;e();const r=n.match(/^p(\d+)$/);if(r){const t=Number(r[1]);return e(),clearTimeout(l),s.remove(),void o(t)}}try{const t=s.contentWindow.location.href;e();const n=t.match(/[?&]pid=(\d+)/);if(n){const t=Number(n[1]);return e(),clearTimeout(l),s.remove(),void o(t)}const r=t.match(/#p(\d+)/);if(r){const t=Number(r[1]);return e(),clearTimeout(l),s.remove(),void o(t)}}catch(t){e(t.message)}clearTimeout(l),s.remove(),r(new Error("–ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–≤–ª–µ—á—å comment_id –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è"))}catch(e){clearTimeout(l),s.remove(),r(e)}}}else try{const t=s.contentDocument||s.contentWindow.document,n=t.querySelector('textarea#main-reply[name="req_message"]'),o=t.querySelector('input[type="submit"][name="submit"]');if(!n||!o)return clearTimeout(l),s.remove(),void r(new Error("–ù–µ –Ω–∞–π–¥–µ–Ω–∞ —Ñ–æ—Ä–º–∞ –æ—Ç–≤–µ—Ç–∞ –≤ —Ç–µ–º–µ –ª–æ–≥–æ–≤"));n.value=a,e(),e(),o.click()}catch(e){clearTimeout(l),s.remove(),r(e)}},s.onerror=function(){clearTimeout(l),clearInterval(redirectCheckInterval),s.remove(),r(new Error("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–µ–º—ã"))}})}(t);if(o("–°–æ—Ö—Ä–∞–Ω—è—é..."),await async function(t,n,o=null){if(!window.FMVbank||"function"!=typeof window.FMVbank.storageSet)throw new Error("FMVbank –Ω–µ –Ω–∞–π–¥–µ–Ω");const r=o&&"object"==typeof o?o:{};if(r.comment_id=n,r.last_timestamp=Math.floor(Date.now()/1e3),!await window.FMVbank.storageSet(r,t,"skin_"))throw new Error("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ API");return e(),!0}(t,l,s.data),o("‚úì –≥–æ—Ç–æ–≤–æ","green"),r(`–•—Ä–∞–Ω–∏–ª–∏—â–µ —Å–æ–∑–¥–∞–Ω–æ (comment_id: ${l})`),i){i(`${a}/viewtopic.php?id=${n}#p${l}`)}}catch(e){o("‚úñ –æ—à–∏–±–∫–∞","red"),r(e?.message||String(e)),console.error("[button_create_storage] –û—à–∏–±–∫–∞:",e)}}window.FMV||(window.FMV={}),"function"==typeof window.createForumButton?window.createForumButton({allowedGroups:t,allowedForums:o,label:"–°–æ–∑–¥–∞—Ç—å —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö",order:4.5,showStatus:!0,showDetails:!0,showLink:!0,async onClick(t){const n=t?.setStatus||(()=>{}),o=t?.setDetails||(()=>{}),i=t?.setLink||(()=>{}),a=document.querySelector("div.post.topicpost");if(!a)return n("‚úñ –æ—à–∏–±–∫–∞","red"),void o("–ù–µ –Ω–∞–π–¥–µ–Ω –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä div.post.topicpost");const s=function(e){const t=e.querySelector('.pl-email.profile a[href*="profile.php?id="]');if(!t)return null;const n=t.href.match(/profile\.php\?id=(\d+)/);return n?Number(n[1]):null}(a);if(!s)return n("‚úñ –æ—à–∏–±–∫–∞","red"),void o("–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è");e(),await r(s,n,o,i)}}):console.warn("[button_create_storage] createForumButton –Ω–µ –Ω–∞–π–¥–µ–Ω–∞")})(),(()=>{"use strict";const e=(...e)=>{false};if(e(),e(window.SKIN),!window.SKIN||!window.SKIN.LibraryFieldID)return console.warn("[button_load_library] –¢—Ä–µ–±—É–µ—Ç—Å—è window.SKIN —Å LibraryFieldID"),void console.warn("[button_load_library] window.SKIN:",window.SKIN);const t=[window.SKIN.LibraryForumID],n=window.SKIN.GroupID||[],o=String(window.SKIN.LibraryFieldID).trim();e(),e(),e();const r={gift:window.SKIN.LibraryGiftPostID||[],plashka:window.SKIN.LibraryPlashkaPostID||[],icon:window.SKIN.LibraryIconPostID||[],background:window.SKIN.LibraryBackPostID||[],coupon:window.SKIN.LibraryCouponPostID||[]};function i(e){const t=e.querySelector(".id"),n=e.querySelector(".content"),o=e.querySelector(".desc");if(!t)return null;const r=t.textContent.trim();if(!r)return null;const i={id:r,content:n?n.innerHTML.trim():"",t:o?o.textContent.trim():""};return i.h=e.classList.contains("hidden")?1:0,i}function a(e){const t=e.querySelector(".id"),n=e.querySelector(".content"),o=e.querySelector(".desc"),r=e.querySelector(".title"),i=e.querySelector(".type"),a=e.querySelector(".form"),s=e.querySelector(".value");if(!t)return null;const c=t.textContent.trim();if(!c)return null;const l={id:c,content:n?n.innerHTML.trim():"",t:o?o.textContent.trim():""};if(r){const e=r.textContent.trim();e&&(l.s_t=e)}if(i){const e=i.textContent.trim();e&&(l.type=e)}if(a){const e=a.textContent.trim();e&&(l.f=e)}if(s){const e=s.textContent.trim();if(e){const t=Number(e);isNaN(t)||(l.v=t)}}return l}async function s(t,n=!1){try{const o=`/viewtopic.php?pid=${t}#p${t}`;e();const r=await async function(e){const t=await fetch(e,{credentials:"include"}),n=await t.arrayBuffer(),o=e=>{try{return new TextDecoder(e).decode(n)}catch{return null}},r=o("utf-8")??"",i=o("windows-1251")??"",a=e=>(e.match(/\uFFFD/g)||[]).length;if(a(i)&&!a(r))return r;if(a(r)&&!a(i))return i;const s=e=>(e.match(/[\u0400-\u04FF]/g)||[]).length;return s(i)>s(r)?i:r}(o),s=new DOMParser,c=s.parseFromString(r,"text/html").querySelector(`#p${t}-content`);if(!c)return console.warn(`[button_load_library] –ù–µ –Ω–∞–π–¥–µ–Ω #p${t}-content`),[];e();const l=[...c.querySelectorAll('script[type="text/html"]')];if(e(l.length),!l.length)return console.warn(`[button_load_library] –ù–µ—Ç script[type="text/html"] –≤ –ø–æ—Å—Ç–µ ${t}`),[];const d=function(e){const t=document.createElement("div");return t.innerHTML=String(e??""),t.textContent||t.innerText||""}(l.map(e=>e.textContent||e.innerHTML||"").join("\n")).replace(/\u00A0/g," "),u=s.parseFromString(d,"text/html").querySelectorAll("#grid article.card");e(u.length);const p=[];for(const e of u){const t=n?a(e):i(e);t&&p.push(t)}return p}catch(e){return console.error(`[button_load_library] –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ—Å—Ç–∞ ${t}:`,e),[]}}e(window.createForumButton),"function"==typeof window.createForumButton?(e(),window.createForumButton({allowedGroups:n,allowedForums:t,topicId:o,label:"–ü–æ–¥–≥—Ä—É–∑–∏—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É",order:1,showStatus:!0,showDetails:!0,showLink:!1,async onClick(t){const n=t?.setStatus||(()=>{}),o=t?.setDetails||(()=>{});try{n("–°–æ–±–∏—Ä–∞—é –¥–∞–Ω–Ω—ã–µ..."),o("");const t=await async function(){const t={gift:[],plashka:[],icon:[],background:[],coupon:[]};for(const[n,o]of Object.entries(r)){if(!Array.isArray(o)||0===o.length){e();continue}const r="coupon"===n;for(const i of o){e();const o=await s(i,r);t[n].push(...o),e(o.length)}}return t}(),i=Object.values(t).reduce((e,t)=>e+t.length,0);if(0===i)return n("‚úì –≥–æ—Ç–æ–≤–æ","green"),void o("–ù–µ –Ω–∞–π–¥–µ–Ω–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ –ø–æ—Å—Ç–∞—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫–∏");n("–°–æ—Ö—Ä–∞–Ω—è—é..."),await async function(t){if(!window.FMVbank||"function"!=typeof window.FMVbank.storageSet)throw new Error("FMVbank.storageSet –Ω–µ –Ω–∞–π–¥–µ–Ω");const n=Math.floor(Date.now()/1e3),o=["icon","plashka","background","gift","coupon"];for(const r of o){const o={items:t[r]||[],last_timestamp:n};if(e(),!await window.FMVbank.storageSet(o,1,`library_${r}_`))throw new Error(`–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è ${r} –≤ API`)}return!0}(t),n("‚úì –≥–æ—Ç–æ–≤–æ","green");o(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤:<br>${Object.entries(t).map(([e,t])=>`${e}: ${t.length} —à—Ç.`).join("<br>")}<br>–í—Å–µ–≥–æ: ${i}`)}catch(e){n("‚úñ –æ—à–∏–±–∫–∞","red"),o(e?.message||String(e)),console.error("[button_load_library] –û—à–∏–±–∫–∞:",e)}}}),e()):console.warn("[button_load_library] createForumButton –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"),e()})(),window.ChronoFilter={init:({root:e}={})=>function(e){const t=(t,n=e)=>n.querySelector(t),n=(t,n=e)=>Array.from(n.querySelectorAll(t)),o=e=>e?new Date(e):null,r=(e,t)=>Array.from(e?.querySelectorAll(`input[name="${t}"]:checked`)||[]).map(e=>e.value),i=t("#filters"),a=t("#list");if(!i||!a)return{apply:()=>[],reset:()=>[],getVisible:()=>[],destroy:()=>{}};const s=t("#dateStart"),c=t("#dateEnd"),l=t("#resetBtn"),d=t("#typeList"),u=t("#statusList"),p=t("#maskList"),m=t("#playerList"),f=t("#locationList");function h(e,n){const o=t(e);if(!o||!n)return()=>{};const r=e=>{e.stopPropagation(),n.style.display="block"===n.style.display?"none":"block"},i=e=>{n.contains(e.target)||o.contains(e.target)||(n.style.display="none")};return o.addEventListener("click",r),document.addEventListener("click",i),()=>{o.removeEventListener("click",r),document.removeEventListener("click",i)}}const g=h("#typeToggle",d),w=h("#statusToggle",u),y=h("#maskToggle",p),v=h("#playerToggle",m),b=h("#locationToggle",f),S=n("#list .episode").map(e=>{const t=(e.dataset.mask||"").split(";").map(e=>e.trim()).filter(Boolean),n=(e.dataset.players||"").split(";").map(e=>e.trim()).filter(Boolean);return{el:e,type:(e.dataset.type||"").trim(),status:(e.dataset.status||"").trim(),startL:o(e.dataset.startL),startR:o(e.dataset.startR),endL:o(e.dataset.endL),endR:o(e.dataset.endR),masks:t,players:n,location:(e.dataset.location||"").trim()}});function x(){const t=s?.value?new Date(s.value):null,n=c?.value?new Date(c.value):null,o=r(d,"type"),i=r(u,"status"),a=r(p,"mask"),l=r(m,"player"),h=r(f,"location"),g=[],w=[];return S.forEach(e=>{let r=!0;r&&t&&e.endL&&e.endL<t&&(r=!1),r&&n&&e.startR&&e.startR>n&&(r=!1),r&&o.length&&!o.includes(e.type)&&(r=!1),r&&i.length&&!i.includes(e.status)&&(r=!1),r&&a.length&&!e.masks.some(e=>a.includes(e))&&(r=!1),r&&l.length&&!e.players.some(e=>l.includes(e))&&(r=!1),r&&h.length&&!h.includes(e.location)&&(r=!1),e.el.style.display=r?"":"none",(r?g:w).push(e.el)}),e.dispatchEvent(new CustomEvent("chrono:filtered",{detail:{visible:g,hidden:w}})),g}function k(){return s&&(s.value=""),c&&(c.value=""),n('#filters .dropdown-list input[type="checkbox"]').forEach(e=>{e.checked=!1}),x()}function C(e){e.target.closest("#filters .dropdown-list")&&e.target.matches('input[type="checkbox"]')&&x()}return e.addEventListener("change",C),s?.addEventListener("change",x),c?.addEventListener("change",x),l?.addEventListener("click",e=>{e.preventDefault(),k()}),x(),{apply:x,reset:k,getVisible:()=>S.filter(e=>"none"!==e.el.style.display).map(e=>e.el),destroy:()=>{e.removeEventListener("change",C),s?.removeEventListener("change",x),c?.removeEventListener("change",x),l?.removeEventListener("click",k),g(),w(),y(),v(),b()}}}(e||document),apply:()=>[],reset:()=>[],getVisible:()=>[],destroy:()=>{}},function(){window.FMV||(window.FMV={});const e=e=>String(e??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"),t=t=>e(t).replace(/"/g,"&quot;"),n=e=>Array.from(new Set((e||[]).filter(Boolean))),o=e=>e?e.charAt(0).toUpperCase()+e.slice(1):"";FMV.utils={esc:e,escAttr:t,unique:n,capitalize:o};const r={personal:{label:"–ª–∏—á–Ω—ã–π",emoji:"<–∏–∫–æ–Ω–∫–∞>"},plot:{label:"—Å—é–∂–µ—Ç–Ω—ã–π",emoji:"<–∏–∫–æ–Ω–∫–∞>"},au:{label:"au",emoji:"<–∏–∫–æ–Ω–∫–∞>"}},i={on:{label:"–∞–∫—Ç–∏–≤–µ–Ω",emoji:"<–∏–∫–æ–Ω–∫–∞>"},archived:{label:"–Ω–µ–∞–∫—Ç—É–∞–ª–µ–Ω",emoji:"<–∏–∫–æ–Ω–∫–∞>"},off:{label:"–∑–∞–∫—Ä—ã—Ç",emoji:"<–∏–∫–æ–Ω–∫–∞>"}},a=e=>String(e).padStart(2,"0"),s=(e,t)=>new Date(e,t,0).getDate(),c=(e,t,n)=>`${e}-${a(t)}-${a(n)}`;function l(e){const t=String(e||"").trim();if(!t)return null;let n=t.match(/^(\d{1,2})\.(\d{1,2})\.(\d{4})$/);return n?{y:+n[3],m:+n[2],d:+n[1],g:"day"}:(n=t.match(/^(\d{4})-(\d{2})-(\d{2})$/),n?{y:+n[1],m:+n[2],d:+n[3],g:"day"}:(n=t.match(/^(\d{1,2})\.(\d{4})$/),n?{y:+n[2],m:+n[1],d:1,g:"month"}:(n=t.match(/^(\d{4})$/),n?{y:+n[1],m:1,d:1,g:"year"}:null)))}FMV.buildChronoHtml=function(d,u={}){u.titlePrefix,e(d?.name||"");const p=Array.isArray(d?.episodes)?d.episodes:[],m=n(p.flatMap(e=>Array.isArray(e?.masks)?e.masks:[])),f=n(p.flatMap(e=>(Array.isArray(e?.participants)?e.participants:[]).map(e=>{const t=Array.isArray(e?.masks)?e.masks.filter(Boolean).map(e=>String(e).trim()).filter(Boolean):"string"==typeof e?.mask&&e.mask.trim()?[e.mask.trim()]:[];return t.length?t.join(", "):String(e?.name||"").trim()}).map(e=>e.replace(/;/g," ")).filter(Boolean))),h=n(p.map(e=>e?.location).filter(Boolean));let g=null,w=null;const y=p.map(e=>{const t=function(e,t){const n=l(e),o=t?l(t):null;if(!n&&!o)return{startL:"",startR:"",endL:"",endR:""};let r="",i="";n?"day"===n.g?(r=c(n.y,n.m,1),i=c(n.y,n.m,n.d)):"month"===n.g?(r=c(n.y,n.m,1),i=c(n.y,n.m,s(n.y,n.m))):(r=c(n.y,1,1),i=c(n.y,12,31)):o&&("day"===o.g?(r=c(o.y,o.m,1),i=c(o.y,o.m,o.d)):"month"===o.g?(r=c(o.y,o.m,1),i=c(o.y,o.m,s(o.y,o.m))):(r=c(o.y,1,1),i=c(o.y,12,31)));let a="",d="";return o?"day"===o.g?(a=c(o.y,o.m,o.d),d=c(o.y,o.m,s(o.y,o.m))):"month"===o.g?(a=c(o.y,o.m,1),d=c(o.y,o.m,s(o.y,o.m))):(a=c(o.y,1,1),d=c(o.y,12,31)):n&&("day"===n.g?(a=c(n.y,n.m,n.d),d=c(n.y,n.m,s(n.y,n.m))):"month"===n.g?(a=c(n.y,n.m,1),d=c(n.y,n.m,s(n.y,n.m))):(a=c(n.y,1,1),d=c(n.y,12,31))),{startL:r,startR:i,endL:a,endR:d}}(e?.dateStart,e?.dateEnd);return t.startL&&(!g||t.startL<g)&&(g=t.startL),t.endR&&(!w||t.endR>w)&&(w=t.endR),t}),v=Object.entries(r).map(([n,o])=>`<label><input type="checkbox" name="type" value="${t(n)}"> ${e(o.label)}</label>`).join(""),b=Object.entries(i).map(([n,o])=>`<label><input type="checkbox" name="status" value="${t(n)}"> ${e(o.label)}</label>`).join(""),S=n(m).map(n=>`<label><input type="checkbox" name="mask" value="${t(n)}"> ${e(n)}</label>`).join(""),x=f.map(n=>`<label><input type="checkbox" name="player" value="${t(n)}"> ${e(n)}</label>`).join(""),k=h.map(n=>`<label><input type="checkbox" name="location" value="${t(n)}"> ${e(n)}</label>`).join("");let C=`<div class="filters" id="filters">\n    <div class="f">\n      <label>–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ —Ñ–∏–ª—å—Ç—Ä–∞</label>\n      <input type="date" id="dateStart" value="${t(g||"")}">\n    </div>\n    <div class="f">\n      <label>–î–∞—Ç–∞ –∫–æ–Ω—Ü–∞ —Ñ–∏–ª—å—Ç—Ä–∞</label>\n      <input type="date" id="dateEnd" value="${t(w||"")}">\n    </div>\n    <div class="f">\n      <label>–¢–∏–ø</label>\n      <div class="dropdown-wrapper">\n        <button class="dropdown-toggle" id="typeToggle">–í—ã–±—Ä–∞—Ç—å —Ç–∏–ø</button>\n        <div class="dropdown-list" id="typeList">\n          ${v}\n        </div>\n      </div>\n    </div>\n    <div class="f">\n      <label>–°—Ç–∞—Ç—É—Å</label>\n      <div class="dropdown-wrapper">\n        <button class="dropdown-toggle" id="statusToggle">–í—ã–±—Ä–∞—Ç—å —Å—Ç–∞—Ç—É—Å</button>\n        <div class="dropdown-list" id="statusList">\n          ${b}\n        </div>\n      </div>\n    </div>\n    <div class="f">\n      <label>–ú–∞—Å–∫–∞</label>\n      <div class="dropdown-wrapper">\n        <button class="dropdown-toggle" id="maskToggle">–í—ã–±—Ä–∞—Ç—å –º–∞—Å–∫—É</button>\n        <div class="dropdown-list" id="maskList">\n          ${S}\n        </div>\n      </div>\n    </div>\n    <div class="f">\n      <label>–£—á–∞—Å—Ç–Ω–∏–∫</label>\n      <div class="dropdown-wrapper">\n        <button class="dropdown-toggle" id="playerToggle">–í—ã–±—Ä–∞—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞</button>\n        <div class="dropdown-list" id="playerList">\n          ${x}\n        </div>\n      </div>\n    </div>\n    <div class="f">\n      <label>–õ–æ–∫–∞—Ü–∏—è</label>\n      <div class="dropdown-wrapper">\n        <button class="dropdown-toggle" id="locationToggle">–í—ã–±—Ä–∞—Ç—å –ª–æ–∫–∞—Ü–∏—é</button>\n        <div class="dropdown-list" id="locationList">\n          ${k}\n        </div>\n      </div>\n    </div>\n    <div class="actions">\n      <button class="button" id="resetBtn">–°–±—Ä–æ—Å–∏—Ç—å</button>\n    </div>\n  </div>\n  \n  <div class="list" id="list">\n    `;return p.length?(p.forEach((n,s)=>{const c=r[n?.type]||r.au,d=i[n?.status]||i.archived,u=n?.type||"",p=`${o(u)} ${c.emoji}`,m=n?.status||"",f=`${o(m)} ${d.emoji}`,h=Array.isArray(n?.masks)?n.masks.filter(Boolean):[],g=(Array.isArray(n?.participants)?n.participants:[]).map(e=>{const t=Array.isArray(e?.masks)?e.masks.filter(Boolean).map(e=>String(e).trim()).filter(Boolean):"string"==typeof e?.mask&&e.mask.trim()?[e.mask.trim()]:[];return(t.length?t.join(", "):String(e?.name||"").trim()).replace(/;/g," ")}).filter(Boolean),w=g.join(";"),v=(Array.isArray(n?.participants)?n.participants:[]).map(n=>{const o=Array.isArray(n?.masks)&&n.masks.length?n.masks.join(", "):String(n?.name||"").trim(),r=n?.id?String(n.id).trim():"";return r?`<a href="/profile.php?id=${t(r)}">${e(o)}</a>`:e(o)}).filter(Boolean).join(", "),b=n?.location||"",S=y[s],x=function(e,t){const n=l(e),o=l(t),r=e=>`${a(e.d)}.${a(e.m)}.${e.y}`,i=e=>`${a(e.m)}.${e.y}`,s=e=>`${e.y}`;if(!n&&!o)return"";if(n&&o&&("day"===n.g&&"day"===o.g&&n.y===o.y&&n.m===o.m&&n.d===o.d||"month"===n.g&&"month"===o.g&&n.y===o.y&&n.m===o.m||"year"===n.g&&"year"===o.g&&n.y===o.y)){if("day"===n.g)return r(n);if("month"===n.g)return i(n);if("year"===n.g)return s(n)}if(!n||!o)return"";const c={...n},d={...o},u=(e,t,n=1)=>{e.m="number"==typeof t?t:e.m??1,e.d=n,e.g="day"},p=(e,t)=>{e.m="number"==typeof t?t:e.m??1,e.d=1,e.g="month"};return"day"===c.g&&"month"===d.g&&u(d,d.m,1),"day"===d.g&&"month"===c.g&&u(c,c.m,1),"day"===c.g&&"year"===d.g&&u(d,1,1),"day"===d.g&&"year"===c.g&&u(c,1,1),"month"===c.g&&"year"===d.g&&p(d,c.m),"month"===d.g&&"year"===c.g&&p(c,d.m),"day"===c.g&&"day"===d.g?c.y===d.y&&c.m===d.m&&c.d===d.d?r(c):c.y===d.y&&c.m===d.m?`${a(c.d)}-${a(d.d)}.${a(c.m)}.${c.y}`:c.y===d.y&&c.m!==d.m?`${a(c.d)}.${a(c.m)}-${a(d.d)}.${a(d.m)}.${c.y}`:`${r(c)}-${r(d)}`:"month"===c.g&&"month"===d.g?c.y===d.y&&c.m===d.m?i(c):c.y===d.y&&c.m!==d.m?`${a(c.m)}-${a(d.m)}.${c.y}`:`${i(c)}-${i(d)}`:"year"===c.g&&"year"===d.g?c.y===d.y?s(c):`${s(c)}-${s(d)}`:"day"===c.g&&"month"===d.g?c.y===d.y&&c.m===d.m?r(c):c.y===d.y?`${a(c.d)}.${a(c.m)}-${a(d.m)}.${c.y}`:`${r(c)}-${i(d)}`:"month"===c.g&&"day"===d.g?c.y===d.y&&c.m===d.m?r(d):c.y===d.y?`${a(c.m)}.${c.y}-${a(d.d)}.${a(d.m)}.${d.y}`:`${i(c)}-${r(d)}`:"day"===c.g&&"year"===d.g?c.y===d.y?r(c):`${r(c)}-${s(d)}`:"year"===c.g&&"day"===d.g?c.y===d.y?r(d):`${s(c)}-${r(d)}`:"month"===c.g&&"year"===d.g?c.y===d.y?i(c):`${i(c)}-${s(d)}`:"year"===c.g&&"month"===d.g?c.y===d.y?i(d):`${s(c)}-${i(d)}`:""}(n?.dateStart,n?.dateEnd),k=x?`<span class="muted">${e(x)} ‚Äî </span>`:"";C+=`\n  <div class="episode" \n       data-type="${t(u)}" \n       data-status="${t(m)}" \n       data-start-l="${t(S.startL)}" data-start-r="${t(S.startR)}" \n       data-end-l="${t(S.endL)}" data-end-r="${t(S.endR)}"\n       ${h.length?`data-mask="${t(h.join(";"))}"`:""}\n       ${b?`data-location="${t(b)}"`:""}\n       ${g.length?`data-players="${t(w)}"`:""}>\n    <div>—Ç–∏–ø: ${e(p)}; —Å—Ç–∞—Ç—É—Å: ${e(f)}</div>\n    <div>${k}<span class="title"><a href="${e(n?.href||"#")}">${e(n?.title||"")}</a></span>\n      ${h.length?` [as ${e(h.join(", "))}]`:""}</div>\n    <div>–ª–æ–∫–∞—Ü–∏—è: ${e(b)}</div>\n    <div>—É—á–∞—Å—Ç–Ω–∏–∫–∏: ${v}</div>\n  </div>`}),C+="</div>",C):(C+='<div class="meta">–ù–µ—Ç —ç–ø–∏–∑–æ–¥–æ–≤</div></section>',C)}}(),(()=>{"use strict";const e=(...e)=>{false},t=document.querySelector('textarea#main-reply[name="req_message"]');if(!t)return void e();if(e(),document.querySelector('input[type="checkbox"][name="firstpost"]'))return void e();e();let n=!1;const o=(document.querySelector("head title")?.textContent||"").toLowerCase().trim();if((o.startsWith("–≥—Ä–∏–Ω–≥–æ—Ç—Ç—Å")||o.startsWith("—Ä–µ–∫–ª–∞–º–∞"))&&(e(),n=!0),!n&&window.EPS_FORUM_INFO&&Array.isArray(window.EPS_FORUM_INFO)){const t=document.querySelector(".container.crumbs");if(t){const o=Array.from(t.querySelectorAll('a[href*="/viewforum.php?id="]')).map(e=>{const t=e.getAttribute("href")?.match(/viewforum\.php\?id=(\d+)/);return t?Number(t[1]):null}).filter(Boolean),r=window.EPS_FORUM_INFO.map(e=>Number(e.id)).filter(e=>!isNaN(e));o.some(e=>r.includes(e))&&(e(),n=!0)}}if(!n)return void e();e();const r=window.UserID;if(!r)return void console.warn("[auto_author_tag] window.UserID –Ω–µ –Ω–∞–π–¥–µ–Ω");e();const i=Array.isArray(window.GAME_MASTERS)&&window.GAME_MASTERS.includes(r);e();const a=window.GroupID===window.GROUP_IDS?.Admin;e();const s=i||a;e();const c=/^\[FMVauthor\]usr(\d+);?\[\/FMVauthor\]\s*/i;function l(e){const t=e.match(c);return t?{authorId:t[1],cleanText:e.replace(c,"")}:null}function d(e,t){return c.test(e)?e:`[FMVauthor]usr${t};[/FMVauthor]${e}`}let u=!1;function p(){if(u)return;u=!0;const e=document.createElement("style");e.textContent="\n      .fmvauthor-badge {\n        margin-bottom: 8px;\n        padding: 8px 12px;\n        background-color: #f3f4f6;\n        border: 1px solid #d1d5db;\n        border-radius: 6px;\n        font-size: 14px;\n        color: #374151;\n        font-weight: 500;\n      }\n      .fmvauthor-gm-selector {\n        margin-bottom: 12px;\n      }\n      .fmvauthor-gm-selector label {\n        display: block;\n        font-weight: 600;\n        margin-bottom: 6px;\n        font-size: 14px;\n        color: #2d2a26;\n      }\n      .fmvauthor-gm-selector .combo {\n        position: relative;\n      }\n      .fmvauthor-gm-selector input {\n        width: 100%;\n        padding: 8px 10px;\n        border: 1px solid #d8d1c3;\n        border-radius: 8px;\n        background: #efe9dc;\n        color: #2d2a26;\n        font-size: 14px;\n      }\n      .fmvauthor-gm-selector .hint {\n        margin-top: 4px;\n        font-size: 12.5px;\n        color: #6b6359;\n      }\n      .fmvauthor-gm-selector .autocomplete-list {\n        position: absolute;\n        z-index: 50;\n        left: 0;\n        right: 0;\n        background: #fff;\n        border: 1px solid #d8d1c3;\n        border-radius: 8px;\n        margin-top: 4px;\n        max-height: 240px;\n        overflow: auto;\n        display: none;\n      }\n      .fmvauthor-gm-selector .autocomplete-list.show {\n        display: block;\n      }\n      .fmvauthor-gm-selector .autocomplete-item {\n        padding: 0.45em 0.65em;\n        cursor: pointer;\n        font-size: 14px;\n      }\n      .fmvauthor-gm-selector .autocomplete-item:hover,\n      .fmvauthor-gm-selector .autocomplete-item.active {\n        background-color: #f0efe9;\n      }\n      .fmvauthor-gm-selector .autocomplete-item .muted {\n        color: #6b6359;\n      }\n      .fmvauthor-gm-selector .chip {\n        display: flex;\n        align-items: center;\n        gap: 10px;\n        padding: 0.45em 0.6em;\n        background: #fff;\n        border: 1px solid #d8d1c3;\n        border-radius: 8px;\n        margin: 0.35em 0;\n        font-size: 14px;\n      }\n      .fmvauthor-gm-selector .chip .name {\n        font-weight: 600;\n      }\n      .fmvauthor-gm-selector .chip .x {\n        border: 0;\n        background: none;\n        font-size: 16px;\n        line-height: 1;\n        cursor: pointer;\n        color: #8b8378;\n        margin-left: auto;\n      }\n      .fmvauthor-gm-selector .chip .x:hover {\n        color: #2d2a26;\n      }\n    ",document.head.appendChild(e)}let m=null;function f(n){m&&m.remove(),p(),m=document.createElement("div"),m.className="fmvauthor-badge",m.textContent=`–ê–≤—Ç–æ—Ä –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è: user${n}`,t.parentNode.insertBefore(m,t),e()}let h=null,g=null,w=null,y=[];function v(n=null){h&&h.remove(),p(),h=document.createElement("div"),h.className="fmvauthor-gm-selector";const o=document.createElement("label");o.textContent="–ê–≤—Ç–æ—Ä –ø–æ—Å—Ç–∞: *",o.setAttribute("for","fmvauthor-gm-input");const r=document.createElement("div");r.className="combo";const i=document.createElement("input");i.type="text",i.id="fmvauthor-gm-input",i.placeholder="–ù–∞–±–µ—Ä–∏—Ç–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...",i.autocomplete="off";const a=document.createElement("div");a.className="autocomplete-list",r.appendChild(i),r.appendChild(a);const s=document.createElement("div");s.className="chip-container";const c=document.createElement("div");if(c.className="hint",c.textContent="–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–¥—Å—á–µ—Ç–∞ –ø–æ—Å—Ç–æ–≤. –ù–∞—á–Ω–∏—Ç–µ –≤–≤–æ–¥–∏—Ç—å –∏–º—è –∏–ª–∏ user ID.",h.appendChild(o),h.appendChild(r),h.appendChild(s),h.appendChild(c),t.parentNode.insertBefore(h,t),n){g=n;const t=y.find(e=>e.id===Number(n));w=t?t.name:`user${n}`,b(s,r),e()}else e();!function(t,n,o,r){let i=-1;function a(e){const t=e.toLowerCase().trim();if(n.innerHTML="",!t)return void n.classList.remove("show");const o=y.filter(e=>e.name.toLowerCase().includes(t)||e.code.toLowerCase().includes(t)).slice(0,20);0!==o.length?(o.forEach((e,t)=>{const o=document.createElement("div");o.className="autocomplete-item",o.textContent=`${e.name} `;const r=document.createElement("span");r.className="muted",r.textContent=`(${e.code})`,o.appendChild(r),o.dataset.userId=e.id,o.dataset.index=t,o.addEventListener("click",()=>{s(e)}),n.appendChild(o)}),n.classList.add("show"),i=-1):n.classList.remove("show")}function s(i){g=i.id,w=i.name,t.value="",n.classList.remove("show"),b(o,r),e(i.id,i.name)}function c(e){e.forEach((e,t)=>{e.classList.toggle("active",t===i)}),i>=0&&e[i]&&e[i].scrollIntoView({block:"nearest"})}t.addEventListener("input",()=>{a(t.value)}),t.addEventListener("keydown",e=>{const t=n.querySelectorAll(".autocomplete-item");if("ArrowDown"===e.key)e.preventDefault(),i=Math.min(i+1,t.length-1),c(t);else if("ArrowUp"===e.key)e.preventDefault(),i=Math.max(i-1,-1),c(t);else if("Enter"===e.key){if(e.preventDefault(),i>=0&&t[i]){const e=t[i].dataset.userId,n=y.find(t=>t.id===Number(e));n&&s(n)}}else"Escape"===e.key&&n.classList.remove("show")}),document.addEventListener("click",e=>{h?.contains(e.target)||n.classList.remove("show")})}(i,a,s,r)}function b(t,n){if(t.innerHTML="",!g)return void(n.style.display="block");n.style.display="none";const o=document.createElement("div");o.className="chip";const r=document.createElement("span");r.className="name",r.textContent=w||`user${g}`;const i=document.createElement("button");i.type="button",i.className="x",i.textContent="√ó",i.setAttribute("aria-label","–£–¥–∞–ª–∏—Ç—å"),i.addEventListener("click",()=>{g=null,w=null,b(t,n),e()}),o.appendChild(r),o.appendChild(i),t.appendChild(o)}let S=null;function x(){const n=l(t.value);i?n?(e(n.authorId),S=n.authorId,t.value=n.cleanText,v(n.authorId)):(e(),S=null,v(null)):n?(e(n.authorId),S=n.authorId,t.value=n.cleanText,s?f(n.authorId):e()):(e(),S=null,s&&m&&(m.remove(),m=null,e()))}function k(){if(e(),e(),null!==S)return e(),{shouldAdd:!0,authorId:S};const t=window.location.href;if(e(),/\/edit\.php\?id=/i.test(t))return e(),{shouldAdd:!1,authorId:null};const n=(document.querySelector("head title")?.textContent||"").toLowerCase().trim();if(e(),n.startsWith("–≥—Ä–∏–Ω–≥–æ—Ç—Ç—Å")||n.startsWith("—Ä–µ–∫–ª–∞–º–∞"))return e(),{shouldAdd:!0,authorId:r};if(e(window.EPS_FORUM_INFO),window.EPS_FORUM_INFO&&Array.isArray(window.EPS_FORUM_INFO)){const t=document.querySelector(".container.crumbs");if(t){const n=Array.from(t.querySelectorAll('a[href*="/viewforum.php?id="]')).map(e=>{const t=e.getAttribute("href")?.match(/viewforum\.php\?id=(\d+)/);return t?Number(t[1]):null}).filter(Boolean);e();const o=window.EPS_FORUM_INFO.map(e=>Number(e.id)).filter(e=>!isNaN(e));if(e(),n.some(e=>o.includes(e)))return e(),{shouldAdd:!0,authorId:r}}}return e(),{shouldAdd:!1,authorId:null}}t.addEventListener("input",()=>{const e=l(t.value);if(e)if(t.value=e.cleanText,i){if(h){g=e.authorId;const t=h.querySelector("input"),n=y.find(t=>t.id===Number(e.authorId));t&&(t.value=n?n.name:`user${e.authorId}`)}}else s&&f(e.authorId)});const C=t.closest("form");e(),C||console.warn("[auto_author_tag] –§–æ—Ä–º–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ - submit handler –Ω–µ –±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω");const _=C?.querySelector('input[type="submit"][name="submit"]');e(),_?(e(),"undefined"!=typeof $&&$(C).length?$(C).off("submit.fmvauthor").on("submit.fmvauthor",function(n){if(e(),i){if(!g)return n.preventDefault(),alert("–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–±—Ä–∞—Ç—å –∞–≤—Ç–æ—Ä–∞ –ø–æ—Å—Ç–∞ –∏–∑ —Å–ø–∏—Å–∫–∞!"),e(),!1;if(k().shouldAdd){const n=t.value,o=d(n,g);o!==n&&(e(),t.value=o)}}else{const n=k();if(!n.shouldAdd)return void e();const o=t.value,r=d(o,n.authorId);r!==o?(e(n.authorId),t.value=r):e()}}):C.addEventListener("submit",n=>{if(e(),i){if(!g)return n.preventDefault(),alert("–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–±—Ä–∞—Ç—å –∞–≤—Ç–æ—Ä–∞ –ø–æ—Å—Ç–∞ –∏–∑ —Å–ø–∏—Å–∫–∞!"),e(),!1;if(k().shouldAdd){const n=t.value,o=d(n,g);o!==n&&(e(),t.value=o)}}else{const n=k();if(!n.shouldAdd)return void e();const o=t.value,r=d(o,n.authorId);r!==o?(e(n.authorId),t.value=r):e()}})):console.warn("[auto_author_tag] –ö–Ω–æ–ø–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ - submit handler –Ω–µ –±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"),(async()=>{await async function(){if(i){e();try{"function"==typeof window.FMV?.fetchUsers?(y=await window.FMV.fetchUsers(),e(y.length)):"function"==typeof window.scrapeUsers?(y=await window.scrapeUsers(),e(y.length)):Array.isArray(window.scrapedUsers)?(y=window.scrapedUsers,e(y.length)):(console.warn("[auto_author_tag] –ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π"),y=[])}catch(e){console.error("[auto_author_tag] –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:",e),y=[]}}}(),x(),e()})()})(),(()=>{"use strict";createForumButton({allowedGroups:window.PROFILE_CHECK&&window.PROFILE_CHECK?.GroupID||[],allowedForums:window.PROFILE_CHECK&&window.PROFILE_CHECK?.ForumID||[],label:"–°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É",order:1,async onClick({setStatus:e,setDetails:t,setLink:n}){const o=document.querySelector("#pun-main h1 span"),r=o?o.textContent.trim().toLowerCase():"";if(!r)return e("‚úñ –Ω–µ—Ç –∏–º–µ–Ω–∏ —Ç–µ–º—ã","red"),void t("–û–∂–∏–¥–∞–ª—Å—è #pun-main h1 span");let i=document.querySelector('.topic .post-links .profile a[href*="profile.php?id="]');if(!i)try{await FMV.waitForSelector('a[href*="profile.php?id="]',3e3),i=document.querySelector('a[href*="profile.php?id="]')}catch{}const a=i?.href?.match(/profile\.php\?id=(\d+)/i);if(!a)return e("‚úñ –Ω–µ –Ω–∞–π–¥–µ–Ω userId","red"),void t("–ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–≤–ª–µ—á—å profile.php?id=...");const s=a[1],c=`usr${s}`,l=(window.PROFILE_CHECK?.PPageTemplate||"").replace(/data-id="N"/g,`data-id="${s}"`),d=window.PROFILE_CHECK?.PPageGroupID;if("function"!=typeof window.FMVcreatePersonalPage)return e("‚úñ —Ñ—É–Ω–∫—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞","red"),void t("–û–∂–∏–¥–∞–ª–∞—Å—å window.FMVcreatePersonalPage(arg1, arg2, arg3, arg4, arg5, arg6)");e("–°–æ–∑–¥–∞—ë–º‚Ä¶","#555"),t(""),n(null);try{const o=await window.FMVcreatePersonalPage(r,c,l,"",d,"0");switch(o?.status){case"created":e("‚úì —Å–æ–∑–¥–∞–Ω–æ","green");break;case"exists":e("‚Ñπ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç","green");break;case"error":e("‚úñ –æ—à–∏–±–∫–∞","red");break;default:e("‚ùî –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å","#b80")}o?.url&&n(o.url,"–û—Ç–∫—Ä—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É");const i=[];o?.serverMessage&&i.push("–°–æ–æ–±—â–µ–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞: "+o.serverMessage),o?.httpStatus&&i.push("HTTP: "+o.httpStatus),o?.title&&i.push("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "+o.title),o?.name&&i.push("–ê–¥—Ä–µ—Å–Ω–æ–µ –∏–º—è: "+o.name),o?.details&&i.push("Details: "+o.details),t(i.join("\n")||"–ù–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö")}catch(n){e("‚úñ —Å–µ—Ç—å/—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç","red"),t(n?.message||String(n)),console.error("[button_personal_page]",n)}}})})(),(()=>{"use strict";createForumButton({allowedGroups:window.PROFILE_CHECK&&window.PROFILE_CHECK?.GroupID||[],allowedForums:window.PROFILE_CHECK&&window.PROFILE_CHECK?.ForumID||[],label:"–°–º–µ–Ω–∏—Ç—å –≥—Ä—É–ø–ø—É",order:4,async onClick({setStatus:e,setDetails:t}){const n=window.PROFILE_CHECK&&window.PROFILE_CHECK?.GroupUserID||"",o=window.PROFILE_CHECK&&window.PROFILE_CHECK?.GroupPlayerID||"";if(!n||!o){const r=[n?null:"PROFILE_CHECK.GroupUserID",o?null:"PROFILE_CHECK.GroupPlayerID"].filter(Boolean).join(", ");return e("‚úñ –∑–∞–º–µ–Ω–∞ –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞","red"),void t("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–ø—É—Å—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≥—Ä—É–ø–ø—ã: "+(r?`–Ω–µ –∑–∞–¥–∞–Ω—ã –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ${r}. –£–∫–∞–∂–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ.`:"–æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã."))}let r=document.querySelector('.topic .post-links .profile a[href*="profile.php?id="]')||document.querySelector('.topic .post .post-links a[href*="profile.php?id="]')||document.querySelector('a[href*="profile.php?id="]');if(!r)try{await FMV.waitForSelector('a[href*="profile.php?id="]',3e3),r=document.querySelector('a[href*="profile.php?id="]')}catch{}const i=r?.href?.match(/profile\.php\?id=(\d+)/i),a=i?i[1]:"";if(!a)return e("‚úñ –Ω–µ –Ω–∞–π–¥–µ–Ω userId","red"),void t("–ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–≤–ª–µ—á—å profile.php?id=... –∏–∑ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ç–µ–º—ã");if("function"!=typeof window.FMVupdateGroupIfEquals)return e("‚úñ —Ñ—É–Ω–∫—Ü–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞","red"),void t("–û–∂–∏–¥–∞–ª–∞—Å—å window.FMVupdateGroupIfEquals(userId, fromId, toId)");e("–ü—Ä–æ–≤–µ—Ä—è—é –∏ –æ–±–Ω–æ–≤–ª—è—é‚Ä¶","#555"),t("");try{const r=await window.FMVupdateGroupIfEquals(a,n,o);let i="";if(r?.details){const e=String(r.details).match(/current=([^\s]+)/);e&&(i=e[1])}switch(r?.status){case"updated":e("‚úì –≥—Ä—É–ø–ø–∞ –∏–∑–º–µ–Ω–µ–Ω–∞","green");break;case"nochange":e("‚Ñπ –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–µ—Ç ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –≤ —Ü–µ–ª–µ–≤–æ–π –≥—Ä—É–ø–ø–µ","green");break;case"skipped":return e("‚úñ –∏—Å—Ö–æ–¥–Ω–∞—è –≥—Ä—É–ø–ø–∞ –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç","red"),void t(`–ò—Å—Ö–æ–¥–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≥—Ä—É–ø–ø—ã ‚Äî ${i||"–Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ"}.\n–õ–∏–±–æ –≤—ã –ø—ã—Ç–∞–µ—Ç–µ—Å—å –ø–æ–ø—Ä–∞–≤–∏—Ç—å –Ω–µ —Ç–æ—Ç –ø—Ä–æ—Ñ–∏–ª—å, –ª–∏–±–æ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∑–∞–º–µ–Ω—É –≤—Ä—É—á–Ω—É—é –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏.`);case"uncertain":e("‚ùî –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç","#b80");break;default:e("‚úñ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏","red")}const s=[];r?.serverMessage&&s.push("–°–æ–æ–±—â–µ–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞: "+r.serverMessage),r?.httpStatus&&s.push("HTTP: "+r.httpStatus),s.push("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "+(r?.userId??a)),s.push(`–ó–∞–º–µ–Ω–∞: ${n} ‚Üí ${o}`),i&&s.push("–¢–µ–∫—É—â–µ–µ (–¥–æ –ø–æ–ø—ã—Ç–∫–∏): "+i),r?.details&&!i&&s.push("Details: "+r.details),t(s.join("\n")||"–ù–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö")}catch(n){e("‚úñ —Å–µ—Ç—å/—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç","red"),t(n&&n.message?n.message:String(n)),console.error("[button_update_group]",n)}}})})(),(()=>{"use strict";createForumButton({allowedGroups:window.PROFILE_CHECK&&window.PROFILE_CHECK?.GroupID||[],allowedForums:window.PROFILE_CHECK&&window.PROFILE_CHECK?.ForumID||[],label:"–í—ã–¥–∞—Ç—å –º–æ–Ω–µ—Ç–∫–∏",order:3,async onClick({setStatus:e,setDetails:t}){let n=document.querySelector('.topic .post-links .profile a[href*="profile.php?id="]');if(!n)try{await FMV.waitForSelector('a[href*="profile.php?id="]',3e3),n=document.querySelector('a[href*="profile.php?id="]')}catch{}const o=n?.href?.match(/profile\.php\?id=(\d+)/i);if(!o)return e("‚úñ –Ω–µ –Ω–∞–π–¥–µ–Ω userId","red"),void t("–ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–≤–ª–µ—á—å profile.php?id=...");const r=o[1],i=window.PROFILE_CHECK?.MoneyFieldID,a=window.PROFILE_CHECK?.MoneyFieldTemplate;let s;try{const n=`/pages/usr${r}`,o=await fetch(n);if(!o.ok)return e("‚úñ –æ—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã","red"),void t(`–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å ${n}: HTTP ${o.status}`);const i=await o.text(),c=(new DOMParser).parseFromString(i,"text/html"),l=c.querySelector(".info .container");if(l&&/–Ω–µ–≤–µ—Ä–Ω–∞—è –∏–ª–∏ —É—Å—Ç–∞—Ä–µ–≤—à–∞—è/i.test(l.textContent))return e("‚úñ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞","red"),void t("–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ —à–∞–±–ª–æ–Ω—É.");const d=c.querySelector(".modal_script");if(!d)return e("‚úñ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞","red"),void t("–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ —à–∞–±–ª–æ–Ω—É.");const u=d.getAttribute("data-main-user_id");if(null!==u){const n=u.trim();if(!n||"–£–ë–†–ê–¢–¨ –ï–°–õ–ò –ù–ï –ù–£–ñ–ù–û"===n)return e("‚úñ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞","red"),void t("–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ —à–∞–±–ª–æ–Ω—É.");if(!/^\d+$/.test(n))return e("‚úñ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞","red"),void t("–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ —à–∞–±–ª–æ–Ω—É.");s=`\x3c!-- main: usr${n} --\x3e`}else s=String(a)}catch(n){return e("‚úñ –æ—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã","red"),t(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ /pages/usr${r}: ${n.message}`),void console.error("[button_update_money_field]",n)}if("function"!=typeof window.FMVreplaceFieldData)return e("‚úñ —Ñ—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞","red"),void t("–û–∂–∏–¥–∞–ª–∞—Å—å window.FMVreplaceFieldData(userId, fieldId, value)");e("–û–±–Ω–æ–≤–ª—è–µ–º‚Ä¶","#555"),t("");try{const n=await window.FMVreplaceFieldData(r,i,s);switch(n?.status){case"updated":e("‚úì –æ–±–Ω–æ–≤–ª–µ–Ω–æ","green");break;case"nochange":e("‚Ñπ –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–µ—Ç","green");break;case"error":e("‚úñ –æ—à–∏–±–∫–∞","red");break;default:e("‚ùî –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å","#b80")}const o=[];n?.serverMessage&&o.push("–°–æ–æ–±—â–µ–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞: "+n.serverMessage),n?.httpStatus&&o.push("HTTP: "+n.httpStatus),o.push("–ü–æ–ª–µ: "+(n?.fieldId??i)),o.push("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: "+(n?.userId??r)),o.push("–ó–Ω–∞—á–µ–Ω–∏–µ: "+s),n?.details&&o.push("Details: "+n.details),t(o.join("\n"))}catch(n){e("‚úñ —Å–µ—Ç—å/—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç","red"),t(n&&n.message?n.message:String(n)),console.error("[button_update_money_field]",n)}}})})(),window.fetchAllLibraries=fetchAllLibraries,function(){"use strict";const e='\n  details.ufo-panel{margin-top:12px;border:1px solid #d0d0d7;border-radius:10px;background:#fff}\n  details.ufo-panel>summary{cursor:pointer;list-style:none;padding:10px 14px;font-weight:600;background:#f6f6f8;border-bottom:1px solid #e6e6ef;border-radius:10px}\n  details.ufo-panel>summary::-webkit-details-marker{display:none}\n  .ufo-wrap{display:flex;flex-direction:column;gap:16px;padding:14px}\n  .ufo-col{display:flex;flex-direction:column;gap:8px}\n  .ufo-col h4{margin:0;font-size:14px;opacity:.8;display:flex;justify-content:space-between;align-items:center}\n  .ufo-search{padding:6px 10px;font-size:13px;border:1px solid #d0d0d7;border-radius:8px;background:#f5f2e8}\n  .ufo-lib,.ufo-selected{border:1px dashed #c9c9d9;border-radius:8px;background:#fafafd;padding:8px;overflow:auto}\n  .ufo-lib{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:10px}\n  .ufo-lib .ufo-card{margin:0}\n  .ufo-card{display:grid;grid-template-columns:auto 1fr auto auto;grid-template-rows:auto auto;grid-template-areas:"id full date actions" "id title title actions";gap:8px;background:#fff;border:1px solid #e7e7ef;border-radius:8px;padding:8px;margin:6px 0;max-width:100%;position:relative;overflow:hidden}\n  .ufo-idtag{grid-area:id;font-size:11px;opacity:.7;align-self:start}\n  .ufo-actions{grid-area:actions;display:flex;align-items:center;gap:6px}\n  .ufo-btn{border:1px solid #d7d7e0;background:#f3f3f7;padding:4px 10px;border-radius:6px;cursor:pointer;font-size:12px;white-space:nowrap;line-height:1.15;display:inline-flex;align-items:center}\n  .ufo-btn:hover{background:#ececf4}\n  .ufo-card.disabled{opacity:.4;pointer-events:none}\n  .ufo-lib .ufo-card {grid-template-columns: 1fr;\n    grid-template-rows: auto auto auto;\n    grid-template-areas:\n        "id"\n        "full"\n        "actions";}\n  .ufo-lib .ufo-actions{justify-content: flex-end;}\n  .ufo-full{grid-area:full;box-sizing:border-box;margin:0;padding:0;border:0;background:transparent;overflow:hidden}\n  .ufo-full .item{position:relative;margin:0}\n  .ufo-full .item .modal-link{display:block}\n  .ufo-full .item img{display:block;max-width:100%;height:auto;border-radius:6px}\n  .ufo-lib .ufo-full .item img{height:90px;width:100%;object-fit:cover}\n  .ufo-lib .ufo-full a{pointer-events:none}\n  .ufo-title-edit{grid-area:title;border:1px dashed #aaa;border-radius:6px;padding:6px 8px;background:#fffef7;font-size:13px;white-space:pre-wrap;overflow:visible}\n  .ufo-title-edit:focus{outline:none;background:#fffdf1}\n  .ufo-date-edit{grid-area:date;border:1px dashed #aaa;border-radius:6px;padding:6px 8px;background:#fffef7;font-size:13px;align-self:start}\n  .ufo-date-edit input{border:none;background:transparent;font-size:13px;width:100%;font-family:inherit}\n  .ufo-date-edit input:focus{outline:none}\n  ';!function(){if(window.__ufoCSS)return;window.__ufoCSS=!0;const t=document.createElement("style");t.textContent=e,document.head.appendChild(t),"function"==typeof GM_addStyle&&GM_addStyle(e)}();const t=(e,t)=>{const n=document.createElement("button");return n.type="button",n.className="ufo-btn",n.textContent=e,n.addEventListener("click",t),n};function n(e){const t=e.querySelector(".ufo-card");if(!t)return void(e.style.maxHeight="");const n=getComputedStyle(t),o=t.getBoundingClientRect().height,r=parseFloat(n.marginTop)||0,i=parseFloat(n.marginBottom)||0,a=getComputedStyle(e),s=parseFloat(a.paddingTop)||0,c=parseFloat(a.paddingBottom)||0,l=Math.round(2*o+3*(r+i)+s+c);e.style.maxHeight=l+"px"}function o(e){const t=function(e){return[...e.querySelectorAll(".ufo-card")].find(e=>"none"!==getComputedStyle(e).display)||null}(e);if(!t)return void(e.style.maxHeight="");const n=t.getBoundingClientRect().height,o=getComputedStyle(e),r=parseFloat(o.rowGap)||0,i=parseFloat(o.paddingTop)||0,a=parseFloat(o.paddingBottom)||0,s=Math.round(2*n+r+i+a);e.style.maxHeight=s+"px"}window.createChoicePanelJSON=function(e){const r=Object.assign({title:"–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∏ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ",targetClass:"_section",library:[],startOpen:!1,itemSelector:".item",idAttr:"data-id",editableAttr:"title",searchPlaceholder:"–ø–æ–∏—Å–∫ –ø–æ id",mountEl:null,allowMultiAdd:!1,expirableAttr:null},e||{});Array.isArray(r.library)||(r.library=[]);const i="ufo_"+(r.targetClass||"section").replace(/\W+/g,"_")+"_"+Math.random().toString(36).slice(2,7);let a=[];const s=document.createElement("details");s.className="ufo-panel",s.open=!!r.startOpen;const c=document.createElement("summary");c.textContent=r.title||"–ü–∞–Ω–µ–ª—å";const l=document.createElement("div");l.className="ufo-wrap";const d=document.createElement("div");d.className="ufo-col";const u=document.createElement("h4");u.textContent="–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞";const p=document.createElement("input");p.type="text",p.placeholder=r.searchPlaceholder||"–ø–æ–∏—Å–∫ –ø–æ id",p.className="ufo-search",u.appendChild(p);const m=document.createElement("div");m.className="ufo-lib",m.id=i+"-lib",d.append(u,m);const f=document.createElement("div");f.className="ufo-col",f.innerHTML="<h4>–í—ã–±—Ä–∞–Ω–Ω—ã–µ (—Å–≤–µ—Ä—Ö—É ‚Äî –Ω–æ–≤–µ–µ)</h4>";const h=document.createElement("div");function g(e){const n=document.createElement("div");n.className="ufo-card",n.dataset.id=e.id;const o=document.createElement("div");o.className="ufo-idtag",o.textContent="#"+e.id;const i=document.createElement("div");i.className="ufo-full";const s=document.createElement("div");s.innerHTML=e.html.trim(),i.appendChild(s.firstElementChild);const c=document.createElement("div");return c.className="ufo-actions",c.appendChild(t("–î–æ–±–∞–≤–∏—Ç—å ‚Üë",t=>{t.preventDefault(),t.stopPropagation(),function(e){const t=m.querySelector(`.ufo-card[data-id="${e.id}"]`);if(!r.allowMultiAdd){if(a.some(t=>t.id===e.id))return;t&&t.classList.add("disabled")}const n=document.createElement("div");n.innerHTML=e.html.trim();const o=n.querySelector(r.itemSelector),i={id:e.id,title:o&&o.getAttribute(r.editableAttr)||"",content:o?o.innerHTML.trim():""};if(o&&o.attributes)for(let e=0;e<o.attributes.length;e++){const t=o.attributes[e];if(t.name.startsWith("data-")&&"data-id"!==t.name){i[t.name.substring(5).replace(/-/g,"_")]=t.value}}r.expirableAttr&&o&&(i.expired_date=o.getAttribute(r.expirableAttr)||"");a.unshift(i),w()}(e)})),n.append(o,i,c),n}function w(){h.innerHTML="",a.forEach((e,n)=>{const o=function(e,n){const o=document.createElement("div");o.className="ufo-card",o.draggable=!0,o.dataset.id=e.id,o.dataset.index=n;const i=document.createElement("div");i.className="ufo-idtag",i.textContent="#"+e.id;const s=document.createElement("div");s.className="ufo-full";const c=document.createElement("div");c.innerHTML=e.content.trim(),s.appendChild(c.firstElementChild);const l=document.createElement("div");l.className="ufo-title-edit",l.contentEditable=!0,l.textContent=e.title||"",l.addEventListener("blur",()=>{const e=String(l.innerHTML||"").replace(/<br\s*\/?>/gi,"\n").replace(/&nbsp;|[\u00A0\u200B-\u200D\u2060\uFEFF]/g,"").replace(/\s+/g," ").trim();a[n].title=e});let d=null;if(r.expirableAttr){d=document.createElement("div"),d.className="ufo-date-edit";const t=document.createElement("input");t.type="date",t.value=e.expired_date||"",t.addEventListener("change",()=>{a[n].expired_date=t.value}),d.appendChild(t)}const u=document.createElement("div");u.className="ufo-actions";const p=t("‚Üë",e=>{e.preventDefault(),e.stopPropagation(),n>0&&([a[n-1],a[n]]=[a[n],a[n-1]],w())}),f=t("‚Üì",e=>{e.preventDefault(),e.stopPropagation(),n<a.length-1&&([a[n],a[n+1]]=[a[n+1],a[n]],w())}),h=t("‚úï",t=>{if(t.preventDefault(),t.stopPropagation(),a.splice(n,1),!r.allowMultiAdd){const t=m.querySelector(`.ufo-card[data-id="${e.id}"]`);t&&t.classList.remove("disabled")}w()});u.append(p,f,h),o.append(i,s,u,l),d&&o.appendChild(d);return o}(e,n);h.appendChild(o)}),n(h)}return h.className="ufo-selected",h.id=i+"-selected",f.appendChild(h),l.append(d,f),s.append(c,l),r.mountEl&&r.mountEl.appendChild(s),r.library.forEach(e=>m.appendChild(g(e))),function(e){let t=null;e.addEventListener("dragstart",e=>{const n=e.target.closest(".ufo-card");n&&(t=parseInt(n.dataset.index,10),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",""))}),e.addEventListener("dragover",e=>{e.preventDefault();const n=e.target.closest(".ufo-card");if(!n||null===t)return;const o=parseInt(n.dataset.index,10);if(t===o)return;const r=a[t];a.splice(t,1),a.splice(o,0,r),t=o,w()}),e.addEventListener("drop",e=>{e.preventDefault(),t=null}),e.addEventListener("dragend",()=>{t=null})}(h),p.addEventListener("input",()=>{const e=p.value.trim();m.querySelectorAll(".ufo-card").forEach(t=>{t.style.display=!e||t.dataset.id.includes(e)?"":"none"}),o(m)}),new MutationObserver(()=>n(h)).observe(h,{childList:!0,subtree:!0,attributes:!0}),new MutationObserver(()=>o(m)).observe(m,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["style","class"]}),window.addEventListener("resize",()=>{o(m),n(h)}),o(m),n(h),{details:s,init:function(e){Array.isArray(e)&&(a=[],e.forEach(e=>{if(a.push({...e}),!r.allowMultiAdd){const t=m.querySelector(`.ufo-card[data-id="${e.id}"]`);t&&t.classList.add("disabled")}}),w())},getData:function(){return a.map(e=>{const t=document.createElement("div");if(t.innerHTML=e.content.trim(),r.expirableAttr){const n=t.querySelector("img");if(n){const t=n.parentNode.querySelector(".coupon_deadline");t&&t.remove();const o=document.createElement("span");if(o.className="coupon_deadline",e.expired_date){const t=e.expired_date.split("-");if(3===t.length){const e=t[0].slice(2),n=t[1],r=t[2];o.textContent=`${r}/${n}/${e}`}}n.nextSibling?n.parentNode.insertBefore(o,n.nextSibling):n.parentNode.appendChild(o)}}if(e.title){t.querySelectorAll(`[${r.editableAttr}]`).forEach(t=>{t.setAttribute(r.editableAttr,e.title)})}const n={id:e.id,title:e.title||"",content:t.innerHTML.trim()};return Object.keys(e).forEach(t=>{"id"!==t&&"title"!==t&&"content"!==t&&(n[t]=e[t])}),n})}}}}(),function(){"use strict";window.setupSkinsJSON=async function(e,t={}){if(!(e&&e instanceof HTMLElement))throw new Error("[setupSkinsJSON] container –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –∏ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å HTMLElement");if("function"!=typeof window.createChoicePanelJSON)throw new Error("[setupSkinsJSON] createChoicePanelJSON –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ —Ñ–∞–π–ª —Å –ø–∞–Ω–µ–ª—å—é —Ä–∞–Ω—å—à–µ.");if(window.__skinsSetupJSONMounted)return window.__skinsSetupJSONMounted;const n=t.withHeaders??!0,o=t.startOpen??!1,r=t.initialData||{};if("function"!=typeof window.fetchAllLibraries)return void console.error("[setupSkinsJSON] window.fetchAllLibraries –Ω–µ –Ω–∞–π–¥–µ–Ω–∞. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ fetch_libraries.js");const i=await window.fetchAllLibraries(),a=i.plashka,s=i.icon,c=i.back,l=i.gift,d=i.coupon;let u=e.querySelector(".skins-setup-grid");u||(u=document.createElement("div"),u.className="skins-setup-grid",u.style.display="grid",u.style.gridTemplateColumns="1fr",u.style.gap="16px",e.appendChild(u));const p=window.createChoicePanelJSON({title:n?"–ü–æ–¥–∞—Ä–∫–∏":void 0,targetClass:"_gift",library:l,mountEl:u,startOpen:o,allowMultiAdd:!0}),m=window.createChoicePanelJSON({title:n?"–ö—É–ø–æ–Ω—ã":void 0,targetClass:"_coupon",library:d,mountEl:u,startOpen:o,allowMultiAdd:!0,expirableAttr:"data-expired-date"}),f=window.createChoicePanelJSON({title:n?"–ü–ª–∞—à–∫–∏":void 0,targetClass:"_plashka",library:a,mountEl:u,startOpen:o}),h=window.createChoicePanelJSON({title:n?"–ò–∫–æ–Ω–∫–∏":void 0,targetClass:"_icon",library:s,mountEl:u,startOpen:o}),g=window.createChoicePanelJSON({title:n?"–§–æ–Ω":void 0,targetClass:"_background",library:c,mountEl:u,startOpen:o});r.gift&&p.init(r.gift),r.coupon&&m.init(r.coupon),r.plashka&&f.init(r.plashka),r.icon&&h.init(r.icon),r.background&&g.init(r.background);const w={getData:function(){return{icon:h.getData(),plashka:f.getData(),background:g.getData(),gift:p.getData(),coupon:m.getData()}},getLibraryIds:function(){return{icon:new Set(s.map(e=>String(e.id))),plashka:new Set(a.map(e=>String(e.id))),background:new Set(c.map(e=>String(e.id))),gift:new Set(l.map(e=>String(e.id))),coupon:new Set(d.map(e=>String(e.id)))}},panels:{plashka:f,icon:h,back:g,gift:p,coupon:m}};return window.__skinsSetupJSONMounted=w,w}}(),function(){"use strict";if(window.__profileRunnerJSONMounted)return;window.__profileRunnerJSONMounted=!0;const e=(e,t=document)=>t.querySelector(e);async function t(){await new Promise(e=>{if("complete"===document.readyState||"interactive"===document.readyState)return e();document.addEventListener("DOMContentLoaded",()=>e(),{once:!0})});const t=e("#viewprofile .container")||e("#viewprofile")||e("#pun-main")||document.body,n=document.createElement("div");return n.id="fmv-skins-panel",n.style.margin="16px 0",n.innerHTML='\n       <details open style="border:1px solid #d6d6de;border-radius:10px;background:#fff">\n        <summary style="list-style:none;padding:10px 14px;border-bottom:1px solid #e8e8ef;border-radius:10px;font-weight:600;background:#f6f7fb;cursor:pointer">\n          –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∫–∏–Ω–æ–≤\n        </summary>\n        <div class="fmv-skins-body" style="padding:14px"></div>\n        <div class="fmv-skins-footer" style="display:flex;gap:8px;align-items:center;padding:10px 14px;border-top:1px solid #eee">\n          <button type="button" class="fmv-save"\n            style="background:#2f67ff;color:#fff;border:1px solid #2f67ff;border-radius:8px;padding:8px 14px;cursor:pointer">\n            –°–æ—Ö—Ä–∞–Ω–∏—Ç—å\n          </button>\n          <span class="fmv-status" style="margin-left:8px;font-size:14px;color:#666"></span>\n        </div>\n      </details>\n    ',t.appendChild(n),n.querySelector(".fmv-skins-body")}(async()=>{if("/profile.php"!==location.pathname)return;const e=new URLSearchParams(location.search);if(!e.has("id")||[...e.keys()].some(e=>"id"!==e))return;const n=(e.get("id")||"").trim();if(!n)return;const o=window.SKIN?.GroupID||[];if("function"!=typeof window.ensureAllowed)return;if(!await window.ensureAllowed(o))return;const r=await t();let i=null,a=null;if("function"==typeof window.setupSkinsJSON)try{const e=await window.setupSkinsJSON(r,{initialData:{}});e&&"function"==typeof e.getData&&(i=e.getData),e&&"function"==typeof e.getLibraryIds&&(a=e.getLibraryIds)}catch(e){console.error("setupSkinsJSON() error:",e)}if(!i||!a)return void console.error("[profile_runner_json] –ù–µ —É–¥–∞–ª–æ—Å—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–∞–Ω–µ–ª–∏");const s=a();if(!window.skinAdmin||"function"!=typeof window.skinAdmin.load)return void console.error("[profile_runner_json] skinAdmin.load –Ω–µ –Ω–∞–π–¥–µ–Ω.");const{status:c,visibleData:l,save:d}=await window.skinAdmin.load(n,s);if("ok"!==c&&"–æ–∫"!==c)return void console.error("[profile_runner_json] –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Å–æ —Å–∫–∏–Ω–∞–º–∏");if(window.__skinsSetupJSONMounted&&window.__skinsSetupJSONMounted.panels){const e=window.__skinsSetupJSONMounted.panels;l.gift&&e.gift&&e.gift.init(l.gift),l.coupon&&e.coupon&&e.coupon.init(l.coupon),l.plashka&&e.plashka&&e.plashka.init(l.plashka),l.icon&&e.icon&&e.icon.init(l.icon),l.background&&e.back&&e.back.init(l.background)}const u=document.getElementById("fmv-skins-panel"),p=u?.querySelector(".fmv-save"),m=u?.querySelector(".fmv-status");p&&p.addEventListener("click",async()=>{try{m&&(m.textContent="–°–æ—Ö—Ä–∞–Ω—è—é‚Ä¶",m.style.color="#666");const e=i?i():null;if(!e)return void(m&&(m.textContent="–ù–µ—á–µ–≥–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å",m.style.color="#c24141"));let t=null;if("function"!=typeof d)return void(m&&(m.textContent="–ù–µ—Ç —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è",m.style.color="#c24141"));t=await d(e);const n=!(!t||!t.ok&&"saved"!==t.status&&"—É—Å–ø–µ—à–Ω–æ"!==t.status&&"ok"!==t.status);m&&(n?(m.textContent="‚úì –£—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ",m.style.color="#16a34a",setTimeout(()=>location.reload(),1e3)):(m.textContent="–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è",m.style.color="#c24141"))}catch(e){console.error(e),m&&(m.textContent="–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è",m.style.color="#c24141")}})})()}(),
/*!
 * money-upd-slim.js ‚Äî –æ–¥–∏–Ω —ç–∫—Å–ø–æ—Ä—Ç: getFieldValue({ doc, fieldId }) -> string
 * - –ó–∞–º–µ–Ω—è–µ—Ç <!-- main: usrN --> –≤ li#pa-fldN
 * - –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç window.MainUsrFieldResolver.getFieldValue
 */
function(){"use strict";if(!window.PROFILE_FIELDS?.MoneyID)return void console.error("–û—à–∏–±–∫–∞: –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ PROFILE_FIELDS.MoneyID");const e=String(window.PROFILE_FIELDS?.MoneyID),t=`pa-fld${e}`,n=CSS.escape||(e=>String(e).replace(/[^a-zA-Z0-9_-]/g,"\\$&")),o=/^\s*main:\s*usr(\d+)\s*$/i,r=e=>`#${n(e)}, .${n(e)}`,i=new TextDecoder("utf-8");let a;async function s(e){const t=await fetch(e,{credentials:"same-origin"}),n=await t.arrayBuffer();let o=i.decode(n);if(/charset\s*=\s*windows-1251/i.test(o)||o.includes("ÔøΩ"))try{o=(a||=new TextDecoder("windows-1251")).decode(n)}catch{}return o}function c(e,t){const n=e.querySelector(r(t)),o=n?.querySelector("strong, b");let i=o?.textContent?.trim();if(!i){const e=(n?.textContent||"").trim();i=e.split(":").slice(-1)[0]?.trim()}return(i||"").replace(/\u00A0/g," ").trim()}const l=new Map;function d(e,t){if(l.has(e))return l.get(e);const n=(async()=>{const n=await s(`/profile.php?id=${encodeURIComponent(e)}`);return c((new DOMParser).parseFromString(n,"text/html"),t)})();return l.set(e,n),n}function u(){document.querySelectorAll(r(t)).forEach(e=>function(e,t){const n=document.createTreeWalker(e,NodeFilter.SHOW_COMMENT),r=[];for(let e;e=n.nextNode();){const t=(e.nodeValue||"").match(o);t&&r.push({node:e,uid:t[1]})}r.forEach(({node:e,uid:n})=>{d(n,t).then(t=>{e?.isConnected&&e.replaceWith(document.createTextNode(t))}).catch(e=>console.error("[main-field] replace error usr"+n,e))})}(e,t))}window.MainUsrFieldResolver=window.MainUsrFieldResolver||{},window.MainUsrFieldResolver.getFieldValue||(window.MainUsrFieldResolver.getFieldValue=async function({doc:t=document,fieldId:n}={}){const i=`pa-fld${String(n??e).replace(/\D/g,"")||e}`,a=function(e){if(!e)return null;const t=e.ownerDocument.createTreeWalker(e,NodeFilter.SHOW_COMMENT);for(let e;e=t.nextNode();){const t=(e.nodeValue||"").match(o);if(t)return t[1]}return null}(t.querySelector(r(i)));if(a)try{return await d(a,i)}catch(e){console.warn("[main-field] remote error:",e)}return c(t,i)}),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",u,{once:!0}):u()}();const IP_ROWS=1,IP_GAP=8,IP_REQUIRED=!0;function isProfileFieldsPage(){try{const e=new URL(location.href);if(!/\/profile\.php$/i.test(e.pathname))return!1;const t=e.searchParams;if("fields"!==t.get("section"))return!1;const n=t.get("id");return!!n&&/^\d+$/.test(n)}catch{return!1}}const STYLE_ID="ip-style-clean";function injectStylesOnce(){if(document.getElementById(STYLE_ID))return;const e=document.createElement("style");e.id=STYLE_ID,e.textContent="\n    /* —Å–∫—Ä—ã–≤–∞–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π textarea/input */\n    .ip-hidden {\n      display: none !important;\n      resize: none !important;\n      visibility: hidden !important;\n    }\n\n    /* –ë–µ–ª—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–æ–¥—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –ø–æ–¥ —à–∏—Ä–∏–Ω—É –∫–æ–Ω—Ç–µ–Ω—Ç–∞ */\n    .ip-box {\n      position: relative;\n      display: inline-block;          /* —à–∏—Ä–∏–Ω–∞ = –∫–æ–Ω—Ç–µ–Ω—Ç—É */\n      max-width: 100%;\n      border: 1px solid #ccc;\n      border-radius: 10px;\n      background: #fff;\n      padding: 6px;\n    }\n\n    /* –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π —Å–∫—Ä–æ–ª–ª */\n    .ip-scroll {\n      overflow-y: auto;\n      overflow-x: hidden;\n      -webkit-overflow-scrolling: touch;\n      max-height: calc(var(--ip-rows,1) * var(--ip-h,44px)\n                      + (var(--ip-rows,1) - 1) * var(--ip-gap,8px));\n    }\n\n    /* –°–µ—Ç–∫–∞: –ø–µ—Ä–µ–Ω–æ—Å –≤–Ω–∏–∑, —à–∏—Ä–∏–Ω–∞ –ø–æ –∫–æ–Ω—Ç–µ–Ω—Ç—É */\n    .ip-grid {\n      display: flex;\n      flex-wrap: wrap;\n      gap: var(--ip-gap,8px);\n      align-content: flex-start;\n      justify-content: flex-start;\n    }\n\n    .ip-btn {\n      position: relative;\n      overflow: hidden;\n      width: var(--ip-w,44px);\n      height: var(--ip-h,44px);\n      border: 2px solid #d0d0d0;\n      border-radius: 10px;\n      background: #fff;\n      padding: 0;\n      cursor: pointer;\n      touch-action: manipulation;\n    }\n    .ip-btn[selected] {\n      border-color: #0b74ff;\n      box-shadow: 0 0 0 3px rgba(11,116,255,.15);\n    }\n\n    .ip-slot {\n      position: relative;\n      width: 100%;\n      height: 100%;\n    }\n    .ip-slot img {\n      width: 100%;\n      height: 100%;\n      display: block;\n      object-fit: cover;\n    }\n    .ip-slot * {\n      pointer-events: none;\n    }\n  ",document.head.appendChild(e)}function resolveFieldBySuffix(e){const t=`fld${String(e)}`,n=`form[fld${String(e)}]`;return document.querySelector(`#${CSS.escape(t)}[name="${n}"]`)||document.getElementById(t)||document.querySelector(`[name="${n}"]`)}function normalizeModalLinkAttrs(e){const t=document.createElement("template");return t.innerHTML=String(e??""),t.content.querySelectorAll("a.modal-link").forEach(e=>{Array.from(e.attributes).forEach(t=>{"class"!==t.name&&"style"!==t.name&&e.removeAttribute(t.name)})}),t.innerHTML.trim()}function prepareModalLinkAttrs(e){const t=document.createElement("template");t.innerHTML=String(e??"");const n=t.content.querySelectorAll("a.modal-link");if(n.length){const e=new URL(location.href).searchParams.get("id"),t=e&&/^\d+$/.test(e)?`usr${e}`:null;n.forEach(e=>{e.setAttribute("data-reveal-id","character"),t&&e.setAttribute("id",t)})}return t.innerHTML.trim()}function createThumbSlot(e){const t=document.createElement("div");t.className="ip-slot";const n=String(e??"").trim();if(!n)return t;const o=document.createElement("template");if(o.innerHTML=n,o.content.querySelector("*"))t.appendChild(o.content.cloneNode(!0));else{const e=document.createElement("img");e.src=n,e.alt="",e.loading="lazy",t.appendChild(e)}return t}function keyFor(e){const t=String(e??"");let n=5381;for(let e=0;e<t.length;e++)n=(n<<5)+n^t.charCodeAt(e);return"k"+(n>>>0).toString(36)}const FORM_STATE=new WeakMap;function applyImagePicker(e,t,n={}){if(!isProfileFieldsPage())return;injectStylesOnce();const o=!!n.modalLinkMode,r=(Array.isArray(e)?e:[]).map(e=>String(e??"")),i=resolveFieldBySuffix(t);if(!i)return;i.classList.add("ip-hidden");const a=Number.isFinite(n.btnWidth)?Math.max(1,n.btnWidth):44,s=Number.isFinite(n.btnHeight)?Math.max(1,n.btnHeight):44,c=Number.isFinite(n.gridColSize)?Math.max(1,n.gridColSize):a,l=r.map(e=>o?normalizeModalLinkAttrs(e):e),d=new Set(l),u=new Map(l.map(e=>[e,keyFor(e)])),p=o?normalizeModalLinkAttrs(String(i.value??"")):String(i.value??"");let m=null;if(r.length>0){const e=document.createElement("div");e.className="ip-box",e.style.setProperty("--ip-rows",String(1)),e.style.setProperty("--ip-gap","8px"),e.style.setProperty("--ip-w",`${a}px`),e.style.setProperty("--ip-h",`${s}px`),e.style.setProperty("--ip-col",`${c}px`);const t=document.createElement("div");t.className="ip-scroll";const n=document.createElement("div");n.className="ip-grid";const d=i.id?document.querySelector(`label[for="${i.id}"]`):null;(i.closest("label")||d||i).insertAdjacentElement("afterend",e),t.addEventListener("pointerdown",e=>e.stopPropagation()),t.addEventListener("click",e=>e.stopPropagation()),l.forEach((e,t)=>{const i=document.createElement("button");i.type="button",i.className="ip-btn",i.dataset.key=u.get(e);const a=o?e:r[t];i.appendChild(createThumbSlot(a));const s=t=>{t.preventDefault(),t.stopPropagation(),g(e)};i.addEventListener("pointerdown",s),i.addEventListener("click",s),n.appendChild(i)}),t.appendChild(n),e.appendChild(t),m=n}function f(e){if(!m)return;const t=u.get(String(e))||"";if(m.querySelectorAll(".ip-btn").forEach(e=>e.removeAttribute("selected")),t){const e=m.querySelector(`.ip-btn[data-key="${t}"]`);e&&e.setAttribute("selected","")}}let h=!1;function g(e){const t=String(e??"");i.value!==t&&(h=!0,i.value=t,i.dispatchEvent(new Event("input",{bubbles:!0})),i.dispatchEvent(new Event("change",{bubbles:!0})),h=!1),f(t)}const w=l[0]||"",y=r.length?d.has(p)?p:w:"";i.dataset.ipInitial=y,g(y),i.addEventListener("input",()=>{h||f(o?normalizeModalLinkAttrs(String(i.value??"")):String(i.value??""))}),i.addEventListener("change",()=>{h||f(o?normalizeModalLinkAttrs(String(i.value??"")):String(i.value??""))});const v=i.closest("form");if(!v)return{set:g};let b=FORM_STATE.get(v);b||(b={entries:[],hooked:!1},FORM_STATE.set(v,b));if(b.entries.push({input:i,fieldSuffix:t,prepareOne:()=>{let e=o?normalizeModalLinkAttrs(String(i.value??"")):String(i.value??"");if(!r.length){const e=o?prepareModalLinkAttrs(""):"";return i.value=e,e}if(!d.has(e)){const t=i.dataset.ipInitial??w;e=String(t),g(e)}const t=o?prepareModalLinkAttrs(e):e;return i.value=t,t}}),!b.hooked){b.hooked=!0;const e=v.submit,t=()=>{b.entries.forEach(({prepareOne:e})=>{e()})};v.addEventListener("submit",e=>{"1"!==v.dataset.ipResuming&&t()},!0),v.addEventListener("formdata",e=>{t(),b.entries.forEach(({input:t,fieldSuffix:n})=>{try{const o=t.name||`form[fld${n}]`;e.formData.set(o,t.value)}catch(e){}})}),v.submit=function(...n){return"1"===v.dataset.ipResuming||t(),e.apply(this,n)}}return{set:g}}async function FMVreplaceFieldData(e,t,n,o=!1){const r=`/profile.php?section=fields&id=${encodeURIComponent(e)}&nohead`,i="#fld"+t;try{const e=await fetchCP1251Doc(r),s=e.querySelector("form#profile8")||[...e.querySelectorAll("form")].find(e=>(e.action||"").includes("/profile.php"));if(!s)return{status:"error",fieldId:String(t),value:n,serverMessage:"–§–æ—Ä–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞",details:"profile.php –±–µ–∑ —Ñ–æ—Ä–º—ã"};const c=s.querySelector(i);if(!c)return{status:"error",fieldId:String(t),value:n,serverMessage:`–ü–æ–ª–µ ${i} –Ω–µ –Ω–∞–π–¥–µ–Ω–æ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–æ–º–µ—Ä fld.`};const l=c.value??"";if(""!==(a=l)&&" "!==a&&!o)return{status:"nochange",fieldId:String(t),value:n,serverMessage:"–ü–æ–ª–µ —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –∑–Ω–∞—á–µ–Ω–∏–µ. –ü–µ—Ä–µ–∑–∞–ø–∏—Å—å –∑–∞–ø—Ä–µ—â–µ–Ω–∞.",details:`–ü—Ä–µ–∂–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: ${String(l)}`};if(c.value=n,![...s.elements].some(e=>"update"===e.name)){const t=e.createElement("input");t.type="hidden",t.name="update",t.value="1",s.appendChild(t)}let d="update";const u=[...s.elements].find(e=>"submit"===e.type&&(e.name||/—Å–æ—Ö—Ä–∞–Ω|–æ–±–Ω–æ–≤/i.test(e.value||"")));u?.name&&(d=u.name);const p=serializeFormCP1251_SelectSubmit(s,d),m=s.getAttribute("action")||"/profile.php",{res:f}=await fetchCP1251Text(m,{method:"POST",credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded"},referrer:r,referrerPolicy:"strict-origin-when-cross-origin",body:p});if(!f.ok)return{status:"error",fieldId:String(t),value:n,httpStatus:f.status,serverMessage:`HTTP ${f.status} –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏`};const h=await fetchCP1251Doc(r),g=h.querySelector("form#profile8")||[...h.querySelectorAll("form")].find(e=>(e.action||"").includes("/profile.php"));return(g?.querySelector(i)?.value??null)===n?{status:"updated",fieldId:String(t),value:n,httpStatus:f.status,serverMessage:"–ó–Ω–∞—á–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–æ"}:{status:"uncertain",fieldId:String(t),value:n,httpStatus:f.status,serverMessage:"–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Ä—É—á–Ω—É—é"}}catch(e){const t=e&&e.message?e.message:String(e),n=new Error("Transport/Runtime error: "+t);throw n.cause=e,n}var a}async function FMVupdateGroupIfEquals(e,t,n,o={}){const r=!!o.overwriteSame,i=String(e),a=`/profile.php?section=admin&id=${encodeURIComponent(i)}&nohead`;try{const e=await fetchCP1251Doc(a),o=e.querySelector("form#profile8")||[...e.querySelectorAll("form")].find(e=>(e.action||"").includes("/profile.php"));if(!o)return{status:"error",userId:i,fromGroupId:String(t),toGroupId:String(n),serverMessage:"–§–æ—Ä–º–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞",details:"profile.php?section=admin –±–µ–∑ –æ–∂–∏–¥–∞–µ–º–æ–π —Ñ–æ—Ä–º—ã"};const s=o.querySelector('select[name="group_id"]')||o.querySelector("#group_id");if(!s)return{status:"error",userId:i,fromGroupId:String(t),toGroupId:String(n),serverMessage:"–°–µ–ª–µ–∫—Ç–æ—Ä group_id –Ω–µ –Ω–∞–π–¥–µ–Ω"};const c=(s.value??"").trim(),l=String(t).trim(),d=String(n).trim();if(c===d&&!r)return{status:"nochange",userId:i,fromGroupId:l,toGroupId:d,serverMessage:"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –≤ —Ü–µ–ª–µ–≤–æ–π –≥—Ä—É–ø–ø–µ; –ø–µ—Ä–µ–∑–∞–ø–∏—Å—å –æ—Ç–∫–ª—é—á–µ–Ω–∞",details:`current=${c}`};if(c!==l&&(c!==d||!r))return{status:"skipped",userId:i,fromGroupId:l,toGroupId:d,serverMessage:"–¢–µ–∫—É—â–∞—è –≥—Ä—É–ø–ø–∞ –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å fromGroupId ‚Äî –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–µ —Ç—Ä–µ–±—É—é—Ç—Å—è",details:`current=${c}`};if(s.value=d,![...o.elements].some(e=>"form_sent"===e.name)){const t=e.createElement("input");t.type="hidden",t.name="form_sent",t.value="1",o.appendChild(t)}let u="update_group_membership";const p=[...o.elements].find(e=>"submit"===e.type&&(e.name||/—Å–æ—Ö—Ä–∞–Ω|–æ–±–Ω–æ–≤/i.test(e.value||"")));p?.name&&(u=p.name);const m=serializeFormCP1251_SelectSubmit(o,u),f=o.getAttribute("action")||`/profile.php?section=admin&id=${encodeURIComponent(i)}`,{res:h,text:g}=await fetchCP1251Text(f,{method:"POST",credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded"},referrer:a,referrerPolicy:"strict-origin-when-cross-origin",body:m});if(!h.ok)return{status:"error",userId:i,fromGroupId:l,toGroupId:d,httpStatus:h.status,serverMessage:`HTTP ${h.status} –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏`};const w=await fetchCP1251Doc(a),y=w.querySelector("form#profile8")||[...w.querySelectorAll("form")].find(e=>(e.action||"").includes("/profile.php")),v=y?.querySelector('select[name="group_id"]')||y?.querySelector("#group_id"),b=(v?.value??"").trim();return b===d?{status:"updated",userId:i,fromGroupId:l,toGroupId:d,httpStatus:h.status,serverMessage:"–ì—Ä—É–ø–ø–∞ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∞"}:{status:"uncertain",userId:i,fromGroupId:l,toGroupId:d,httpStatus:h.status,serverMessage:"–°–µ—Ä–≤–µ—Ä –æ—Ç–≤–µ—Ç–∏–ª 200, –Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–µ —É–¥–∞–ª–æ—Å—å ‚Äî –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Ä—É—á–Ω—É—é",details:`readback=${b}`}}catch(o){const r=o&&o.message?o.message:String(o);return{status:"error",userId:String(e),fromGroupId:String(t),toGroupId:String(n),serverMessage:"Transport/Runtime error",details:r}}}async function fetchCardsWrappedClean(e,t,n={}){const{isCoupon:o=!1}=n,r=`${location.origin.replace(/\/$/,"")}/viewtopic.php?id=${encodeURIComponent(String(e))}`,i=e=>{const t=document.createElement("div");return t.innerHTML=String(e??""),t.textContent||t.innerText||""},a=e=>(new DOMParser).parseFromString(e,"text/html");const s=a(await async function(e){if("function"==typeof window.fetchHtml)return window.fetchHtml(e);const t="function"==typeof window.fetchWithRetry?window.fetchWithRetry:fetch,n=await t(e,{credentials:"include"}),o=await n.arrayBuffer(),r=/charset=([^;]+)/i.exec(n.headers.get("content-type")||"")?.[1]?.toLowerCase(),i=e=>{try{return new TextDecoder(e).decode(o)}catch{return null}};if(r){const e=i(r);if(e)return e}const a=i("utf-8")??"",s=i("windows-1251")??"",c=e=>(e.match(/\uFFFD/g)||[]).length;if(c(s)&&!c(a))return a;if(c(a)&&!c(s))return s;const l=e=>(e.match(/[\u0400-\u04FF]/g)||[]).length;return l(s)>l(a)?s:a}(r)),c=[];for(const e of t){const t=s.querySelector(`#p${String(e)}-content`);if(!t){console.warn(`–ù–µ –Ω–∞–π–¥–µ–Ω #p${e}-content –Ω–∞ ${r}`);continue}const n=[...t.querySelectorAll('script[type="text/html"]')];if(!n.length)continue;const l=[...a(i(n.map(e=>e.textContent||e.innerHTML||"").join("\n")).replace(/\u00A0/g," ")).querySelectorAll("#grid article.card")].map(e=>{const t=FMV.normSpace(e.querySelector(".id")?.textContent||""),n=FMV.normSpace(e.querySelector(".desc")?.textContent||""),r=(e.querySelector(".content")?.innerHTML||"").replace(/\u00A0/g," ").trim(),i=n?` title="${n}"`:"";let a="";if(o){const t=FMV.normSpace(e.querySelector(".title")?.textContent||""),n=FMV.normSpace(e.querySelector(".type")?.textContent||""),o=FMV.normSpace(e.querySelector(".form")?.textContent||""),r=FMV.normSpace(e.querySelector(".value")?.textContent||"");a=`${t?` data-coupon-title="${t}"`:""}${n?` data-coupon-type="${n}"`:""}${o?` data-coupon-form="${o}"`:""}${r?` data-coupon-value="${r}"`:""}`}return{id:t,html:`<div class="item" data-id="${t}"${i}${a}>${r}</div>`}});c.push(...l)}return c}function findChronoRendered(e){const t=Array.from(e.querySelectorAll("*")).find(e=>/–°–æ–±—Ä–∞–Ω–Ω–∞—è\s+—Ö—Ä–æ–Ω–æ–ª–æ–≥–∏—è/i.test(e.textContent||""));return t?t.closest(".quote-box, .media, .spoiler-box, .content, .post, div, section")||t:null}function renderStatus(e,t){const n=window.CHRONO_CHECK?.EpisodeMapType||{personal:["personal","black"],plot:["plot","black"],au:["au","black"]},o=window.CHRONO_CHECK?.EpisodeMapStat||{on:["active","green"],off:["closed","teal"],archived:["archived","maroon"]},r=n[e]||n.au,i=o[t]||o.archived;return`[color=${r[1]}]${r[0]}[/color] / [color=${i[1]}]${i[0]}[/color]`}function parseParagraph(e){const t=[[],[],[],[]];let n=0;for(const o of e.childNodes)1!==o.nodeType||"BR"!==o.tagName?t[n].push(o):n=Math.min(n+1,3);const o=t[0],r=t[1],i=t[2],a=t[3],s=document.createElement("div");o.forEach(e=>s.appendChild(e.cloneNode(!0)));const c=s.querySelector('a[href*="viewtopic.php?id="]')||e.querySelector('a[href*="viewtopic.php?id="]'),{type:l,status:d,order:u,dateStart:p,dateEnd:m,title:f}=parseHeaderNew(o,r,c),{participants:h,masksLines:g}=parseParticipants(i),w=cleanLocation(textFromNodes(a)),y="au"===l?"":p||"",v="au"===l?"":m||y||"";return{type:l,status:d,title:f,href:c?.href||"",dateStart:y,dateEnd:v,order:Number.isFinite(u)?u:0,participants:h,masksLines:g,location:w}}function parseHeaderNew(e,t,n){const o=(n?.textContent||"").trim(),r=document.createElement("div");e.forEach(e=>r.appendChild(e.cloneNode(!0)));const i=(r.textContent||"").replace(/\s+/g," ").trim();let a="",s="",c=(r.querySelector("strong")?.textContent||"").trim();if(c){const e=c.replace(/[\u2012-\u2015\u2212‚Äî‚Äì‚àí]/g,"-").replace(/\s*-\s*/g,"-").split("-").slice(0,2).map(e=>e.trim());a=e[0]||"",s=e[1]||""}else{const e=i.split(/\s[‚Äî‚Äì-]\s/)[0]?.trim()||"",t=parseDateFlexible(e);if(t&&t.hasDate){const e=e=>null!=e?.y?null!=e.d?`${String(e.d).padStart(2,"0")}.${String(e.m).padStart(2,"0")}.${e.y}`:null!=e.m?`${String(e.m).padStart(2,"0")}.${e.y}`:String(e.y):"";a=e(t.left),s=!t.right||t.right.y===t.left.y&&null==t.right.m&&null==t.right.d?"":e(t.right)}}/–¥–∞—Ç–∞\s+–Ω–µ\s+—É–∫–∞–∑–∞–Ω/i.test(c||"")&&(a="",s="");let l="",d="",u=0;const p=textFromNodes(t).match(/\[([^\]]+)\]/);if(p){const e=p[1].split("/").map(e=>e.trim());if(l=(e[0]||"").toLowerCase(),d=(e[1]||"").toLowerCase(),e[2]){const t=parseInt(e[2],10);Number.isFinite(t)&&(u=t)}}return{type:l,status:d,order:u,dateStart:a,dateEnd:s,title:o}}function parseParticipants(e){const t=[];!function e(n){Array.from(n).forEach(n=>{3===n.nodeType?t.push({t:"text",v:n.nodeValue||""}):1===n.nodeType&&("A"===n.tagName?t.push({t:"link",name:(n.textContent||"").trim(),href:n.href||""}):e(n.childNodes))})}(e);const n=[],o=new Map;let r=null;for(const e of t){if("link"===e.t){const t=e.name;n.push({name:t,href:e.href}),r=t;continue}if("text"===e.t){let t=e.v||"";if(/\b–Ω–µ\s*—É–∫–∞–∑–∞–Ω/i.test(t))return{participants:[],masksLines:[]};t=t.replace(/\[\s*as\s*([^\]]+)\]/gi,(e,t)=>{const n=t.split(/\s*,\s*/).map(e=>e.trim()).filter(Boolean);var i,a;return a=n,(i=r)&&a&&a.length&&(o.has(i)||o.set(i,[]),o.get(i).push(...a)),""}),t.split(",").map(e=>e.trim()).filter(Boolean).forEach(e=>{/^[‚Äì‚Äî-]+$/.test(e)||/^\[.*\]$/.test(e)||(n.push({name:e,href:""}),r=e)})}}const i=[];for(const e of n){const t=o.get(e.name);t&&t.length&&t.forEach(t=>i.push(`${e.name} ‚Äî ${t}`))}return{participants:n,masksLines:i}}function cleanLocation(e){const t=String(e||"").trim();return t?/^–ª–æ–∫–∞—Ü/i.test(t)&&/–Ω–µ\s+—É–∫–∞–∑–∞–Ω/i.test(t)||/^–Ω–µ\s+—É–∫–∞–∑–∞–Ω/i.test(t)?"":t:""}async function collectEpisodesFromForums(e={}){async function t(e,t,n){const o=[],r=new Set;for(const i of t){const t=Promise.resolve().then(()=>n(i));o.push(t),r.add(t);const a=()=>r.delete(t);t.then(a,a),r.size>=e&&await Promise.race(r)}return Promise.all(o)}let n=Array.isArray(e.sections)&&e.sections.length?e.sections.slice():[];if(!n.length){const e=new Set;document.querySelectorAll('a[href*="viewforum.php?id="]').forEach(t=>{const n=String(t.getAttribute("href")||"").match(/viewforum\.php\?id=(\d+)/i);n&&e.add(n[1])}),n=Array.from(e).map(e=>({id:e}))}if(!n.length)return console.warn("[collectEpisodesFromForums] –ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Ä–∞–∑–¥–µ–ª–æ–≤ (sections)"),[];const o=(e,t)=>{try{return new URL(t,e).href}catch{return t}};const r=/[\u2012-\u2015\u2212‚Äî‚Äì‚àí]/g,i=/[.\u2024\u2219\u00B7\u2027\u22C5¬∑‚àô‚Ä¢]/g,a=e=>String(e).padStart(2,"0");function s(e){const t=Number(e);return Number.isFinite(t)?2===String(e).length?t>30?1900+t:2e3+t:t:null}function c(e,t){return new Date(e,t,0).getDate()}function l(e){const t=String(e||"").trim().replace(i,".");let n=t.match(/^(\d{1,2})\.(\d{1,2})\.(\d{2}|\d{4})$/);if(n){const e=+n[1],t=+n[2],o=s(n[3]);return t<1||t>12||(e<1||e>c(o,t))?null:{y:o,m:t,d:e}}if(n=t.match(/^(\d{1,2})\.(\d{2}|\d{4})$/),n){const e=+n[1],t=s(n[2]);if(e>=1&&e<=12)return{y:t,m:e}}if(n=t.match(/^(\d{1,2})\.(\d{1,2})$/),n){const e=+n[1],t=+n[2];return t>=1&&t<=12&&e>=1&&e<=31?{m:t,d:e}:null}return n=t.match(/^(\d{2}|\d{4})$/),n?{y:s(n[1])}:null}function d(e){return null!=e.d?`${a(e.d)}.${a(e.m)}.${e.y}`:null!=e.m?`${a(e.m)}.${e.y}`:String(e.y)}function u(e){let t=String(e||"").trim();if(!t)return{hasDate:!1,display:"",startSort:[0,0,0],endSort:[0,0,0]};t=t.replace(r,"-").replace(i,".").replace(/\s*-\s*/g,"-");const n=t.split("-").slice(0,2);if(1===n.length){const e=l(n[0]);if(!e||!e.y)return{hasDate:!1,display:"",startSort:[0,0,0],endSort:[0,0,0]};const t=[e.y,e.m??0,e.d??0];return{hasDate:!0,display:d(e),startSort:t,endSort:t,left:e,right:e}}const o=n[0].trim(),u=n[1].trim(),p=l(u);if(!p||!p.y)return{hasDate:!1,display:"",startSort:[0,0,0],endSort:[0,0,0]};let m=l(o);const f=o.match(/^\d{1,2}$/);if(f){const e=+f[0];m=null!=p.d&&null!=p.m?{y:p.y,m:p.m,d:e}:null!=p.m?{y:p.y,m:e}:{y:s(e)}}const h=/^\d{1,2}$/.test(o),g=/^\d{1,2}$/.test(u);if(h&&g&&m?.y&&p?.y&&null==m.m&&null==m.d&&null==p.m&&null==p.d&&m.y>p.y){const e=100*Math.floor(p.y/100),t=+o;m.y=e+t}m&&null==m.y&&null!=m.d&&null!=m.m&&p.y&&(m.y=p.y);const w=e=>null==e.d||e.y&&e.m&&e.d>=1&&e.d<=c(e.y,e.m);if(!w(m)||!w(p))return{hasDate:!1,display:"",startSort:[0,0,0],endSort:[0,0,0]};return{hasDate:!0,startSort:[m.y,m.m??0,m.d??0],endSort:[p.y??m.y,p.m??0,p.d??0],display:(y=m,v=p,null!=y.d&&null!=v.d?`${a(y.d)}.${a(y.m)}.${y.y}-${a(v.d)}.${v.m}.${v.y}`:null!=y.m&&null!=v.m?`${a(y.m)}.${y.y}-${a(v.m)}.${v.y}`:`${y.y}-${v.y}`),left:m,right:p};var y,v}function p(e,t){for(let n=0;n<3;n++){const o=(e[n]??0)-(t[n]??0);if(o)return o}return 0}async function m(n,r){let i=o(location.href,`/viewforum.php?id=${n.id}`);const a=new Set,s=[];let c=0;const l=new Set;let d="";for(;i&&!a.has(i)&&c<100;){c++,a.add(i);const u=await FMV.fetchDoc(i),p=new Map;u.querySelectorAll('a[href*="viewtopic.php?id="]').forEach(e=>{const t=o(i,e.getAttribute("href")),n=t.match(/viewtopic\.php\?id=(\d+)/i),r=((a=e)&&(a.innerText??a.textContent)||"").trim();var a;n&&(/^\s*(RSS|Atom)\s*$/i.test(r)||/#p\d+$/i.test(t)||/^\d{1,2}\.\d{1,2}\.\d{2,4}(?:\s+\d{1,2}:\d{2})?$/.test(r)||p.set(n[1],{url:t,title:r}))});const m=Array.from(p.keys()).sort(),h=m.join(",");if(h&&h===d)break;d=h;const g=m.filter(e=>!l.has(e));if(0===g.length)break;g.forEach(e=>l.add(e));const w=Number.isFinite(+e?.concurrencyPerPage)?+e.concurrencyPerPage:6,y=Array.from(p.entries()),v=await t(w,y,async([e,{url:t,title:o}])=>{const i=e?`id:${e}`:`url:${t.replace(/#.*$/,"")}`;if(r.has(i))return null;const a=await f(t,o,n.type,n.status);return a?{key:i,row:a}:null});for(const e of v)e&&(r.add(e.key),s.push(e.row));const b=function(e){const t=e.querySelector('a[rel="next"], a[href*="&p="]:not([rel="prev"])');return t?t.getAttribute("href"):null}(u),S=b?o(i,b):null;if(!S||a.has(S)){i=null;break}i=S}return s}async function f(e,t,n,o){try{const r=await FMV.fetchDoc(e),i=r.querySelector(".post.topicpost .post-content")||r.querySelector(".post.topicpost")||r,a=function(e){const t=(e.querySelector("title")?.textContent||"").trim();if(/\[.+\]\s+.+/.test(t))return t;const n=e.querySelector(".crumbs, .crumbs-nav, #pun-crumbs1 .crumbs, #pun-crumbs1");if(n){const e=(n.textContent||"").replace(/\s+/g," ").trim(),t=e.split("¬ª").pop()?.trim()||"";if(t)return t}const o=e.querySelector('a[href*="viewtopic.php?id="]');return(o?.textContent||"").trim()}(r),s=t||a||"",{dateRaw:c,episode:l}=function(e){const t=String(e||"").trim(),n=t.match(/^\s*\[(.*?)\]\s*(.*)$/s);if(n){const e=(n[1]||"").trim(),t=(n[2]||"").trim(),o=u(e);if(o&&o.hasDate)return{dateRaw:e,episode:t.replace(/\s+/g," ")}}return{dateRaw:"",episode:t.replace(/\s+/g," ")}}(s),p=u(c),m=function(e,t,n){const o=String(t||"").trim();let r=!0;if("plot"===e){const e=/\s\[\s*(?:c|—Å)\s*\]$/i,t=e.test(o);return r=!!n&&t,{title:t?o.replace(e,"").trim():o,ok:r}}if("au"===e){const e=/^(?:\[\s*au\s*\]\s+|\[\s*AU\s*\]\s+)/,t=e.test(o);return r=t,{title:t?o.replace(e,"").trim():o,ok:r}}return{title:o,ok:r}}(n,l||"",p.hasDate),f=FMV.readTagText(i,"characters"),h=FMV.readTagText(i,"location"),g=FMV.readTagText(i,"order"),w=await FMV.buildIdToNameMapFromTags(f),y=FMV.parseCharactersUnified(f,w,window.profileLink),v=y.ok?y.participantsLower:[],b=y.ok?y.masksByCharLower:new Map,S=FMV.parseOrderStrict(g).ok?FMV.parseOrderStrict(g).value:0,x=h?h.split(/\s*[,;]\s*/).map(e=>e.trim().toLowerCase()).filter(Boolean):[],k=v.map(e=>{const t=Array.from(b.get(e)||[]),n=/^user(\d+)$/i.exec(String(e));if(n){const e=n[1];return w&&w.has(e)?{id:e,name:w.get(e),masks:t}:{name:`user${e}`,masks:t}}return{name:String(e),masks:t}}),C=p.hasDate?null!=p.left?.d||null!=p.left?.m?d(p.left):String(p.left?.y??""):"";return{dateStart:C,dateEnd:p.hasDate?null!=p.right?.d||null!=p.right?.m?d(p.right):String(p.right?.y??p.left?.y??""):C||"",title:m.title||"",href:e,type:n,status:o,order:Number(S)||0,location:x.join(", "),participants:k,isTitleNormalized:m.ok,__hasDate:p.hasDate,__startSort:p.startSort,__endSort:p.endSort}}catch{return null}}const h=new Set;let g=[];for(const e of n){const t=await m(e,h);g=g.concat(t)}return g=g.filter(Boolean).sort(function(e,t){const n=!!e.__hasDate;if(n!==!!t.__hasDate)return n?-1:1;if(n){const n=p(e.__startSort,t.__startSort);if(n)return n;const o=p(e.__endSort,t.__endSort);if(o)return o}const o=e.order??0,r=t.order??0;return o!==r?o-r:String(e.title||"").toLowerCase().localeCompare(String(t.title||"").toLowerCase(),"ru",{sensitivity:"base"})}),g.forEach(e=>{delete e.__hasDate,delete e.__startSort,delete e.__endSort}),g}async function collectChronoByUser(e={}){if("function"!=typeof collectEpisodesFromForums)throw new Error("collectEpisodesFromForums –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞");let t=Array.isArray(e.sections)&&e.sections.length?e.sections.slice():[];const n=Number.isFinite(+e.maxPagesPerSection)?+e.maxPagesPerSection:void 0,o=await collectEpisodesFromForums({sections:t,maxPagesPerSection:n}),r=Object.create(null);o.forEach((e,t)=>{Number.isFinite(e.order)||(e.order=t)});for(const e of o){const t=(e.participants||[]).map(e=>{const t=e?.id?String(e.id).trim():"";return t?{id:t,name:(e.name||"").trim(),masks:Array.isArray(e.masks)?e.masks.slice():[]}:null}).filter(Boolean);for(const n of t){const o=t.filter(e=>e!==n).map(e=>({id:e.id,name:e.name,masks:e.masks.slice()})),i={dateStart:e.dateStart||"",dateEnd:e.dateEnd||e.dateStart||"",type:e.type||"",status:e.status||"",title:e.title||"",href:e.href||"",order:Number(e.order||0),location:e.location||"",masks:n.masks||[],participants:o,isTitleNormalized:!!e.isTitleNormalized};r[n.id]||(r[n.id]={name:n.name||"",episodes:[]}),r[n.id].episodes.push(i)}}return r}(async()=>{const e=(...e)=>{false};e(),e(window.SKIN);const t=await collectSkinSets();e();const n=t?.icons||[],o=t?.plashki||[],r=t?.backs||[];e(n.length,o.length,r.length),window.SKIN?.PlashkaFieldID?(e(window.SKIN.PlashkaFieldID),applyImagePicker(o,SKIN.PlashkaFieldID,{btnWidth:229,btnHeight:42,modalLinkMode:!0})):e(),window.SKIN?.BackFieldID?(e(window.SKIN.BackFieldID),applyImagePicker(r,SKIN.BackFieldID,{btnWidth:229,btnHeight:42,modalLinkMode:!0})):e(),window.SKIN?.IconFieldID?(e(window.SKIN.IconFieldID),applyImagePicker(n,SKIN.IconFieldID,{btnWidth:44})):e(),e()})(),function(){"use strict";if(!/\/profile\.php$/i.test(location.pathname))return;if(!/[?&]id=\d+/.test(location.search))return;const e=document.createElement("style");function t(e,t){const n="–ù–µ –Ω–∞–π–¥–µ–Ω–∞";e.classList.add("is-empty"),e.href="#",e.title=t||n,e.textContent=n}var n;e.textContent="\n    #pa-bank-link a.is-empty {\n      color: #999 !important;\n      text-decoration: none !important;\n      pointer-events: none;\n      cursor: default;\n      opacity: .8;\n    }\n  ",(document.head||document.documentElement).appendChild(e),n=async()=>{const e=function(){const e=document.querySelector("#viewprofile #profile-right");if(!e)return null;const t=document.createElement("li");t.id="pa-bank-link",t.innerHTML='\n      <span>–ë–∞–Ω–∫–æ–≤—Å–∫–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è:</span>\n      <strong><a href="#" target="_blank" rel="nofollow noopener" class="is-empty">–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶</a></strong>\n    ';const n=e.querySelector("#pa-last-visit");return n&&n.parentElement===e?n.insertAdjacentElement("afterend",t):e.appendChild(t),t.querySelector("a")}();if(!e)return;if(!await async function(e=8e3,t=250){const n=Date.now();for(;Date.now()-n<=e;){if("function"==typeof window.scrapePostsByAuthorTag)return!0;await new Promise(e=>setTimeout(e,t))}return!1}())return void t(e,"–Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–æ–∏—Å–∫—É");const n=location.search.match(/[?&]id=(\d+)/),o=n?parseInt(n[1],10):null;if(!o)return void t(e,"–Ω–µ—Ç ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ URL");const r=window.FORUMS_IDS?.Bank||[0];try{const n=await window.scrapePostsByAuthorTag(o,r,{title_prefix:"–ì—Ä–∏–Ω–≥–æ—Ç—Ç—Å",stopOnNthPost:1,keywords:"–ò–¢–û–ì–û"});if(Array.isArray(n)&&n.length&&n[0]?.src){const t="string"==typeof window.SITE_URL&&window.SITE_URL.trim()?window.SITE_URL.trim().replace(/\/$/,""):location.origin.replace(/\/$/,"");!function(e,t){e.classList.remove("is-empty"),e.href=t,e.textContent="–ü–æ—Å–ª–µ–¥–Ω—è—è"}(e,`${t}/viewtopic.php?${n[0].src}`,n[0].date_text||n[0].text)}else t(e)}catch(n){console.error("[bank_last_comment] scrapePostsByAuthorTag failed",n),t(e,"–æ—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞")}},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",n,{once:!0}):n()}(),function(){"use strict";if(!/\/profile\.php$/i.test(location.pathname))return;if(!/[?&]id=\d+/.test(location.search))return;const e=document.createElement("style");function t(e,t){const n="–ù–µ –Ω–∞–π–¥–µ–Ω–∞";e.classList.add("is-empty"),e.href="#",e.title=t||n,e.textContent=n}var n;e.textContent="\n    #pa-lastpost-link a.is-empty {\n      color: #999 !important;\n      text-decoration: none !important;\n      pointer-events: none;\n      cursor: default;\n      opacity: .8;\n    }\n  ",(document.head||document.documentElement).appendChild(e),n=async()=>{const e=function(){const e=document.querySelector("#viewprofile #profile-right");if(!e)return null;const t=document.createElement("li");t.id="pa-lastpost-link",t.innerHTML='\n      <span>–ü–æ—Å–ª–µ–¥–Ω–∏–π –ø–æ—Å—Ç:</span>\n      <strong><a href="#" target="_blank" rel="nofollow noopener" class="is-empty">–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶</a></strong>\n    ';const n=e.querySelector("#pa-last-visit");return n&&n.parentElement===e?n.insertAdjacentElement("afterend",t):e.appendChild(t),t.querySelector("a")}();if(!e)return;if(!await async function(e=8e3,t=250){const n=Date.now();for(;Date.now()-n<=e;){if("function"==typeof window.scrapePostsByAuthorTag)return!0;await new Promise(e=>setTimeout(e,t))}return!1}())return void t(e,"–Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–æ–∏—Å–∫—É");const n=location.search.match(/[?&]id=(\d+)/),o=n?parseInt(n[1],10):null;if(!o)return void t(e,"–Ω–µ—Ç ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ URL");const r=[...window.FORUMS_IDS?.PersonalPosts||[1e4],...window.FORUMS_IDS?.PlotPosts||[1e4]];try{const n=await window.scrapePostsByAuthorTag(o,r,{stopOnNthPost:1,comments_only:!0});if(Array.isArray(n)&&n.length&&n[0]?.src){const t="string"==typeof window.SITE_URL&&window.SITE_URL.trim()?window.SITE_URL.trim().replace(/\/$/,""):location.origin.replace(/\/$/,"");!function(e,t,n){e.classList.remove("is-empty"),e.href=t,e.textContent=n||"–ü–æ—Å–ª–µ–¥–Ω—è—è"}(e,`${t}/viewtopic.php?${n[0].src}`,n[0].date_text||"–ü–æ—Å–ª–µ–¥–Ω–∏–π –ø–æ—Å—Ç")}else t(e)}catch(n){console.error("[post_last_comment] scrapePostsByAuthorTag failed",n),t(e,"–æ—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞")}},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",n,{once:!0}):n()}(),(()=>{"use strict";"function"!=typeof window.extractErrorMessage&&(window.extractErrorMessage=()=>""),"function"!=typeof window.extractInfoMessage&&(window.extractInfoMessage=()=>""),"function"!=typeof window.classifyResult&&(window.classifyResult=()=>"unknown"),window.FMV=window.FMV||{},window.FMV.replaceComment=async function(e,t,n){const o="function"==typeof window.getCurrentGroupId?window.getCurrentGroupId():null,r=new Set((e||[]).map(e=>String(Number(e))));if(!o||!r.has(String(Number(o))))return{ok:!1,status:"forbidden",postId:String(t),newText:n,errorMessage:"–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –ø–æ –≥—Ä—É–ø–ø–µ"};const i=parseInt(t,10);if(!Number.isFinite(i))return{ok:!1,status:"badid",postId:String(t),newText:n,errorMessage:`–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π postId: ${t}`};const a=String(i),s=`/edit.php?id=${encodeURIComponent(a)}&action=edit`;try{let e,t,o,r="";try{e=await fetchCP1251Doc(s),r=e.documentElement?e.documentElement.outerHTML:"",o=e.querySelector('textarea#main-reply[name="req_message"], textarea[name="req_message"]'),o&&(t=o.closest("form"))}catch(e){return{ok:!1,status:"transport",postId:a,newText:n,errorMessage:e?.message||String(e)}}if(!t||!o){const e=extractInfoMessage(r)||"",t=extractErrorMessage(r)||"";return{ok:!1,status:classifyResult(r)||"noform",postId:a,newText:n,infoMessage:e,errorMessage:t}}const i=String(o.value||"").trim();o.value=n;const c=[...t.elements].find(e=>"submit"===e.type&&(e.name||/–û—Ç–ø—Ä–∞–≤|–°–æ—Ö—Ä–∞–Ω|Submit|Save/i.test(e.value||"")))?.name||"submit",l=serializeFormCP1251_SelectSubmit(t,c),{res:d,text:u}=await fetchCP1251Text(s,{method:"POST",credentials:"include",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:l,referrer:s,referrerPolicy:"strict-origin-when-cross-origin"}),p=extractInfoMessage(u)||"",m=extractErrorMessage(u)||"",f=classifyResult(u);let h="string"==typeof f?f:f&&(f.status||f.code)?String(f.status||f.code):"unknown";return!d.ok||"unknown"!==h&&""!==h||(h="ok"),d.ok&&"ok"===h?{ok:!0,status:"ok",postId:a,oldText:i,newText:n,httpStatus:d.status}:{ok:!1,status:h,postId:a,oldText:i,newText:n,httpStatus:d.status,infoMessage:p.slice(0,200),errorMessage:m.slice(0,200)}}catch(e){return{ok:!1,status:"transport",postId:String(t),newText:n,errorMessage:e?.message||String(e)}}}})(),function(){"use strict";window.checkChronoFields=function(e=[]){const t=window.CHRONO_CHECK;return!(!t||"object"!=typeof t)&&(!Array.isArray(e)||!e.length||e.every(e=>{const n=t[e];return null!=n&&(Array.isArray(n)?n.length>0:"string"==typeof n?""!==n.trim():"number"==typeof n?Number.isFinite(n):"object"!=typeof n||Object.keys(n).length>0)}))}}(),(()=>{"use strict";if(!checkChronoFields(["GroupID","AmsForumID","ChronoTopicID","TotalChronoPostID","ForumInfo"]))return void console.warn("[button_update_total] –¢—Ä–µ–±—É—é—Ç—Å—è CHRONO_CHECK.GroupID[], AmsForumID[], ChronoTopicID, TotalChronoPostID, ForumInfo");const e=window.CHRONO_CHECK.GroupID.map(Number),t=window.CHRONO_CHECK.AmsForumID.map(String),n=String(window.CHRONO_CHECK.ChronoTopicID).trim(),o=String(window.CHRONO_CHECK.TotalChronoPostID).trim(),r=new URL(`/viewtopic.php?id=${n}#p${o}`,location.href).href,i=window.CHRONO_CHECK.ForumInfo;let a=!1;function s(e="",t=200){const n=String(e).replace(/<[^>]*>/g," ").replace(/\s+/g," ").trim();return n.length>t?n.slice(0,t)+"‚Ä¶":n}createForumButton({allowedGroups:e,allowedForums:t,topicId:n,label:"–æ–±–Ω–æ–≤–∏—Ç—å –æ–±—â–µ–µ —Ö—Ä–æ–Ω–æ",order:1,showStatus:!0,showDetails:!0,showLink:!0,linkText:"–û—Ç–∫—Ä—ã—Ç—å —Å—Å—ã–ª–∫—É",linkHref:r,async onClick(t){if(a)return;a=!0;const n=t?.setStatus||(()=>{}),c=t?.setDetails||(()=>{});t?.setLinkVisible?.(!1),t?.setLink?.("","");try{if(n("–°–æ–±–∏—Ä–∞—é‚Ä¶"),c(""),"function"!=typeof collectEpisodesFromForums)throw new Error("collectEpisodesFromForums –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞");const a=await collectEpisodesFromForums({sections:i});n("–§–æ—Ä–º–∏—Ä—É—é —Ç–µ–∫—Å—Ç‚Ä¶");const d=function(e){const t=(e||[]).map(e=>{const t=renderStatus(e.type,e.status),n="au"===e.type?"":e.dateStart?`[b]${FMV.escapeHtml(e.dateEnd&&e.dateEnd!==e.dateStart?`${e.dateStart}-${e.dateEnd}`:e.dateStart)}[/b]`:"[mark]–¥–∞—Ç–∞ –Ω–µ —É–∫–∞–∑–∞–Ω–∞[/mark]",o=FMV.escapeHtml(e.href||""),r=FMV.escapeHtml(e.title||""),i=e.isTitleNormalized?"":"au"===e.type?" [mark]–≤ –Ω–∞–∑–≤–∞–Ω–∏–∏ –Ω–µ—Ç [au][/mark]":" [mark]–≤ –Ω–∞–∑–≤–∞–Ω–∏–∏ –Ω–µ—Ç [—Å][/mark]",a=`${FMV.escapeHtml(String(e.order??0))}`,s=!0;return`${n}${n?" ‚Äî ":" "}[url=${o}]${r}[/url]${i}\n[${t} / ${a}]\n[i]${Array.isArray(e.participants)&&e.participants.length?e.participants.map(e=>{const t=null!=e.id&&""!==e.id?userLink(String(e.id),e.name,s):missingUser(String(e.name||""),s),n=Array.isArray(e.masks)?e.masks:[];return`${t}${n.length?` [as ${FMV.escapeHtml(n.join(", "))}]`:""}`}).join(", "):"[mark]–Ω–µ —É–∫–∞–∑–∞–Ω—ã[/mark]"}[/i]\n${e.location?FMV.escapeHtml(e.location):"[mark]–ª–æ–∫–∞—Ü–∏—è –Ω–µ —É–∫–∞–∑–∞–Ω–∞[/mark]"}\n\n`});return`[media="–û–±—â–∞—è —Ö—Ä–æ–Ω–æ–ª–æ–≥–∏—è"]${t.join("")||""}[/media]`}(a);n("–ó–∞–ø–∏—Å—ã–≤–∞—é‚Ä¶");const u=FMV.toCp1251Entities(d),p=await FMV.replaceComment(e,o,u),m=null==(l=p.status)?"":"string"==typeof l?l:String("object"==typeof l?l.status||l.code||(l.ok?"ok":"unknown"):l),f=!!p.ok||"ok"===m;n(f?"–ì–æ—Ç–æ–≤–æ":"–û—à–∏–±–∫–∞"),f?(t?.setLink?.(r,"–û—Ç–∫—Ä—ã—Ç—å —Å—Å—ã–ª–∫—É"),t?.setLinkVisible?.(!0)):(t?.setLink?.("",""),t?.setLinkVisible?.(!1));const h=s(p.infoMessage||""),g=s(p.errorMessage||""),w=[`–°—Ç–∞—Ç—É—Å: ${f?"ok":m||"unknown"}`];h&&w.push(h),g&&w.push(`<span style="color:#b00020">${FMV.escapeHtml(g)}</span>`),c(w.join("<br>"))}catch(e){n("‚úñ –æ—à–∏–±–∫–∞","red"),c(FMV.escapeHtmlShort(e?.message||String(e))),t?.setLinkVisible?.(!1),t?.setLink?.("","")}finally{a=!1}var l}}),"function"!=typeof window.userLink&&(window.userLink=(e,t,n=!0)=>n?`[url=/profile.php?id=${FMV.escapeHtml(String(e))}]${FMV.escapeHtml(String(t))}[/url]`:`<a href="/profile.php?id=${FMV.escapeHtml(String(e))}">${FMV.escapeHtml(String(t))}</a>`),"function"!=typeof window.missingUser&&(window.missingUser=(e,t=!0)=>t?`[i]${FMV.escapeHtml(String(e))}[/i]`:`<i>${FMV.escapeHtml(String(e))}</i>`)})(),(()=>{"use strict";if(!checkChronoFields(["GroupID","AmsForumID","ChronoTopicID","TotalChronoPostID","ForumInfo"]))return void console.warn("[button_total_to_excel] –¢—Ä–µ–±—É—é—Ç—Å—è CHRONO_CHECK.GroupID[], AmsForumID[], ChronoTopicID, TotalChronoPostID, ForumInfo");const e=window.CHRONO_CHECK.GroupID.map(Number),t=window.CHRONO_CHECK.AmsForumID.map(String),n=String(window.CHRONO_CHECK.ChronoTopicID).trim(),o=String(window.CHRONO_CHECK.TotalChronoPostID).trim(),r=new URL(`/viewtopic.php?id=${n}#p${o}`,location.href).href,i=(window.SITE_URL||location.origin).replace(/\/+$/,""),a=window.CHRONO_CHECK.ForumInfo;let s="";createForumButton({allowedGroups:e,allowedForums:t,topicId:n,label:"–≤—ã–≥—Ä—É–∑–∏—Ç—å –æ–±—â–µ–µ —Ö—Ä–æ–Ω–æ –≤ excel",order:2,showStatus:!0,showDetails:!0,showLink:!0,linkText:"–°–∫–∞—á–∞—Ç—å",linkHref:"",async onClick(e){const t=e?.setStatus||(()=>{}),n=e?.setDetails||(()=>{}),o=e?.setLink||(()=>{});e?.setLink?.("","");try{t("–°–æ–±–∏—Ä–∞—é‚Ä¶"),n("");const p=await collectEpisodesFromForums({sections:a});if(!p.length)throw new Error("–≠–ø–∏–∑–æ–¥—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.");const h=p.map(e=>{const t=(e.participants||[]).map(e=>{const t=String(e.name||"").trim();if(!t)return"";if(null!=e.id&&""!==e.id){return`${t} ‚Äî ${`${i}/profile.php?id=${encodeURIComponent(String(e.id))}`}`}return t}).filter(Boolean).join("\n"),n=(e.participants||[]).flatMap(e=>{const t=Array.isArray(e.masks)?e.masks.filter(Boolean):[],n=String(e.name||"").trim()||(null!=e.id?`user${e.id}`:"");return t.map(e=>`${n} ‚Äî ${e}`)}).filter(Boolean);return{type:e.type||"",status:e.status||"",title:e.title||"",href:e.href||"",dateStart:e.dateStart||"",dateEnd:e.dateEnd||e.dateStart||"",order:Number(e.order||0)||0,participantsText:t,masksLines:n,location:e.location||""}});t("–§–æ—Ä–º–∏—Ä—É—é —Ñ–∞–π–ª‚Ä¶");const{blob:g,filename:v}=function(e){const t=[],n=(e,n)=>t.push({name:e,data:c(n)}),o='<?xml version="1.0" encoding="UTF-8"?>\n<Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships">\n  <Relationship Id="rId1" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/worksheet" Target="worksheets/sheet1.xml"/>\n</Relationships>',r='<?xml version="1.0" encoding="UTF-8"?>\n<workbook xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main"\n          xmlns:r="http://schemas.openxmlformats.org/officeDocument/2006/relationships">\n  <sheets>\n    <sheet name="–•—Ä–æ–Ω–æ–ª–æ–≥–∏—è" sheetId="1" r:id="rId1"/>\n  </sheets>\n</workbook>';n("[Content_Types].xml",'<?xml version="1.0" encoding="UTF-8"?>\n<Types xmlns="http://schemas.openxmlformats.org/package/2006/content-types">\n  <Default Extension="rels" ContentType="application/vnd.openxmlformats-package.relationships+xml"/>\n  <Default Extension="xml"  ContentType="application/xml"/>\n  <Override PartName="/xl/workbook.xml"          ContentType="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml"/>\n  <Override PartName="/xl/worksheets/sheet1.xml" ContentType="application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml"/>\n</Types>'),n("_rels/.rels",'<?xml version="1.0" encoding="UTF-8"?>\n<Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships">\n  <Relationship Id="rId1" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument" Target="xl/workbook.xml"/>\n</Relationships>'),n("xl/workbook.xml",r),n("xl/_rels/workbook.xml.rels",o),n("xl/worksheets/sheet1.xml",function(e){const t=`<row r="1">${["–¢–∏–ø","–°—Ç–∞—Ç—É—Å","–¢–µ–º–∞","–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞","–î–∞—Ç–∞ –∫–æ–Ω—Ü–∞","–ü–æ—Ä—è–¥–æ–∫","–£—á–∞—Å—Ç–Ω–∏–∫–∏","–ú–∞—Å–∫–∏","–õ–æ–∫–∞—Ü–∏—è"].map(w).join("")}</row>`,n=e.map((e,t)=>`<row r="${t+2}">${[w(e.type||""),w(e.status||""),b(e.href||"",e.title||e.href||""),w(e.dateStart||""),w(e.dateEnd||e.dateStart||""),y(e.order||0),w(e.participantsText||""),w((e.masksLines||[]).join("\n")),w(e.location||"")].join("")}</row>`).join("");return`<?xml version="1.0" encoding="UTF-8"?>\n<worksheet xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main">\n  <sheetData>${t}${n}</sheetData>\n</worksheet>`}(e));const i=function(e){const t=f(),n=[],o=[];let r=0;e.forEach(e=>{const i=c(e.name),a=e.data,s=m(a),p=u([d(67324752),l(20),l(0),l(0),l(t.time),l(t.date),d(s),d(a.length),d(a.length),l(i.length),l(0),i,a]),f=u([d(33639248),l(20),l(20),l(0),l(0),l(t.time),l(t.date),d(s),d(a.length),d(a.length),l(i.length),l(0),l(0),l(0),l(0),d(0),d(r),i]);n.push(p),o.push(f),r+=p.length});const i=u(o),a=n.reduce((e,t)=>e+t.length,0),s=i.length,p=u([d(101010256),l(0),l(0),l(e.length),l(e.length),d(s),d(a),l(0)]);return new Blob([u([...n,i,p])],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"})}(t),a=`chronology_${(new Date).toISOString().slice(0,10)}.xlsx`;return{blob:i,filename:a}}(h);if(s)try{URL.revokeObjectURL(s)}catch{}s=URL.createObjectURL(g),t("‚úì –≥–æ—Ç–æ–≤–æ","green"),n(`–°—Ç—Ä–æ–∫: ${h.length}\n–ò—Å—Ç–æ—á–Ω–∏–∫: ${FMV.escapeHtml(r)}\n–§–∞–π–ª: ${FMV.escapeHtml(v)}`),o(s,"–°–∫–∞—á–∞—Ç—å");const S=e?.wrap?.querySelector("a.fmv-action-link");S&&S.setAttribute("download",v)}catch(o){t("‚úñ –æ—à–∏–±–∫–∞","red"),n(FMV.escapeHtmlShort(o?.message||String(o))),e?.setLink?.("","")}}});const c=e=>(new TextEncoder).encode(e),l=e=>new Uint8Array([255&e,e>>>8&255]),d=e=>new Uint8Array([255&e,e>>>8&255,e>>>16&255,e>>>24&255]),u=e=>{let t=0;e.forEach(e=>t+=e.length);const n=new Uint8Array(t);let o=0;return e.forEach(e=>{n.set(e,o),o+=e.length}),n},p=(()=>{let e,t=new Uint32Array(256);for(let n=0;n<256;n++){e=n;for(let t=0;t<8;t++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e>>>0}return t})(),m=e=>{let t=~0;for(let n=0;n<e.length;n++)t=t>>>8^p[255&(t^e[n])];return(-1^t)>>>0},f=(e=new Date)=>({time:(31&e.getHours())<<11|(63&e.getMinutes())<<5|31&Math.floor(e.getSeconds()/2),date:(e.getFullYear()-1980&127)<<9|(e.getMonth()+1&15)<<5|31&e.getDate()}),h=e=>String(e||"").replace(/[<>&"]/g,e=>({"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;"}[e])),g=e=>String(e||"").replace(/"/g,'""');function w(e){return`<c t="inlineStr"><is><t xml:space="preserve">${h(e).replace(/\r?\n/g,"&#10;")}</t></is></c>`}function y(e){return`<c><v>${Number(e)||0}</v></c>`}function v(e){return`<c><f>${h(e)}</f></c>`}function b(e,t){return e&&t?v(`HYPERLINK("${g(e)}","${g(t)}")`):e&&!t?v(`HYPERLINK("${g(e)}","${g(e)}")`):w(t||"")}})(),(()=>{"use strict";if(!checkChronoFields(["GroupID","AmsForumID","ChronoTopicID","PerPersonChronoPostID","ForumInfo"]))return void console.warn("[button_update_per_user] –¢—Ä–µ–±—É—é—Ç—Å—è CHRONO_CHECK.GroupID[], AmsForumID[], ChronoTopicID, PerPersonChronoPostID, ForumInfo");const e=window.CHRONO_CHECK.GroupID.map(Number),t=window.CHRONO_CHECK.AmsForumID.map(String),n=String(window.CHRONO_CHECK.ChronoTopicID).trim(),o=String(window.CHRONO_CHECK.PerPersonChronoPostID).trim(),r=(window.SITE_URL||location.origin).replace(/\/+$/,""),i=window.CHRONO_CHECK.ForumInfo;"function"!=typeof window.userLink&&(window.userLink=(e,t,n=!0)=>n?`[url=/profile.php?id=${FMV.escapeHtml(String(e))}]${FMV.escapeHtml(String(t))}[/url]`:`<a href="/profile.php?id=${FMV.escapeHtml(String(e))}">${FMV.escapeHtml(String(t))}</a>`),"function"!=typeof window.missingUser&&(window.missingUser=(e,t=!0)=>t?`[i]${FMV.escapeHtml(String(e))}[/i]`:`<i>${FMV.escapeHtml(String(e))}</i>`);const a=e=>String(e||"").trim();function s(e){const t=function(e,t){const n=a(e),o=a(t);return n||o?o&&o!==n?`[b]${n}-${o}[/b]`:`[b]${n}[/b]`:""}(e.dateStart,e.dateEnd),n=`[url=${FMV.escapeHtml(a(e.href))}]${FMV.escapeHtml(a(e.title)||a(e.href))}[/url]`,o=Array.isArray(e.masks)&&e.masks.length?` [as ${FMV.escapeHtml(e.masks.join(", "))}]`:"",r=t?`${t} ‚Äî ${n}${o}`:`${n}${o}`,i=`[${renderStatus(e.type,e.status)} / ${`${FMV.escapeHtml(String(e.order??0))}`}]`,s=function(e=[]){return e.length?`[i]${e.map(e=>{const t=!0;return`${null!=e.id&&""!==String(e.id)?userLink(String(e.id),e.name,t):missingUser(String(e.name||""),t)}${Array.isArray(e.masks)&&e.masks.length?` [as ${FMV.escapeHtml(e.masks.join(", "))}]`:""}`}).join(", ")}[/i]`:""}(e.participants||[]),c=[r,i];return s&&c.push(s),a(e.location)&&c.push(FMV.escapeHtml(a(e.location))),c.join("\n")}const c=`${r}/viewtopic.php?id=${n}#p${o}`;createForumButton({allowedGroups:e,allowedForums:t,topicId:n,label:"–æ–±–Ω–æ–≤–∏—Ç—å —Ö—Ä–æ–Ω–æ –ø–æ –ø–µ—Ä—Å–∞–º",order:3,showStatus:!0,showDetails:!0,showLink:!0,linkText:"–û—Ç–∫—Ä—ã—Ç—å –ø–æ—Å—Ç",linkHref:c,async onClick(t){const l=t?.setStatus||(()=>{}),d=t?.setDetails||(()=>{}),u=t?.setLink||(()=>{}),p=t?.setLinkVisible||(()=>{});u("",""),p?.(!1);try{l("–°–æ–±–∏—Ä–∞—é‚Ä¶"),d("");const t=await(window.collectChronoByUser?window.collectChronoByUser({sections:i}):Promise.reject(new Error("collectChronoByUser –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞"))),m=Object.entries(t||{}).map(([e,t])=>({id:e,name:t?.name||"",episodes:Array.isArray(t?.episodes)?t.episodes:[]})).filter(e=>e.name).sort((e,t)=>e.name.localeCompare(t.name,"ru",{sensitivity:"base"}));if(!m.length)return l("–ü—É—Å—Ç–æ"),void d("–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≤—ã–≤–æ–¥–∞.");l("–§–æ—Ä–º–∏—Ä—É—é —Ç–µ–∫—Å—Ç‚Ä¶");const f=m.map(e=>function(e,t=[]){return`[media="[url=${r}/viewtopic.php?id=${n}]${FMV.escapeHtml(a(e))}[/url]"]\n${t.map(s).join("\n\n")}\n[/media]`}(e.name,e.episodes)).join("\n\n"),h=`[media="–•—Ä–æ–Ω–æ–ª–æ–≥–∏—è –ø–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞–º"]\n${f}\n[/media]`;l("–ó–∞–ø–∏—Å—ã–≤–∞—é‚Ä¶");const g=FMV.toCp1251Entities(h),w=await FMV.replaceComment(e,o,g),y=String(w?.status||""),v=!!w?.ok||"ok"===y;l(v?"–ì–æ—Ç–æ–≤–æ":"–û—à–∏–±–∫–∞"),v?(u(c,"–û—Ç–∫—Ä—ã—Ç—å –ø–æ—Å—Ç"),p?.(!0)):(u("",""),p?.(!1));const b=(w?.infoMessage||"").replace(/<[^>]*>/g," ").trim(),S=(w?.errorMessage||"").replace(/<[^>]*>/g," ").trim(),x=[`–°—Ç–∞—Ç—É—Å: ${v?"ok":y||"unknown"}`];b&&x.push(b),S&&x.push(S),d(x.join("<br>"))}catch(e){l("‚úñ –æ—à–∏–±–∫–∞","red"),d(e?.message||String(e)),u("",""),p?.(!1)}}})})(),(()=>{"use strict";if(!checkChronoFields(["GroupID","AmsForumID","ChronoTopicID","ForumInfo"]))return void console.warn("[button_update_chrono_api] –¢—Ä–µ–±—É—é—Ç—Å—è CHRONO_CHECK.GroupID[], AmsForumID[], ChronoTopicID, ForumInfo");const e=window.CHRONO_CHECK.GroupID.map(Number),t=window.CHRONO_CHECK.AmsForumID.map(String),n=String(window.CHRONO_CHECK.ChronoTopicID).trim(),o=window.CHRONO_CHECK.ForumInfo;function r(e){const t=e.split(".").reduce((e,t)=>e&&e[t],window);if("function"!=typeof t)throw new Error(`${e} –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Äî –ø–æ–¥–∫–ª—é—á–∏—Ç–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Å–∫—Ä–∏–ø—Ç`);return t}async function i(e,t){const n=r("FMVbank.storageGet"),o=r("FMVbank.storageSet"),i=String(e);if(!t||"object"!=typeof t)return{id:i,status:"–Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è"};try{const e=await n(Number(i),"chrono_"),r=e&&"object"==typeof e?e:{};r.chrono=t,r.last_timestamp=Math.floor(Date.now()/1e3);const a=function(e){return!0===e?"—Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ":!1===e?"–æ—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è":String(e)}(await o(r,Number(i),"chrono_"));return{id:i,status:a}}catch(e){return{id:i,status:`–æ—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ${e?.message||e}`}}}function a(e){const t=String(e||"").toLowerCase();return t.includes("–æ—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è")?"–æ—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è":t.includes("–Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö")||t.includes("–Ω–µ –Ω–∞–π–¥–µ–Ω")?"–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —É–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è –≤ —Ö—Ä–æ–Ω–æ–ª–æ–≥–∏–∏":""}window.FMV||(window.FMV={}),"function"!=typeof window.userLinkHtml&&(window.userLinkHtml=(e,t)=>`${FMV.escapeHtml(String(t||e))}`),createForumButton({allowedGroups:e,allowedForums:t,topicId:n,label:"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ö—Ä–æ–Ω–æ–ª–æ–≥–∏—é –≤ API",order:5,showStatus:!0,showDetails:!0,showLink:!1,async onClick(e){const t=e?.setStatus||(()=>{}),n=e?.setDetails||(()=>{});n("");try{t("–°–æ–±–∏—Ä–∞—é‚Ä¶");const e=Array.isArray(window.CHRONO_CHECK?.UserIDs)?window.CHRONO_CHECK.UserIDs:void 0,s=await async function(e){const t=window.FMV&&"function"==typeof FMV.fetchUsers?FMV.fetchUsers:null;let n=[];if(Array.isArray(e)&&e.length)n=e.map(e=>({id:String(e)}));else if(t)try{const e=await t();n=Array.isArray(e)?e:[]}catch{}const o=new Map;for(const e of n){if(!e)continue;const t=String(e.id??""),n=String(e.name??"").trim();t&&o.set(t,n||t)}return o}(e);t("–°–æ—Ö—Ä–∞–Ω—è—é‚Ä¶");const c=await async function(e={}){const t=Number.isFinite(e.delayMs)?e.delayMs:200,n=r("collectChronoByUser"),o=e.sections;let a,s;try{a=await n({sections:o})}catch(e){throw new Error(`–û—à–∏–±–∫–∞ collectChronoByUser: ${e?.message||e}`)}if(!a||"object"!=typeof a)throw new Error("collectChronoByUser –≤–µ—Ä–Ω—É–ª –ø—É—Å—Ç–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç");s=Array.isArray(e.ids)&&e.ids.length?e.ids.map(e=>({id:String(e)})):Object.keys(a).map(e=>({id:String(e)}));const c=[];for(const e of s){const n=a[e.id];if(!n){c.push({id:e.id,status:"–Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —Ö—Ä–æ–Ω–æ-–∫–æ–ª–ª–µ–∫—Ü–∏–∏)"});continue}const o=await i(e.id,n);c.push(o),t&&await FMV.sleep(t)}try{console.table(c.map(e=>({id:e.id,status:e.status})))}catch{}return c}({ids:e,sections:o}),l=[];for(const e of c||[]){const t=a(e?.status);if(!t)continue;const n=String(e?.id||""),o=s.get(n)||n;l.push(`${userLinkHtml(n,o)} ‚Äî ${FMV.escapeHtml(t)}`)}t("‚úì –≥–æ—Ç–æ–≤–æ","green"),n(l.length?l.join("<br>"):"")}catch(e){t("‚úñ –æ—à–∏–±–∫–∞","red"),n(e?.message||String(e))}}})})(),function(){"use strict";var e;window.FMV||(window.FMV={}),window.FMV.fetchUsers||console.warn("[FMV] –ü–æ–¥–∫–ª—é—á–∏—Ç–µ –æ–±—â–∏–π –º–æ–¥—É–ª—å —Å FMV.fetchUsers –¥–æ ui.js"),window.FMV.UI||function(){function e(e){const t=String(e||"").match(/\[FMVcast\]([\s\S]*?)\[\/FMVcast\]/i),n=t&&t[1]?(o=t[1],String(o||"").split(";").map(e=>e.trim()).filter(Boolean)):[];var o;const r={};return n.forEach(e=>{const t=e.match(/^(user\d+)(?:=(.+))?$/i);if(!t)return;const n=t[1],o=(t[2]||"").trim(),i=r[n]||(r[n]={code:n,masks:[]});o&&i.masks.push(o)}),r}function t(e){const t=[];return(e||[]).forEach(e=>{const n=Array.isArray(e.masks)?e.masks.filter(Boolean):[];n.length?n.forEach(n=>t.push(e.code+"="+n)):t.push(e.code)}),t.length?"[FMVcast]"+t.join(";")+"[/FMVcast]":""}function n(e){return(e=String(e||"").trim())?"[FMVplace]"+e+"[/FMVplace]":""}function o(e){let t=parseInt(String(e||"").trim(),10);return Number.isNaN(t)&&(t=0),"[FMVord]"+t+"[/FMVord]"}function r(e){return String(e||"").replace(/\[FMVcast\][\s\S]*?\[\/FMVcast\]/gi,"").replace(/\[FMVplace\][\s\S]*?\[\/FMVplace\]/gi,"").replace(/\[FMVord\][\s\S]*?\[\/FMVord\]/gi,"").replace(/^\s+|\s+$/g,"")}let i=!1;window.FMV.UI={attach:function(a){!function(){if(i)return;i=!0;const e=document.createElement("style");e.textContent="\n        :root{\n          --fmv-bg:#f7f4ea; --fmv-b:#d8d1c3; --fmv-chip:#fff;\n          --fmv-radius:10px; --fmv-gap:8px; --fmv-text:#2d2a26; --fmv-muted:#6b6359;\n        }\n\n        .msg-with-characters.fmv,\n        .msg-with-characters.fmv * { box-sizing: border-box; }\n        .msg-with-characters.fmv { width:100%; max-width:100%; overflow-x:hidden; }\n\n        .msg-with-characters.fmv{margin:10px 0; padding:10px; border:1px solid var(--fmv-b); background:var(--fmv-bg); border-radius:var(--fmv-radius)}\n        .fmv .char-row{display:flex; gap:var(--fmv-gap); align-items:flex-start; flex-wrap:wrap}\n        .fmv .combo{position:relative; flex:1 1 480px; width:100%; max-width:100%}\n        .fmv .combo input,\n        .fmv .place-row input,\n        .fmv .order-row input{\n          width:100%; max-width:100%; height:36px;\n          padding:8px 10px; border:1px solid var(--fmv-b); border-radius:8px;\n          background:#efe9dc; color:var(--fmv-text); font-size:14px;\n        }\n        .fmv .place-row,.fmv .order-row{margin-top:8px; width:100%; max-width:100%}\n        .fmv .order-row label{display:block; margin-bottom:4px; font-weight:600; color:var(--fmv-text)}\n        .fmv .order-hint,.fmv .hint{font-size:12.5px; color:var(--fmv-muted); margin-top:4px; overflow-wrap:anywhere}\n\n        .fmv .ac-list{\n          position:absolute; z-index:50; left:0; right:0; max-width:100%; background:#fff;\n          border:1px solid var(--fmv-b); border-radius:8px; margin-top:4px; max-height:240px; overflow:auto\n        }\n        .fmv .ac-item{padding:.45em .65em; cursor:pointer; font-size:14px}\n        .fmv .ac-item.active,.fmv .ac-item:hover{background:#f0efe9}\n        .fmv .ac-item .muted{color:var(--fmv-muted)}\n\n        .fmv .chips{ max-width:100%; overflow-x:hidden; }\n        .fmv .chips .chip{\n          display:flex; align-items:center; justify-content:flex-start;\n          gap:10px; padding:.45em .6em; background:var(--fmv-chip);\n          border:1px solid var(--fmv-b); border-radius:8px; margin:.35em 0; font-size:14px\n        }\n        .fmv .chip .drag{cursor:grab; margin-right:.4em; color:#8b8378}\n        .fmv .chip .name{font-weight:600}\n\n        .fmv .masks{display:flex; align-items:center; gap:6px; flex-wrap:wrap; color:var(--fmv-muted)}\n        .fmv .masks .masks-label{ color:var(--fmv-muted); margin-right:2px; }\n        .fmv .mask-badge{\n          display:inline-flex; align-items:center; gap:6px;\n          padding:2px 8px; border:1px solid var(--fmv-b); border-radius:999px;\n          background:#efe9dc; font-size:13px; color:var(--fmv-text);\n        }\n        .fmv .mask-badge .mask-remove{\n          border:0; background:none; cursor:pointer; line-height:1;\n          color:#8b8378; font-size:14px; padding:0 2px;\n        }\n\n        .fmv .chip .add-mask{border:0; background:none; color:#2e5aac; cursor:pointer; padding:0; text-decoration:underline; margin-left:auto}\n        .fmv .chip .x{border:0; background:none; font-size:16px; line-height:1; cursor:pointer; color:#8b8378; margin-left:8px}\n\n        .fmv .chip .mask-input{ display:none; margin-left:auto; }\n        .fmv .chip .mask-input.is-open{ display:flex; align-items:center; gap:8px; }\n        .fmv .chip .mask-input input{\n          flex:1; min-width:220px; height:30px;\n          padding:6px 8px; border:1px solid var(--fmv-b); border-radius:6px;\n          background:#efe9dc; color:var(--fmv-text);\n        }\n        .fmv .chip .btn{ border:1px solid var(--fmv-b); border-radius:6px; background:#fff; padding:6px 10px; cursor:pointer; line-height:1; }\n        .fmv .chip .btn-ok{ background:#e9f6e9; }\n        .fmv .chip .btn-cancel{ background:#f4eeee; }\n\n        .fmv-admin-tools{display:flex;justify-content:flex-end;margin:6px 0 8px}\n        .fmv-admin-tools .fmv-toggle{border:1px solid var(--fmv-b);background:#fff;border-radius:8px;padding:6px 10px;cursor:pointer}\n\n        /* –∑–∞–≥–æ–ª–æ–≤–æ–∫ –±–ª–æ–∫–∞ */\n        .fmv .section-title{\n          font-weight:700;\n          font-size:14px;\n          text-align: center;\n          line-height:1.25;\n          margin:4px 0 12px;\n          color: var(--fmv-text);\n        }\n\n        /* –¥–µ–ª–∞–µ–º ¬´–∫–æ–ª–æ–Ω–∫—É¬ª —Å —Ä–∞–≤–Ω—ã–º —à–∞–≥–æ–º –∏ –±–µ–∑ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö margin */\n        .fmv .combo,\n        .fmv .place-row,\n        .fmv .order-row {\n          display: grid;\n          grid-template-columns: 1fr;\n          row-gap: 8px;             /* –≤–æ—Ç —ç—Ç–∏–º —É–ø—Ä–∞–≤–ª—è–µ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ–º –º–µ–∂–¥—É label ‚Üî input ‚Üî hint */\n        }\n        \n        .fmv .place-row label,\n        .fmv .order-row label,\n        .fmv .combo label,\n        .fmv .place-row .hint,\n        .fmv .order-row .order-hint,\n        .fmv .combo .hint {\n          margin: 0;                /* —É–±–∏—Ä–∞–µ–º –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç—Å—Ç—É–ø—ã, —á—Ç–æ–±—ã –æ–Ω–∏ –Ω–µ ¬´—Å—Ö–ª–æ–ø—ã–≤–∞–ª–∏—Å—å¬ª */\n        }\n        \n        /* (–æ—Å—Ç–∞–≤–ª—è–µ–º –æ–±—â–∏–π –≤–µ—Ä—Ö–Ω–∏–π –∑–∞–∑–æ—Ä —Å–µ–∫—Ü–∏–∏) */\n        .fmv .place-row, .fmv .order-row { margin-top: 8px; }\n\n        .fmv .chip .name { font-weight: 600; }\n        .fmv .chip .name .name-code { font-weight: 400; color: var(--fmv-muted); }\n\n        ",document.head.appendChild(e)}();const s="string"==typeof a.form?$(a.form):a.form,c="string"==typeof a.textarea?$(a.textarea):a.textarea;if(!s?.length||!c?.length)return null;const l=c.val()||"",d=/\[FMV(?:cast|place|ord)\][\s\S]*?\[\/FMV(?:cast|place|ord)\]/i.test(l);if(a.showOnlyIfFMVcast&&!d)return null;if(a.stripOnMount&&c.val(r(l)),s.data("fmvBoundUI"))return s.data("fmvBoundUI");const u="msg-with-characters fmv "+(a.className||""),p=$("<div/>",{class:u}),m=$('<div class="section-title">–î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–±–æ—Ä–∞ —Ö—Ä–æ–Ω–æ–ª–æ–≥–∏–∏</div>'),f=$('<div class="char-row"/>'),h=$('<div class="combo"/>'),g=$('<label for="character-combo" style="font-weight:600;display:block;margin-bottom:4px">–£—á–∞—Å—Ç–Ω–∏–∫–∏ —ç–ø–∏–∑–æ–¥–∞:</label>'),w=$('<input type="text" id="character-combo" placeholder="–ù–∞–±–µ—Ä–∏—Ç–µ –∏–º—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞‚Ä¶" autocomplete="off">'),y=$('<div class="ac-list" role="listbox" aria-label="–í–∞—Ä–∏–∞–Ω—Ç—ã –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π"></div>'),v=$('<div class="hint">–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–∞–ø–∏—à–∏—Ç–µ –≤ –ü—Ä–∏–µ–º–Ω—É—é.</div>');h.append(g,w,y,v),f.append(h);const b=$('<div class="chips"/>'),S=$('<div class="place-row"/>'),x=$('<label for="fmv-place" style="font-weight:600">–õ–æ–∫–∞—Ü–∏—è:</label>'),k=$('<input type="text" id="fmv-place" placeholder="–£–∫–∞–∂–∏—Ç–µ –ª–æ–∫–∞—Ü–∏—é">'),C=$('<div class="hint">–õ—É—á—à–µ —É–∫–∞–∑—ã–≤–∞—Ç—å –≤ –µ–¥–∏–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ: –•–æ–≥–≤–∞—Ä—Ç—Å, –ö–æ—Å–æ–π –ø–µ—Ä–µ—É–ª–æ–∫, –õ—é—Ç–Ω—ã–π –ø–µ—Ä–µ—É–ª–æ–∫, –ú–∏–Ω–∏—Å—Ç–µ—Ä—Å—Ç–≤–æ –∏ —Ç.–¥.</div>');S.append(x,k,C);const _=$('<div class="order-row"/>'),E=$('<label for="fmv-ord" style="font-weight:600">–î–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ —ç–ø–∏–∑–æ–¥–æ–≤ –≤ –æ–¥–∏–Ω –¥–µ–Ω—å</label>'),F=$('<input type="number" id="fmv-ord" placeholder="0" value="0" step="1">'),I=$('<div class="order-hint">–ü–æ–º–æ–≥–∞–µ—Ç —É–ø–æ—Ä—è–¥–æ—á–∏—Ç—å —ç–ø–∏–∑–æ–¥—ã, –∫–æ—Ç–æ—Ä—ã–µ —Å—Ç–æ—è—Ç –≤ –æ–¥–∏–Ω –¥–µ–Ω—å. –ß–µ–º –±–æ–ª—å—à–µ –∑–Ω–∞—á–µ–Ω–∏–µ, —Ç–µ–º –ø–æ–∑–∂–µ —ç–ø–∏–∑–æ–¥. –õ—É—á—à–µ –æ—Å—Ç–∞–≤–ª—è—Ç—å 0.</div>');_.append(E,F,I),c.before(p),p.append(m,f,b,S,_);let M=[],L=[];function A(){b.empty(),M.forEach(function(e,t){const n=$('<div class="chip" draggable="true" data-idx="'+t+'"/>');n.append('<span class="drag" title="–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ—Ä—è–¥–∫–∞">‚Üï</span>');const o=$('<span class="name"/>');o.append(document.createTextNode(e.name+" ")),o.append($('<span class="name-code"/>').text("("+e.code+")")),n.append(o);const r=$('<span class="masks"/>');e.masks?.length?(r.append('<span class="masks-label">‚Äî –º–∞—Å–∫–∏:</span>'),e.masks.forEach(function(e,t){const n=$('<span class="mask-badge" data-mi="'+t+'"><span class="mask-text"></span><button type="button" class="mask-remove" aria-label="–£–¥–∞–ª–∏—Ç—å –º–∞—Å–∫—É">√ó</button></span>');n.find(".mask-text").text(e),r.append(n)})):r.text(" ‚Äî –º–∞—Å–æ–∫ –Ω–µ—Ç");const i=$('<button class="add-mask" type="button">–¥–æ–±–∞–≤–∏—Ç—å –º–∞—Å–∫—É</button>'),a=$('<button class="x" type="button" aria-label="–£–¥–∞–ª–∏—Ç—å">√ó</button>'),s=$('<span class="mask-input"></span>').hide(),c=$('<input type="text" placeholder="–º–∞—Å–∫–∞ (—Ç–µ–∫—Å—Ç)">'),l=$('<button type="button" class="btn btn-ok">–û–∫</button>'),d=$('<button type="button" class="btn btn-cancel">–û—Ç–º–µ–Ω–∞</button>');s.append(c,l,d),c.on("keydown",e=>{"Enter"===e.key&&(e.preventDefault(),l.click())}),i.on("click",()=>{n.find(".mask-input").removeClass("is-open").hide(),s.addClass("is-open").show(),c.val("").focus()}),l.on("click",()=>{const t=$.trim(c.val());t&&((e.masks||(e.masks=[])).push(t),A())}),d.on("click",()=>{s.removeClass("is-open").hide()}),a.on("click",()=>{M.splice(t,1),A()}),n.append(r,i,s,a),b.append(n)})}function D(e){if(!e||M.some(t=>t.code===e))return;const t=L.find(t=>t.code===e);M.push({code:e,name:t?t.name:e,masks:[]}),A(),w.val(""),y.hide().empty()}function N(e){const t=(e||"").trim().toLowerCase(),n=L.filter(e=>!M.some(t=>t.code===e.code)).filter(e=>!t||e.name.toLowerCase().includes(t)||e.code.toLowerCase().includes(t)).slice().sort((e,t)=>e.name.localeCompare(t.name,"ru",{sensitivity:"base"}));y.empty(),n.length?(n.slice(0,40).forEach(e=>{y.append($('<div class="ac-item" role="option"/>').attr("data-code",e.code).text(e.name+" ("+e.code+")"))}),y.show(),O(0)):y.append('<div class="ac-item"><span class="muted">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</span></div>').show()}function O(e){const t=y.children(".ac-item");t.removeClass("active"),t.length&&(e=(e+t.length)%t.length,t.eq(e).addClass("active"),y.data("activeIndex",e))}if(b.on("dragstart",".chip",function(e){$(this).addClass("dragging"),e.originalEvent.dataTransfer.setData("text/plain",$(this).data("idx"))}),b.on("dragend",".chip",function(){$(this).removeClass("dragging")}),b.on("dragover",function(e){e.preventDefault()}),b.on("drop",function(e){e.preventDefault();const t=+e.originalEvent.dataTransfer.getData("text/plain"),n=$(e.target).closest(".chip");if(!n.length)return;const o=+n.data("idx");if(isNaN(t)||isNaN(o)||t===o)return;const r=M.splice(t,1)[0];M.splice(o,0,r),A()}),b.on("click",".mask-remove",function(){const e=+$(this).closest(".chip").data("idx"),t=+$(this).closest(".mask-badge").data("mi");isNaN(e)||isNaN(t)||!Array.isArray(M[e].masks)||(M[e].masks.splice(t,1),A())}),w.on("input",function(){N(this.value)}),w.on("keydown",function(e){const t=0|y.data("activeIndex");if("ArrowDown"===e.key&&y.is(":visible"))e.preventDefault(),O(t+1);else if("ArrowUp"===e.key&&y.is(":visible"))e.preventDefault(),O(t-1);else if("Enter"===e.key){e.preventDefault();const t=y.is(":visible")?function(){const e=0|y.data("activeIndex");return y.children(".ac-item").eq(e).data("code")}():function(){const e=($.trim(w.val())||"").toLowerCase();if(!e)return null;const t=L.filter(e=>!M.some(t=>t.code===e.code)),n=t.find(t=>t.name.toLowerCase()===e)||t.find(t=>t.code.toLowerCase()===e);if(n)return n.code;const o=t.filter(t=>t.name.toLowerCase().includes(e)||t.code.toLowerCase().includes(e));if(1===o.length)return o[0].code;const r=o.filter(t=>t.name.toLowerCase().startsWith(e));return 1===r.length?r[0].code:null}();t?D(t):N(this.value)}else"Escape"===e.key&&y.hide()}),y.on("mousedown",".ac-item",function(){const e=$(this).data("code");e&&D(e)}),$(document).on("click",function(e){$(e.target).closest(h).length||y.hide()}),"function"==typeof FMV.fetchUsers&&FMV.fetchUsers().then(function(t){L=(t||[]).slice(),!1!==a.prefill&&function(t){M=[];const n=e(t||""),o=String(t||"").match(/\[FMVplace\]([\s\S]*?)\[\/FMVplace\]/i);o&&"string"==typeof o[1]&&k.val(o[1].trim());const r=String(t||"").match(/\[FMVord\]([\s\S]*?)\[\/FMVord\]/i);if(r&&"string"==typeof r[1]){let e=parseInt(r[1].trim(),10);Number.isNaN(e)&&(e=0),F.val(e)}Object.keys(n).forEach(e=>{const t=L.find(t=>t.code===e);M.push({code:e,name:t?t.name:e,masks:n[e].masks})}),A()}(l)}).catch(function(e){y.html('<div class="ac-item"><span class="muted">'+(e||"–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏")+"</span></div>").show()}),s.off("submit.fmv.ui").on("submit.fmv.ui",function(e){const i=s.find('input[name="req_subject"]'),a=!i.length||$.trim(i.val()||"").length>0,l=r(c.val()||""),d=$.trim(l).length>0,u=M.length>0,p=$.trim(k.val()||"").length>0;if(!(a&&d&&u&&p)){e.preventDefault(),"function"==typeof e.stopImmediatePropagation&&e.stopImmediatePropagation(),"function"==typeof e.stopPropagation&&e.stopPropagation();const t=[];return a||t.push("–ó–∞–≥–æ–ª–æ–≤–æ–∫"),d||t.push("–û—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç"),u||t.push("–£—á–∞—Å—Ç–Ω–∏–∫–∏"),p||t.push("–õ–æ–∫–∞—Ü–∏—è"),alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ: "+t.join(", ")),!1}const m=[t(M),n(k.val()),o(F.val())].filter(Boolean).join("");let f=l.replace(/[ \t]+$/,"");const h=!f||/\n$/.test(f)?"":"\n";c.val(f+h+m)}),function(){const e=(window.CHRONO_CHECK?.GroupID||[]).map(String),t=(window.CHRONO_CHECK?.AllowedUser||[]).map(String),n="function"==typeof window.getCurrentGroupId?String(window.getCurrentGroupId()):"",o="function"==typeof window.getCurrentUserId?String(window.getCurrentUserId()):"";return n&&e.includes(n)||o&&t.includes(o)}()){let e=s.data("fmvAdminTools");e&&e.length||(e=$('<div class="fmv-admin-tools"><button type="button" class="fmv-toggle">–†–µ–∂–∏–º —Ä—É—á–Ω–æ–≥–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</button></div>'),s.data("fmvAdminTools",e)),p.before(e);const i=e.find(".fmv-toggle");i.off("click.fmv");const a=()=>{const e=[t(M),n(k.val()),o(F.val())].filter(Boolean).join(""),a=r(c.val()||"").replace(/[ \t]+$/,""),l=!a||/\n$/.test(a)?"":"\n";c.val(a+(e?l+e:"")),p.remove(),s.off("submit.fmv.ui").removeData("fmvBoundUI"),i.data("raw",!0).text("–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —É–¥–æ–±–Ω–æ–π —Ñ–æ—Ä–º–µ")},l=()=>{FMV.UI.attach({form:s,textarea:c,prefill:!0,showOnlyIfFMVcast:!1,className:"fmv--compact",stripOnMount:!0}),i.data("raw",!1).text("–†–µ–∂–∏–º —Ä—É—á–Ω–æ–≥–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è")};i.on("click.fmv",()=>i.data("raw")?l():a())}const T={serialize:()=>[t(M),n(k.val()),o(F.val())].filter(Boolean).join(""),stripFMV:r,mountPoint:p};return s.data("fmvBoundUI",T),T}}}(),e=function(){if(window.__FMV_BOOTSTRAPPED__)return;if(window.__FMV_BOOTSTRAPPED__=!0,!FMV.UI||"function"!=typeof FMV.UI.attach)return;const e=new URL(location.href),t=e.pathname,n=e.searchParams;function o({strip:e=!1,showOnlyIfCast:t=!1}={}){const n=$('#post form, form[action*="post.php"], form[action*="edit.php"]').first(),o=n.find('textarea[name="req_message"], #main-reply, .questionary-post textarea').first();return n.length&&o.length?FMV.UI.attach({form:n,textarea:o,prefill:!0,showOnlyIfFMVcast:!!t,className:"fmv--compact",stripOnMount:!!e}):null}if(/\/post\.php$/i.test(t)&&!n.has("action")){const e=+(n.get("fid")||0);(window.CHRONO_CHECK?.ForumID||[]).map(Number).includes(e)&&o({strip:!1,showOnlyIfCast:!1})}if(/\/post\.php$/i.test(t)&&"post"===n.get("action")){if(n.has("tid"))return;const e=Number(n.get("fid")),t=(window.CHRONO_CHECK?.ForumID||[]).map(Number);e&&!t.includes(e)||o({strip:!0,showOnlyIfCast:!1})}if(/\/edit\.php$/i.test(t)&&n.has("id")&&document.querySelector('input[name="firstpost"]')){const e=document.querySelector(".container.crumbs a:nth-of-type(2)");if(e&&e.href.includes("/viewforum.php?id=")&&e.href.split("/viewforum.php?id=").length>=2){const t=Number(e.href.split("/viewforum.php?id=")[1]);(window.CHRONO_CHECK?.ForumID||[]).map(Number).includes(t)&&o({strip:!0,showOnlyIfCast:!1})}}},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e,{once:!0}):e()}(),(()=>{"use strict";const e="–ü–æ–∫–∞–∑–∞—Ç—å —Å–∫—Ä—ã—Ç—ã–µ —Ç–µ–≥–∏";async function t(e,{timeout:t=1e4,interval:n=100}={}){const o=performance.now();for(;performance.now()-o<t;){try{const t=e();if(t)return t}catch{}await FMV.sleep(n)}return null}function n(){const t=document.querySelector(".ams_info");return t&&Array.from(t.querySelectorAll("div[data-order]")).find(t=>{const n=t.querySelector("button.button");return 1===Number(t.dataset.order)&&n&&n.textContent.trim()===e})||null}async function o(){if(!await t(()=>window.FMV&&"function"==typeof FMV.readTagText&&"function"==typeof FMV.escapeHtml&&"function"==typeof FMV.parseOrderStrict&&"function"==typeof FMV.buildIdToNameMapFromTags&&"function"==typeof FMV.parseCharactersUnified&&"function"==typeof window.profileLink,{timeout:15e3}))return null;const e=await t(()=>document.querySelector(".topic .post.topicpost, .post.topicpost, .message:first-of-type"),{timeout:15e3});if(!e)return null;const n=window.CHRONO_CHECK?.GroupID||[];if("function"==typeof window.ensureAllowed&&!window.ensureAllowed(n))return null;const o=FMV.readTagText(e,"characters"),r=FMV.readTagText(e,"location"),i=FMV.readTagText(e,"order"),a=await FMV.buildIdToNameMapFromTags(o),s=[];if(o){const e=FMV.renderParticipantsHtml(o,a,(e,t)=>window.profileLink(e,t));s.push(`<div class="fmv-row"><span class="fmv-label">–£—á–∞—Å—Ç–Ω–∏–∫–∏:</span>${e}</div>`)}if(r&&s.push(`<div class="fmv-row"><span class="fmv-label">–õ–æ–∫–∞—Ü–∏—è:</span>${FMV.escapeHtml(r)}</div>`),i){const e=FMV.parseOrderStrict(i);s.push(`<div class="fmv-row"><span class="fmv-label">–î–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏:</span>${e.html}</div>`)}if(!s.length)return null;!function(){if(document.getElementById("fmv-meta-style"))return;const e=document.createElement("style");e.id="fmv-meta-style",e.textContent="\n      .fmv-meta{\n        margin:8px 0; padding:8px; border:1px solid #d7d7d7;\n        background:#f7f7f7; border-radius:6px;\n      }\n      .fmv-row{margin:.25em 0}\n      .fmv-label{font-weight:700;margin-right:.25em}\n      .fmv-missing{color:#c00;background:#ffe6e6;border-radius:6px;padding:0 .25em;font-weight:700}\n    ",document.head.appendChild(e)}();const c=document.createElement("div");return c.className="fmv-meta",c.innerHTML=s.join("\n"),c}async function r(){const e=n();if(!e)return;!function(){const e=n(),t=e?.nextElementSibling;t&&t.classList.contains("fmv-meta")&&t.remove()}();const t=await o();t&&e.parentNode.insertBefore(t,e.nextSibling)}window.CHRONO_CHECK&&Array.isArray(window.CHRONO_CHECK.GroupID)&&Array.isArray(window.CHRONO_CHECK.ForumID)?createForumButton({allowedGroups:window.CHRONO_CHECK.GroupID,allowedForums:window.CHRONO_CHECK.ForumID,label:e,order:1,showStatus:!1,showDetails:!1,showLink:!1,async onClick({wrap:e}){if(e.nextElementSibling?.classList.contains("fmv-meta"))e.nextElementSibling.remove(),localStorage.setItem("fmv:meta:enabled","0");else{const t=await o();t&&(e.parentNode.insertBefore(t,e.nextSibling),localStorage.setItem("fmv:meta:enabled","1"))}}}):console.warn("[tags_visibility] –¢—Ä–µ–±—É—é—Ç—Å—è CHRONO_CHECK.GroupID, ForumID"),(async()=>{"1"!==localStorage.getItem(function(){try{const e=new URL(location.href);return`fmv:meta:enabled:${e.searchParams.get("id")||e.searchParams.get("tid")||e.pathname}`}catch{return`fmv:meta:enabled:${location.href}`}}())||function(){const e=n(),t=e?.nextElementSibling;return!(!t||!t.classList.contains("fmv-meta"))}()||await r()})()})();