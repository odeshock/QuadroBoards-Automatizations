# Анализ корректности тестов с корректировками

## Правило корректировки
**"За 5 подарков": 40×1×5 - 180×1 = 20₽**

Срабатывает когда: **эффективное количество подарков >= 5**

Эффективное количество = общее количество - количество забранное item купонами

---

## Тест 1.1 ❌ ОШИБКА (уже исправлена пользователем)
**Корзина:** 5 подарков
**Item купоны:** 1 подарок
**Эффективное количество:** 5 - 1 = **4**
**Должна ли быть корректировка?** ❌ НЕТ (4 < 5)
**Статус:** ✅ Исправлено пользователем

---

## Тест 2.1 ✅ ПРАВИЛЬНО
**Корзина:** 5 подарков
**Item купоны:** 1 + 2 = 3 подарка
**Эффективное количество:** 5 - 3 = **2**
**Должна ли быть корректировка?** ❌ НЕТ (2 < 5)
**В тесте указано:** `Корректировки: 0₽ (эффективно 5-3=2 подарка, недостаточно для правила)`
**Вывод:** ✅ Правильно

---

## Тест 2.2 ✅ ПРАВИЛЬНО
**Корзина:** 7 подарков
**Item купоны:** 2 подарка
**Эффективное количество:** 7 - 2 = **5**
**Должна ли быть корректировка?** ✅ ДА (5 >= 5)
**В тесте указано:** `Корректировки: +20₽ (эффективно 7-2=5 подарков)`
**Вывод:** ✅ Правильно

---

## Тест 2.3 ❌ ОШИБКА
**Корзина:** 5 подарков
**Item купоны:** 1 подарок
**Эффективное количество:** 5 - 1 = **4**
**Должна ли быть корректировка?** ❌ НЕТ (4 < 5)
**В тесте указано:** `Корректировки: +20₽ (эффективно 5-1=4 подарка, недостаточно для правила)`
**Противоречие!** Написано "недостаточно", но указана корректировка +20₽

**Исправление:**
```
Корректировки: 0₽ (эффективно 5-1=4 подарка, недостаточно для правила)
Автоскидки: (пересчитать без -20 из корректировки)
```

---

## Тест 2.7 ✅ ПРАВИЛЬНО
**Корзина:** 8 подарков
**Item купоны:** 1 подарок
**Эффективное количество:** 8 - 1 = **7**
**Должна ли быть корректировка?** ✅ ДА (7 >= 5)
**В тесте указано:** `Корректировки: +20₽ (эффективно 8-1=7 подарков)`
**Вывод:** ✅ Правильно

---

## Тест 3.2 ✅ ПРАВИЛЬНО
**Корзина:** 5 подарков + 3 иконки
**Item купоны:** Нет для подарков
**Эффективное количество:** 5 - 0 = **5**
**Должна ли быть корректировка?** ✅ ДА (5 >= 5)
**В тесте указано:** `Корректировки: +20₽ (за подарки: 40×1×5 - 180×1 = 20)`
**Вывод:** ✅ Правильно

---

## Тест 5.1 ✅ ПРАВИЛЬНО
**Корзина:** 7 подарков
**Item купоны:** 2 подарка
**Эффективное количество:** 7 - 2 = **5**
**Должна ли быть корректировка?** ✅ ДА (5 >= 5)
**В тесте указано:** `Корректировки: +20₽ (эффективно 7-2=5 подарков -> правило срабатывает)`
**Вывод:** ✅ Правильно

---

## Тест 5.2 ✅ ПРАВИЛЬНО
**Корзина:** 7 подарков
**Item купоны:** 3 подарка
**Эффективное количество:** 7 - 3 = **4**
**Должна ли быть корректировка?** ❌ НЕТ (4 < 5)
**В тесте указано:** `Корректировки: 0₽ (эффективно 7-3=4 подарка -> правило НЕ срабатывает)`
**Вывод:** ✅ Правильно

---

## Тест 7.1 ✅ ПРАВИЛЬНО
**Корзина:** 7 подарков
**Item купоны:** 2 подарка
**Эффективное количество:** 7 - 2 = **5**
**Должна ли быть корректировка?** ✅ ДА (5 >= 5)
**В тесте указано:** `Корректировки: +20₽ (за 5 эффективных подарков)`
**Вывод:** ✅ Правильно

---

## Тест 8.1 ✅ ПРАВИЛЬНО
**Корзина:** 10 подарков
**Item купоны:** 1 + 2 = 3 подарка
**Эффективное количество:** 10 - 3 = **7**
**Должна ли быть корректировка?** ✅ ДА (7 >= 5)
**В тесте указано:** `Корректировки: +20₽ (эффективно 10-3=7 подарков: правило "5 подарков" срабатывает)`
**Вывод:** ✅ Правильно

---

## Тест 8.2 ✅ ПРАВИЛЬНО
**Корзина:** 7 подарков + 4 иконки
**Item купоны:** 2 подарка для подарков, 1 иконка для иконок
**Эффективное количество подарков:** 7 - 2 = **5**
**Должна ли быть корректировка?** ✅ ДА (5 >= 5)
**В тесте указано:** `Корректировки: +20₽ (за подарки)`
**Вывод:** ✅ Правильно

---

## Сводка

| Тест | Статус | Проблема |
|------|--------|----------|
| 1.1 | ✅ | Исправлено пользователем |
| 2.1 | ✅ | - |
| 2.2 | ✅ | - |
| **2.3** | ❌ | **Противоречие: написано "недостаточно", но указана корректировка +20₽** |
| 2.7 | ✅ | - |
| 3.2 | ✅ | - |
| 5.1 | ✅ | - |
| 5.2 | ✅ | - |
| 7.1 | ✅ | - |
| 8.1 | ✅ | - |
| 8.2 | ✅ | - |

---

## Требуется исправление

### Тест 2.3: Item + Fixed (частичное применение)

**Было:**
```
Подарки: -200₽
Купоны: +180₽
  - Скидка на 1 подарок: 40 × 1 = 40
  - Скидка -180₽: 140 (частично)
Корректировки: +20₽ (эффективно 5-1=4 подарка, недостаточно для правила)  ❌
Автоскидки: 0₽ (остаток = 200-40-20-140 = 0)
ИТОГО: 0₽
```

**Должно быть:**
```
Подарки: -200₽
Купоны: +180₽
  - Скидка на 1 подарок: 40 × 1 = 40
  - Скидка -180₽: 160 (частично) ← изменилось!
Корректировки: 0₽ (эффективно 5-1=4 подарка, недостаточно для правила)  ✅
Автоскидки: 0₽ (остаток = 200-40-0-160 = 0) ← пересчитано!
ИТОГО: 0₽
```

**Изменения:**
1. Корректировки: +20₽ → 0₽
2. Fixed купон: 140 → 160 (т.к. больше нет корректировки -20)
3. Автоскидки: пересчитаны без корректировки
